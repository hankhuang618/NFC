<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NFC_SYSTEM</title>


  <!-- 引入你的 JavaScript 文件 -->


  <script src="js/vue.js"></script>
  <script src="js/chart.js"></script>
  <script src="js/vuechat2.js"></script>
  <script src="js/axios.min.js"></script>
    <script type="text/javascript" src="js/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<!--<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.15.13/theme-chalk/index.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.15.13/index.js"></script>
<!--<script src="https://unpkg.com/element-ui/lib/index.js"></script>-->


  <!-- <script lang="javascript" src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>-->
   <!-- <script src="https://cdn.jsdelivr.net/npm/xlsx@latest/dist/xlsx.full.min.js"></script> -->

   
  <!-- 引入你的 JavaScript 文件 -->

  <style>
     table {
     /* width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-family: 'Oswald', sans-serif;*/
  border-collapse: separate;
  width: 100%;
  border-spacing: 0;
  border: 1px solid #6b675d;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 5px;
    text-align: center; /* 将每个单元格中的文本水平居中 */
    vertical-align: middle; /* 将每个单元格中的内容垂直居中 */
    height: auto; /* 自动调整高度 */
    }

    th {
        background-color: #6b675d;
  color:#ffffff;
  width:25vw;

    }
    span {
            display: block;
            text-align: center;
            font-size: 14px;
        }
.el-table {
    background: #ffffff !important;
    color: #333;
    border: 2px solid #ccc !important;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}
.el-table th {
  border: 1px solid #ddd !important;
  padding: 5px !important;
  text-align: center !important;
  vertical-align: middle !important;
  height: auto !important;
  background-color: #6b675d !important;
  color: #ffffff !important;
  width: 25vw !important;
  border: 1px solid #ddd;
      padding: 5px;
    text-align: center; /* 将每个单元格中的文本水平居中 */
    vertical-align: middle; /* 将每个单元格中的内容垂直居中 */
    height: auto; /* 自动调整高度 */
}
.el-table td {
    text-align: center !important; /* 水平置中 */
    vertical-align: middle !important; /* 垂直置中 */
    font-weight: bold !important; /* 文字加粗 */
    color: #000 !important; /* 文字顏色設為黑色 */
    padding: 4px 6px !important; /* 減少內邊距，縮小間距 */
    height: 12px !important; /* 設定行高，讓列變窄 */
    border: 1px solid #ddd;
      padding: 5px;
    text-align: center; /* 将每个单元格中的文本水平居中 */
    vertical-align: middle; /* 将每个单元格中的内容垂直居中 */
    height: auto; /* 自动调整高度 */
}

.el-input__inner, .el-select {
    background: #ffffff !important;
    color: #0c0000 !important;
    border: none !important; /* 移除邊框 */
    text-align: center !important;
    vertical-align: middle !important;
    font-size: min(4vw, 16px) !important;

}
.el-select-dropdown__item {
    color: #333 !important;
    padding: 8px;
}

.edit-mode {
    border: 2px solid #000 !important; /* 黑色邊框 */
    border-radius: 4px; /* 輕微圓角，讓邊框不會太生硬 */
    transition: all 0.3s ease-in-out; /* 讓邊框出現時更流暢 */
}

/* 讓 hover 時有更細緻的效果 */
.edit-mode:hover {
    border-color: #444; /* 當滑鼠移過去時，邊框變成深灰色 */
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); /* 加點淡淡的陰影，讓它更有立體感 */
}

 .machine-wrapper {
  display: flex;
  justify-content: left; /* 讓按鈕置中 */
  align-items: center;
  gap: 20px; /* 按鈕間距 */
}

.machine-container {
  display: flex;
  flex-direction: column; /* 按鈕與數量縱向排列 */
  align-items: center;
}

.test-machine-btn {
  width: 140px;
  height: 50px;
  border: 2px solid #ccc;
  border-radius: 10px;
  background-color: #f0f0f0;
  font-size: 14px;
  cursor: pointer;
  text-align: center;
  transition: all 0.3s;
}

.test-machine-btn.selected {
  background-color: #4caf50;
  color: white;
  border-color: #45a049;
}

.test-machine-btn:hover {
  background-color: #e7e7e7;
}

.device-count {
  margin-top: 5px;
  font-size: 14px;
  color: #666;
  text-align: center;
}


    form div {
  margin-bottom: 10px;
}
    .short-input {
  width: 60px;
}
    thead tr.sticky-header {
  position: sticky; /* 固定表頭 */
  top: 0;           /* 與表格的上邊距對齊 */
  background-color: #f4f4f4; /* 背景色 */
  z-index: 1;       /* 確保表頭在其他內容之上 */
  box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1); /* 添加陰影效果 */
}
 .modal {
  display: flex;
  justify-content: center;
  align-items: center;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
  background-color: #fefefe;
  padding: 20px;
  border-radius: 8px;
  width: 300px;
  text-align: center;
}

.close {
  position: absolute;
  top: 10px;
  right: 20px;
  font-size: 24px;
  cursor: pointer;
}
.tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}


    .divider {
  width: 1px; /* 分隔线宽度 */
  background-color: #ccc; /* 分隔线颜色 */
  height: auto; /* 高度自适应 */

}
    .sfcontainer {
  display: flex;
  width: 100%;
  height: auto;
}

.left-panel {
  width: 50%;
  padding: 20px;
  box-sizing: border-box;
}

.right-panel {
  width: 50%;
  padding: 20px;
  box-sizing: border-box;
  background-color: #f0f0f0; /* 可以根据需要调整背景色 */
  height: auto; /* 高度自适应 */
  max-height: 100vh; /* 最大高度为视口高度，确保在页面超出时可以滚动 */
}
    .sfmodal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
}

.sfmodal-content {
    background: #fff;
    padding: 20px;
    border-radius: 5px;
}
#scan-input {
  width: calc(100% - 20px); /* 寬度為頁面寬度減去一些邊距 */
  max-width: 600px; /* 可選，設置最大寬度以避免過寬 */
  padding: 10px;
  border: 2px solid #333; /* 深灰色邊框 */
  border-radius: 4px; /* 圓角 */
  background-color: #fff; /* 白色背景 */
  font-size: 16px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 輕微陰影 */
  transition: border-color 0.3s, box-shadow 0.3s;
  margin: 10px; /* 增加一些邊距 */
}

/* 輸入框獲得焦點時的樣式 */
#scan-input:focus {
  border-color: #007bff; /* 藍色邊框 */
  box-shadow: 0 4px 8px rgba(0, 123, 255, 0.2); /* 藍色陰影 */
  outline: none;
}

/* 顯示內容的 DIV */
#sflabel {
  margin: 20px;
  font-size: 18px;
  color: #333; /* 深灰色文字 */
}

/* 按鈕容器樣式 */
.button-container {
  display: flex;
  flex-direction: column; /* 垂直排列按鈕 */
  align-items: center; /* 使按鈕水平居中 */
  margin: 20px 0; /* 上下邊距 */
}

/* 按鈕樣式 */
#sfpass-button, #sffail-button {
  padding: 15px 30px; /* 增加按鈕的內邊距 */
  font-size: 28px; /* 增加字體大小 */
  border: none;
  border-radius: 6px; /* 圓角邊框 */
  color: #fff;
  cursor: pointer;
  transition: background-color 0.3s, box-shadow 0.3s;
  margin: 5px; /* 增加按鈕間距 */
}

/* 綠色背景的按鈕 */
#sfpass-button {
  background-color: #28a745;
}

#sfpass-button:hover {
  background-color: #218838;
}

/* 紅色背景的按鈕 */
#sffail-button {
  background-color: #dc3545;
}

#sffail-button:hover {
  background-color: #c82333;
}
.sfbutton-container {
  display: flex;
    flex-direction: row; /* 水平排列按鈕 */
    justify-content: center; /* 使按鈕在容器中水平居中 */
    align-items: center; /* 使按鈕在容器中垂直居中 */
    gap: 20px; /* 按鈕之間的間距 */
}
      #SFSELECT {
    font-size: 1.2em; /* 字体大小 */
    padding: 10px; /* 内边距 */
    border: 2px solid #ccc; /* 边框宽度和颜色 */
    border-radius: 4px; /* 边框圆角 */
    width: 100%; /* 宽度占满容器 */
    box-sizing: border-box; /* 包括内边距和边框在宽度内 */
    background-color: #f9f9f9; /* 背景颜色 */
    transition: all 0.3s ease; /* 平滑过渡效果 */
  }

  /* 鼠标悬停效果 */
  #SFSELECT:hover {
    border-color: #007bff; /* 鼠标悬停时的边框颜色 */
    background-color: #e9ecef; /* 鼠标悬停时的背景颜色 */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* 鼠标悬停时的阴影效果 */
  }

  /* 选项选择时的效果 */
  #SFSELECT:focus {
    border-color: #007bff; /* 聚焦时的边框颜色 */
    outline: none; /* 移除默认的聚焦轮廓 */
    background-color: #ffffff; /* 聚焦时的背景颜色 */
  }
.scrollable-table {
  max-height: 300px; /* 設置表格最大高度 */
  overflow-y: auto; /* 垂直滾動 */
  display: block;
  width: 100%;
}
 .chart-container {
            display: flex;
            justify-content: center;
            margin-top: 10px;
            width: 100%;  /* 设置图表宽度为100% */
            height: 50vh; /* 设置图表高度为视口高度的20% */
        }

    .clickable {
  color: blue;
  text-decoration: underline;
  cursor: pointer;
}
    .dialogA {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: white;
  padding: 20px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
}
.dialog-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
}
.dialog {
  background-color: white;
  padding: 20px;
  border-radius: 5px;
  width: 300px;
}
.machine-form {
  display: flex;
  flex-direction: column;
}

.form-group {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
}

label {
  width: 120px; /* 调整标签的宽度 */
  margin-right: 10px; /* 设置标签与输入框之间的间距 */
}
     .ATT_INPUT{
 
      width: 100%;
    }
.login {
  width: 100%;
  padding: 8px;
  margin-bottom: 15px;
  border: 1px solid #ccc;
  border-radius: 3px;
}
  header {
    text-align: center;
    font-family: Arial, sans-serif;
    color: #333;
    font-size: 21px;
    position: relative;
  }

  header::before,
  header::after {
    content: "";
    position: absolute;
    top: 50%;
    width: 40%;
    height: 1px;
    background-color: #333;
  }

  header::before {
    left: 0;
  }

  header::after {
    right: 0;
  }
    .button {
  display: inline-block;
  padding: 10px 20px;
  background-color: #4CAF50; /* 绿色 */
  color: white;
  text-align: center;
  text-decoration: none;
  font-size: 16px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.button:hover {
  background-color: #45a049; /* 深绿色 */
}
    .container {
   
  display: flex;
  justify-content: flex-end;

  margin-bottom: 10px; /* 给按钮留出一些底部空间 */
}

.export-button {
  margin-left: auto; /* 将按钮推到右侧 */
}
.hoverable:hover {
  background-color: lightblue; /* 悬停时的背景色 */
  cursor: pointer;
}

     .number-column {
      width: fit-content;
      white-space: nowrap;
  
  }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
    }

    #app {
      display: flex;
      width: 100vw;
      height: 100vh;
    }

    .menu-button {
  position: fixed;
  top: 10px;
  left: 10px;
  background-color: #333;
  color: white;
  border: none;
  padding: 10px;
  cursor: pointer;
  font-size: 20px;
  z-index: 1001;
}

.left-menu {
  position: fixed;
  top: 0;
  left: -220px;
  width: 200px;
  height: 100vh;
  background-color: #333;
  color: white;
  transition: left 0.3s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  overflow-y: auto;
  overflow-x: hidden;
}

.left-menu.open {
  left: 0;
}

.menu-content {
  width: 100%;
  padding: 20px;
  box-sizing: border-box;
  overflow-y: auto;
  max-height: 100vh;
}

.content-expanded .main-content {
  margin-left: 200px;
  transition: margin-left 0.3s ease;
}

.main-content {
  margin-left: 0;
  padding: 20px;
  transition: margin-left 0.3s ease;
}

    .left-menu img {
      max-width: 100%;
    }

    .left-menu p {
      margin-top: 10px;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 20px 0;
      width: 100%;
    }

    li {
      padding: 10px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    li:hover {
      background-color: #555;
    }

    .right-content {
      flex: 1;
      padding: 20px;
      box-sizing: border-box;
    }

    label, select, input {
      margin-bottom: 10px;
    }

   
    #content {
      flex: 1;
      padding: 10px;
      box-sizing: border-box;
      width: 800px;
      
    }
    .name-id-container {
    position: relative;
    display: inline-block;
  }

  .wo-id-tooltip {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    background-color: #ffffff;
    border: 1px solid #cccccc;
    padding: 5px;
    border-radius: 5px;
    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
    z-index: 999;
  }
  .loading-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh; /* 可根据需要调整高度 */
}

.spinner {
  border: 4px solid rgba(0, 0, 0, 0.1);
  border-top: 4px solid #3498db;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
.list-item::before {
        content: '\25B6'; /* Unicode 字元 "▶" 的轉義碼 */
        margin-right: 5px; /* 調整箭頭與文本的間距 */
        font-size: 12px; /* 調整箭頭的大小 */
    }
    
  </style>

</head>
<body>

<div id="app">

  <template>
    <div :class="{ 'content-expanded': isOpen }">
      <!-- 漢堡選單按鈕 -->
      <button class="menu-button" @click="toggleMenu">☰</button>
      
      <!-- 左側選單 -->
      <div class="left-menu" :class="{ 'open': isOpen }">
        <div class="menu-content">
        <img src="logo.png" alt="Logo">
        <p>{{ currentTime }}</p>
        <ul>
          <h3>{{ translatedText.NFC_SYSTEAM }}</h3>
                  

          <li  class="list-item" @click="showRealTime">{{ translatedText.在線生產看板 }}</li>
          <li  class="list-item" @click="showPDRealTime">{{ translatedText.每日生產看版 }}</li>
          <li   class="list-item" @click="wo_mange">{{ translatedText.工單管理 }}</li>
          <li  class="list-item" @click="fqc_mange">{{ translatedText.完工數量 }} </li>
          <li v-if="user.permissions.includes('business')"  class="list-item" @click="wo_select">{{ translatedText.工單查詢 }}</li>
          <li v-if="user.permissions.includes('engineering')"class="list-item" @click="WO_VERSON">{{ translatedText.生產日報 }}</li>
          <li  v-if="user.permissions.includes('business')" class="list-item" @click="RATING_VERSON">{{ translatedText.產能日報 }}</li>
          <li  v-if="user.permissions.includes('business')" class="list-item" @click="woerp_report">{{ translatedText.工單狀態與ERP對比報表 }}</li>
          <li v-if="user.permissions.includes('engineering')" class="list-item" @click="toggleSettings">{{ translatedText.工站管理 }}</li> <!-- 新增点击事件 -->
          <ul v-if="settingsOpen "> <!-- 根据状态展开/折叠 -->
            <li class="list-item" @click="seat_mange">{{ translatedText.工站設定 }}</li>
            <li class="list-item" @click="CARD_mange">{{ translatedText.卡片設定 }}</li>
            <li class="list-item" @click="shift_mange">{{ translatedText.班別管理 }}</li>
            <li class="list-item" @click="SET_mange">卡機號碼</li>
          </ul>
      <h3>  shop floor</h3>
          <li  v-if="user.permissions.includes('engineering')" class="list-item" @click="SN_MG">{{ translatedText.序號管理 }}</li>
          <!--   <li  class="list-item" @click="SHOP_ST">{{ translatedText.過站管理 }}</li>-->
          <li  v-if="user.permissions.includes('business')" class="list-item" @click="SNLIST">{{ translatedText.序號查詢 }}</li>
          <li v-if="user.permissions.includes('business')" class="list-item" @click="PDSNLIST">{{ translatedText.出貨序號表 }}</li>
          <li v-if="user.permissions.includes('engineering')" class="list-item" @click="FAILSNLIST">{{ translatedText.不良品紀錄查詢 }}</li>
          <h3>  {{ translatedText.考勤系統 }}</h3>
          <li v-if="user.permissions.includes('engineering')" class="list-item" @click="staff_mange">{{ translatedText.人員管理 }}</li>
          <li v-if="user.permissions.includes('business')" class="list-item" @click="ATT_timebt">{{ translatedText.考勤日報 }} </li>
          <li v-if="user.permissions.includes('engineering')" class="list-item" @click="ATT_timebt_confirm">{{ translatedText.考勤調整確認 }} </li>
          <!-- ul v-if="power === 'T'">-->
          <h3> {{ translatedText.生產數據 }}</h3>
          <li  class="list-item" @click="PD_VERSON">{{ translatedText.生產看版 }}</li>
          <li  class="list-item" @click="eff_report">{{ translatedText.工單分析圖表 }}</li>
          <h3 @click="toggleperformance"> 考績系統</h3>
    
         
            <li v-if="user.permissions.includes('business')"  class="list-item" @click="effperformance">效率考績</li>
            <li v-if="user.permissions.includes('business')"  class="list-item" @click="overflowperformance">溢領考績</li>
          <!--   <li>重點工站考績</li> -->
            <!--   <li>星級考核</li> -->
    
      </ul>
                <div class="language-dropdown">
                  <label for="language-select">Language:</label>
                  <select id="language-select" @change="changeLanguage">
                      <option value="zh">中文</option>
                      <option value="en">English</option>
                      <option value="vi">Tiếng Việt</option>
                  </select>
              </div>     
            
                <ul> 
                   <li   v-if="power === 'T'"class="list-item"  @click="logout" >  {{user.username}} <br></br>登出</li>  
                   <li  v-if="power === 'T'" class="list-item" @click="repassword">修改密碼</li>
                  <li   v-else  class="list-item" @click="login_VERSON">{{ translatedText.登入 }}</li>  
                </ul>
    
      </div>
    </div>
      <!-- 主要內容區域 -->
      <div class="main-content">
        <slot></slot>
      </div>
    </div>
  </template>

  <div id="content">
    <div id="header" v-if="showyear">
      <label >{{ translatedText.area }}:</label>
      <select id="selectedArea" v-model="selectedArea" >
        <option value="ZH">ZH</option>
        <option value="TC">TC</option>
        <option value="VN">VN</option>
        <option value="TW">TW</option>
      </select>
      <label >年分:</label>
      <select id="selectedyear" v-model="selectedyear" >
        <option value="2023">2023</option>
        <option value="2024">2024</option>
        <option value="2025">2025</option>

      </select>
      <button @click="generateChart">查詢</button>
      </div>
  <div id="header" v-if="showCLASS">
    <label >{{ translatedText.area }}:</label>
    <select id="areaSelect" v-model="selectedArea" @change="handleInputChange">
      <option value="ZH">ZH</option>
      <option value="TC">TC</option>
      <option value="VN">VN</option>
      <option value="TW">TW</option>
    </select>

    <label >{{ translatedText.部門 }}:</label>
    <select id="DSelect" v-model="selectedD" @change="handleInputChange">
        <option value="1">1</option>                                                     
        <option value="2">2</option>                                                                                 
        <option value="3">3</option> 
        <option value="4">4</option>
        <option value="6">6</option>
      </select>
    <label >{{ translatedText.D }}</label>
    <select id="SSelect" v-model="selectedS" @change="handleInputChange">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
      </select>
    <label >{{ translatedText.S }}</label>
    <select id="CSelect" v-model="selectedC" @change="handleInputChange">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="S1">S1</option>
        <option value="S2">S2</option>
        <option value="S3">S3</option>
        <option value="S4">S4</option>
        <option value="S5">S5</option>
        <option value="S6">S6</option>
      </select>

    <label >{{ translatedText.C }}</label>
    <select id="LSelect" v-model="selectedL" @change="handleInputChange">
        <option value=""></option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
      </select>
    <label >{{ translatedText.L }}</label>

  </div>
  <div v-if="loading" class="loading-container">
    <div class="spinner"></div>
    <div>Loading...</div>
  </div>
  <div class="right-content" v-if="isLoggedIn">
    <label for="username">Account:</label>
    <input class="login " type="text" id="username" v-model="credentials.username">
    <label for="password">Password:</label>
    <input  class="login "  type="password" id="password" v-model="credentials.password">
    <button @click="login">Log In</button>
</div>

<div class="right-content" v-if="repasswords">
  <label for="OldPassword">舊密碼:</label>
  <input class="login" type="password" id="OldPassword" v-model="oldPassword">

  <label for="newpassword">新密碼:</label>
  <input class="login" type="password" id="newPassword" v-model="newPassword">

  <button @click="revise">修改</button>
</div>
<div class="right-content" v-if="showPDRealTimeContent">
  <template >
    <div style="margin-bottom: 1px;">
      <el-button type="warning" @click="toggleEditMode">
        {{ editMode ?  translatedText.完成  :   translatedText.調整   }}

    </el-button>
    
      <el-switch v-model="showDefectForming" active-text="顯示欄位1"></el-switch>
      <el-switch v-model="showDefectFormingNG" active-text="顯示欄位2"></el-switch>
      <el-switch v-model="showDefectWelding" active-text="顯示欄位3"></el-switch>
  </div>
<!--<el-table :data="tableData" border style="width: 100%; margin-top: 10px;" :span-method="mergeTable">-->
  <el-table :data="tableData" border style="width: 100%; margin-top: 10px;" :span-method="mergeTable" :summary-method="getSummaries" show-summary>



      <el-table-column v-if="editMode" label="操作" width="80">
          <template slot-scope="scope">
              <el-button type="danger" icon="el-icon-delete" size="mini" @click="removeRow2(scope.row,scope.$index)"></el-button>
          </template>
      </el-table-column>
      <el-table-column  prop="time" id="time" min-width="80">
        <template slot="header">
          <span >時段<br> thời gian</span>
      </template>
          <template slot-scope="scope">
              <el-select v-model="scope.row.time" :disabled="!editMode"  @input="resetExpected(scope.row, scope.$index)"style="width: 100%;" :class="{ 'edit-mode': editMode }" >
                  <el-option 
                      v-for="[label, value] in Object.entries(timeOptions)" 
                      :key="label" 
                      :label="label" 
                      :value="label">
                  </el-option>
              </el-select>
          </template>
      </el-table-column>

      <el-table-column   prop="people" id="people" >
        <template slot="header">
          <span>人數<br>Số người</span>
      </template>
          <template slot-scope="scope">
              <el-input v-model.number="scope.row.people"  @input="resetExpected(scope.row, scope.$index)" :disabled="!editMode" type="number" min="1"  :class="{ 'edit-mode': editMode }"></el-input>
          </template>
      </el-table-column>
  
  
      <el-table-column  prop="wohourse" id="wohourse" min-width="80">
        <template slot="header">
          <span>總時數<br>Tổng số giờ</span>
      </template>
          <template slot-scope="scope">
            {{ (calculateHours(scope.row)).toFixed(2) }}
          </template>
      </el-table-column>
  
      <el-table-column  min-width="120">
        <template slot="header">
          <span>品名<br>Tên sản phẩm</span>
      </template>
        <template slot-scope="scope">
            <el-select v-model="scope.row.product" :disabled="!editMode" filterable placeholder="請選擇品名" style="width: 100%;"  @input="resetExpected(scope.row, scope.$index)":class="{ 'edit-mode': editMode }">
                <el-option 
                    v-for="item in productOptions" 
                    :key="item.value" 
                    :label="item.label" 
                    :value="item.value">
                </el-option>
            </el-select>
        </template>
    </el-table-column>

      <el-table-column  prop="workhorse" id="workhorse" min-width="80"  min-width="90">
        <template slot="header">
          <span>輸入工時<br>Nhập giờ làm việc</span>
      </template>
          <template slot-scope="scope">
              <el-input 
              v-model.number="scope.row.workhorse"  
              @input="resetExpected(scope.row, scope.$index)" 
              @blur="formatDecimal(scope.row, 'workhorse')" 
              :disabled="!editMode" 
              type="number" 
              step="0.01" 
              min="0.00"
              :class="{ 'edit-mode': editMode }">
          </el-input>
          </template>
      </el-table-column>

      <!-- <el-table-column label="預期產量">
          <template slot-scope="scope">
              {{ calculateExpected(scope.row, scope.$index) }}
          </template>
      </el-table-column>-->
  
      <el-table-column  min-width="90"  prop="expected" id="expected" >
        <template slot="header">
          <span>標準產能<br>Số lượng tiêu chuẩn</span>
      </template>
          <template slot-scope="scope">
              <!-- 使用 v-model 綁定 scope.row.expected，並觸發 @blur 檢查手動修改 -->
              <el-input 
                  v-model.number="scope.row.expected" 
                  :disabled="true" 
                  type="number" 
                  min="0" 
                  @blur="updateExpected(scope.row,scope.$index)"
                  :class="{ 'edit-mode': editMode }">
              </el-input>
          </template>
      </el-table-column>
      <el-table-column  prop="actual" id="actual">
        <template slot="header">
          <span>實際產出<br>Số lượng thực tế</span>
      </template>
          <template slot-scope="scope">
              <el-input v-model.number="scope.row.actual" :disabled="!editMode" type="number" min="0" :class="{ 'edit-mode': editMode }"></el-input>
          </template>
      </el-table-column>
  
      <el-table-column  prop="efficiency" id="efficiency">
        <template slot="header">
          <span>效率<br>hiệu quả</span>
      </template>
          <template slot-scope="scope">
              <span>{{ calculateEfficiency(scope.row) }}%</span>
          </template>
      </el-table-column>
  
      <el-table-column  prop="line" id="line">
        <template slot="header">
          <span>做線<br>làm dây</span>
      </template>
          <template slot-scope="scope">
              <el-input v-model="scope.row.line" :disabled="!editMode" type="number" min="0" :class="{ 'edit-mode': editMode }"></el-input>
          </template>
      </el-table-column>
         <!-- 根據開關狀態顯示/隱藏 -->
         <el-table-column  prop="defectForming" id="defectForming">
          <template slot="header">
            <span>成形<br>thành hình</span>
        </template>
          <template slot-scope="scope">
              <el-input v-model.number="scope.row.defectForming" :disabled="!editMode" type="number" min="0" :class="{ 'edit-mode': editMode }"></el-input>
          </template>
      </el-table-column>
  
      <el-table-column prop="defectWelding" id="defectWelding" >
        <template slot="header"  >
          <span>焊接<br>Hàn</span>
      </template>
          <template slot-scope="scope">
              <el-input v-model.number="scope.row.defectWelding" :disabled="!editMode" type="number" min="0" :class="{ 'edit-mode': editMode }"></el-input>
          </template>
      </el-table-column>
      <el-table-column label="NG" prop="NG" id="NG" >
        <template slot="header">
          <span>不良品<br>Hàng NG</span>
      </template>
          <template slot-scope="scope">
              <el-input v-model.number="scope.row.NG" :disabled="!editMode" type="number" min="0" :class="{ 'edit-mode': editMode }"></el-input>
          </template>
      </el-table-column>
      <el-table-column label="selectedLabel" v-if="showDefectForming">
        <template slot="header">
            <el-select v-model="selectedLabel" placeholder="選擇標題">
                <el-option label="欄位1" value="欄位1"></el-option>
                <el-option label="欄位2" value="欄位2"></el-option>
                <el-option label="欄位3" value="欄位3"></el-option>
            </el-select>
        </template>
        <template slot-scope="scope">
            <el-input v-model="scope.row.other1" :disabled="!editMode" type="number" min="0" :class="{ 'edit-mode': editMode }"></el-input>
        </template>
    </el-table-column>
    
      <el-table-column label="欄位2" v-if="showDefectFormingNG">
          <template slot-scope="scope">
              <el-input v-model.number="scope.row.other2" :disabled="!editMode" type="number" min="0" :class="{ 'edit-mode': editMode }"></el-input>
          </template>
      </el-table-column>
  
      <el-table-column label="欄位3" v-if="showDefectWelding">
          <template slot-scope="scope">
              <el-input v-model.number="scope.row.other3" :disabled="!editMode" type="number" min="0" :class="{ 'edit-mode': editMode }"></el-input>
          </template>
      </el-table-column>
  
  
  </el-table>
  
  <el-button v-if="editMode" type="primary" icon="el-icon-plus" @click="addRow" style="margin-top: 10px;">{{ translatedText.New }}</el-button>
    </template>
    

</div>
<div class="right-content" v-if="SHOW_PD_VERSON">
    <label >{{ translatedText.area }}:</label>
    <select id="PDareaSelect" v-model="selectedArea" @change="fetchCombinedVersions">
      <option value="ZH">ZH</option>
      <option value="TC">TC</option>
      <option value="VN">VN</option>
      <option value="TW">TW</option>
    </select>
    <header >{{ translatedText.生產看版 }}</header>
    <br></br>

    <button @click="PDVER()">{{ translatedText.刷新 }}</button>
    <pdr-report :Area="selectedArea" ></pdr-report>
    <table>
      <thead>
        <caption style="text-align: right; font-style: italic;">{{ translatedText.pd1 }}</caption>
        <tr>
          <th></th>
          <th colspan="6">{{ translatedText.本日 }}</th>
          <th colspan="4">{{ translatedText.本月 }}</th>
          <th colspan="1">{{ translatedText.上月 }}</th>
        <tr>
          <th>{{ translatedText.部門 }}</th>
          <th>{{ translatedText.應出席人數 }}</th>
          <th>{{ translatedText.實際出席人數 }}</th>
          <th>{{ translatedText.請假人數 }}</th>
          <th>{{ translatedText.在線工單 }}</th>
          <th>{{ translatedText.平均效率 }}</th>
          <th>{{ translatedText.低於90工單數 }}</th>
          <th>{{ translatedText.已完成工單 }}</th>
          <th>{{ translatedText.未結案工單 }}</th>
          <th>{{ translatedText.平均效率 }}</th>
          <th>{{ translatedText.無效工時 }}</th>
          <th>{{ translatedText.平均效率 }}</th>
  
        </tr>
      </thead>
      <tbody style="overflow-y: scroll">
        <tr>
          <td >總和</td>
          <td>{{ PDcalculateTotal('應出席人數') }}</td>
          <td>{{ PDcalculateTotal('在線人數') }}</td>
          <td>{{ PDcalculateTotal('請假人數') }}</td>
          <td>{{ PDcalculateTotal('工單數') }}</td>
          <td v-if="PDcalculateAVG('平均效率') > 0" 
            :style="{ 'background-color': (PDcalculateAVG('平均效率') * 100) < 80 ? 'red' : 'white' }">
          {{ (PDcalculateAVG('平均效率') * 100).toFixed(2) }}%
        </td>
        <td v-else></td>
        
          <td  :style="{ 'background-color': PDcalculateTotal('效率90')  > 0 ? 'red' : 'white' }">{{ PDcalculateTotal('效率90') }}</td>
          <td>{{ PDcalculateTotal('已完成工單') }}</td>
          <td>{{ PDcalculateTotal('未完成工單') }}</td>
          <td >{{ (PDcalculateAVG('本月平均')* 1).toFixed(2) }}%</td>
          <td>{{ PDcalculateTotal('無效工時').toFixed(2) }}</td>
          <td>{{ (PDcalculateAVG('上月平均')).toFixed(2) }}%</td>
        </tr>
        <template v-for="(item, index) in PDTOVERSON">
          <tr v-if="item.應出席人數 !== 0" :key="item.部門" >
            <!-- 只在編號的第一行渲染 -->
            <td>{{(formatDepartment(item.部門) )}}</td>
            <td>{{ item.應出席人數 }}</td>
            <td>{{ item.在線人數 }}</td>
            <td>{{  item.請假人數}}</td>
            <td>{{ item.工單數 }}</td>
            <td v-if="item.平均效率 >0"  :style="{ 'background-color':(( item.平均效率) * 100) < 80 ? 'red' : 'white' }">{{ (item.平均效率 * 100).toFixed(2) }}%</td>
            <td v-else></td>
            <td :style="{ 'background-color': item.效率90  > 0 ? 'red' : 'white' }">{{ item.效率90 }}</td>
            <td>{{ item.已完成工單 }}</td>
            <td>{{ item.未完成工單 }}</td>
            <td v-if="(item.本月平均 * 100) >0"  :style="{ 'background-color': (item.本月平均 * 100) > 0 && (item.本月平均 * 100) < 0.8 ? 'red' : 'white' }">
              {{ (item.本月平均 * 1).toFixed(2) }}%
            </td>
            <td v-else></td>
            <td>{{ ((item.無效工時)*1).toFixed(2) }}</td>
            <td >{{ (item.上月平均 * 1).toFixed(2)}}%</td>
          
          </tr>
        </template>
      </tbody>
    </table>
    <table>
      <caption style="font-size: 24px;">NFC{{ translatedText.生產看版 }}</caption>
      <thead>
        <tr  class="sticky-header">
          <th>{{ translatedText.部門 }}</th>
          <th>{{ translatedText.應出席人數 }}</th>
          <th>{{ translatedText.實際出席人數 }}</th>
          <th>{{ translatedText.請假人數 }}</th>

          <th>{{ translatedText.工單 }}</th>
          <th>{{ translatedText.品名 }}</th>
          <th>{{ translatedText.數量 }}</th>
          <th>{{ translatedText.標準工時 }}</th>
          <th>{{ translatedText.執行工時 }}</th>
          <th>{{ translatedText.當前效率 }}</th>
          <th>{{ translatedText.過往效率 }}</th>
          <th>{{ translatedText.已完成數量 }}</th>
          <th>{{ translatedText.ERP入庫數量 }}</th>
          <th>生產狀態</th>
          <th>Remark</th>
        </tr>
      </thead>
  
      <tbody style="overflow-y: scroll">
        <template v-for="(item, index) in PDVERSON" >
          <tr :key="item.部門"  >
            <!-- 只在編號的第一行渲染 -->
            <td v-if="index === 0 || item.部門 !== PDVERSON[index - 1].部門  ":rowspan="countShiftDesc(index, PDVERSON)">
              {{ formatDepartment(item.部門) }}
            </td>
  
            <td :style="{  textAlign: 'center', verticalAlign: 'middle' }"
                v-if="index === 0 || item.部門 !== PDVERSON[index - 1].部門" :rowspan="countShiftDesc(index, PDVERSON)">
              {{ item.應出席人數 }}
            </td>
            <td v-if="index === 0 || item.部門 !== PDVERSON[index - 1].部門" :rowspan="countShiftDesc(index,PDVERSON)">
              {{ item.實際出席 }}
            </td>
            <td v-if="index === 0 || item.部門 !== PDVERSON[index - 1].部門" :rowspan="countShiftDesc(index,PDVERSON)">
              {{ item.請假人數 }}
            </td>
     

            <td>{{ item.工單 }}</td>
            <td :style="{ 'text-align': 'left' }">{{ item.品名 }}</td>
            <td>{{ item.數量 }}</td>
            <td>{{ item.標準工時 }}</td>
            <td :style="{ 'background-color': (item.標準工時 / item.實際工時) < 0.9 && !['100', '200', '400','300','500','700'].includes(item.工單) ? 'red' : 'white' }">{{ (item.實際工時 * 1).toFixed(2) }}</td>
            <td v-if="item.已完成數量 > 0"
              :style="{
                'background-color': (item.已完成數量 / item.實際工時) / (item.數量 / item.標準工時) < 0.9 && item.工單 !== '200' && item.工單 !== '500' && item.工單 !== '100'  && item.工單 !== '400'&& item.工單 !== '300' ? 'red' : 'white'
              }">
            {{ (((item.已完成數量 / item.實際工時) / (item.數量 / item.標準工時)) * 100).toFixed(2) }}%
            </td>
            <td v-else></td>
            <td v-if="item.過往效率 > 0">{{ (item.過往效率 * 100).toFixed(2)}}%</td>
            <td v-else>近一年無生產</td>
            <td>{{ item.已完成數量 }}</td>
            <td>{{ item.入庫數 }}</td>
            <td>{{ item.生產狀態 === 'LOT_PAUSE' ? '已暫停' : '' }}</td>
            <td>{{ item.備註}}</td>

          </tr>
        </template>
      </tbody>
    </table>
</div>
<div class="right-content" v-if="showDemoContent">

    <hello-world :Area="selectedArea" :Year="selectedyear"></hello-world>
    <report :Area="selectedArea" :Year="selectedyear"></report>
</div>
<div class="right-content" v-if="showRealTimeContent">
    <header >{{ translatedText.在線生產看板 }}</header>

    <div v-if="onlineData.length === 0">
        <label style="font-size: 24px;">{{ translatedText.在線人數 }}: 0</label>
      </div>
      <div v-else v-for="item in onlineData" :key="item.id">
        <label style="font-size: 24px;">{{ translatedText.應出席人數 }}: {{ item.應出席人數 !== undefined ? item.應出席人數 : 0  }}</label>
        <label style="font-size: 24px;">{{ translatedText.實際出席人數 }}: {{ item.實際出席 }}</label>
        <label style="font-size: 24px;">{{ translatedText.請假人數 }}: {{ item.請假人數 !== undefined ? item.請假人數 : 0 }}</label>
        <label style="font-size: 24px;">{{ translatedText.流水線在線人數 }}: {{ item.在線人數 !== undefined ? item.在線人數 : 0 }}</label>
        <label style="font-size: 24px;">{{ translatedText.借入人數 }}: {{ item.借入人數 !== undefined ? item.借入人數 : 0 }}</label>
        <label style="font-size: 24px;">{{ translatedText.借出人數 }}: {{ item.借出人數 !== undefined ? item.借出人數 : 0 }}</label>
        <button @click="RESET" style="float: right;">RESET</button>

      

      </div>
    <hr></hr>




    <table>
        <caption style="font-size: 24px;">{{ translatedText.工單列表 }}</caption>
        <thead>
          <tr>
            <th>{{ translatedText.ID }}</th>
            <th>{{ translatedText.工單 }}</th>
            <th>{{ translatedText.品名 }}</th>
            <th>{{ translatedText.數量 }}</th>
            <th>{{ translatedText.標準工時 }}</th>
            <th>{{ translatedText.執行工時 }}</th>
            <th>{{ translatedText.當前效率 }}</th>
            <th>{{ translatedText.過往效率 }}</th>
            <th>{{ translatedText.做線 }}</th>
            <th>{{ translatedText.焊接 }}</th>
            <th>{{ translatedText.成型 }}</th>
            <th>{{ translatedText.已完成數量 }}</th>
            <th>{{ translatedText.ERP入庫數量 }}</th>
 

          </tr>
        </thead>
      
        <tbody>
          <template v-for="(item, index) in realTimeData">
           <!--  <template v-if="(index === 0 || item.NFC_CODE !== realTimeData[index - 1].NFC_CODE) "> -->
            <template v-if="(index === 0 || item.NFC_CODE !== realTimeData[index - 1].NFC_CODE) || (item.NFC_CODE == realTimeData[index - 1].NFC_CODE && realTimeData[index - 1].Trans_id == 'LOT_PAUSE')">

              <!-- 只在編號的第一行渲染 -->
              <tr :key="item.WO_ID" v-if="item.Trans_id !== 'LOT_PAUSE'">
                <td :rowspan="getRowSpan(index)" :style="{ backgroundColor: getBackgroundColor(item.NFC_CODE), textAlign: 'center', verticalAlign: 'middle' }">{{ item.NFC_CODE }}</td>
                <td :style="{ backgroundColor: getBackgroundColor(item.NFC_CODE), textAlign: 'center', verticalAlign: 'middle' }">{{ item.WO_ID }}</td>
                <td >{{ item.PART_DESC }}</td>
                <td>{{ item.qty }}</td>
                <td>{{ item.std }}</td>
                <td v-if="item.time > 0">{{ item.time.toFixed(2) }}</td>
                <td v-else>{{ translatedText.未生產 }}</td>
                <!--  <td v-if="item.time > 0">{{ (item.std / item.time * 100).toFixed(2) }}%</td>
                <td v-else></td>-->
                <td v-if="item.FQC > 0">{{ (((item.FQC / item.time )/(item.qty/item.std))*100).toFixed(2) }}%</td>
                <td v-else></td>
                <td v-if="item.PasstEFF > 0 ">{{ (item.PasstEFF * 100).toFixed(2) }}%</td>
                <td v-else>近一年無生產</td>
                <td v-if="index === 0" :rowspan="realTimeData.length">{{ item.LINE }}</td>
                <td v-if="index === 0" :rowspan="realTimeData.length">{{ item.WELD }}</td>
                <td v-if="index === 0" :rowspan="realTimeData.length">{{ item.MD }}</td>
                <td v-if="item.FQC > 0">{{ item.FQC}}</td>
                <td v-else></td>
                <td v-if="item.ship_qty > 0">{{ item. ship_qty }}</td>
                <td v-else></td>

              </tr>
            </template>
            <template v-else>
              <!-- 編號相同的其他行 -->
              <tr :key="item.WO_ID"  v-if="item.Trans_id !== 'LOT_PAUSE'">
                <td :style="{ backgroundColor: getBackgroundColor(item.NFC_CODE), textAlign: 'center', verticalAlign: 'middle' }">{{ item.WO_ID }}</td>
                <td >{{ item.PART_DESC }}</td>
                <td>{{ item.qty }}</td>
                <td>{{ item.std }}</td>
                <td v-if="item.time > 0">{{ item.time.toFixed(2) }}</td>
                <td v-else>未生產</td>
                <td v-if="item.FQC > 0">{{ (((item.FQC / item.time )/(item.qty/item.std))*100).toFixed(2) }}%</td>
                <td v-else></td>
                <td v-if="item.PasstEFF > 0 ">{{ (item.PasstEFF * 100).toFixed(2) }}%</td>
                <td v-else>近一年無生產</td>
                <td v-if="item.FQC > 0">{{ item.FQC}}</td>
                <td v-else></td>
                <td v-if="item.ship_qty > 0">{{ item. ship_qty }}</td>
                <td v-else></td>
              </tr>
            </template>
          </template>
        </tbody>
    </table>
      


          <table>
            <caption style="font-size: 24px;">{{ translatedText.工站列表 }}</caption>
            <thead>
              <tr>
                <th>{{ translatedText.設備 }}</th>
                <th>{{ translatedText.姓名 }}</th>
                <th>{{ translatedText.工時 }}</th>
                <th>{{ translatedText.工站 }}</th>
                <th>{{ translatedText.座位 }}</th>
                <th>{{ translatedText.工站 }}</th>
                <th>{{ translatedText.工時 }}</th>
                <th>{{ translatedText.姓名 }}</th>
                <th>{{ translatedText.設備 }}</th>


              </tr>
            </thead>
            <tbody>
                <tr v-for="item in QUERRYTIME" :key="item.seatID" v-show="item.l_NameID !== '' || item.r_NameID !== ''">
                  <td   >{{ item.l_Machine }}</td>
                  <td :title="'工時:'+ ''+  item.l_PT" :style="{ backgroundColor: (item.l_WoID === '' && item.l_NameID !== '') ? 'red' : getBackgroundColor(item.l_NfcCode), textAlign: 'center', verticalAlign: 'middle' }">{{ item.l_NameID }}</td>
                  <td>{{ (item.l_PT * 1).toFixed(2) }}/hr</td>
                  <td
                  :style="
                    item.l_WorkContent === '做線'
                      ? 'color: rgb(255, 211, 6); font-weight: bold;'
                      : item.l_WorkContent === '焊接'
                      ? 'color: blue; font-weight: bold;'
                      : item.l_WorkContent === '成型'
                      ? 'color: purple; font-weight: bold;'
                      : item.l_WorkContent === '成型S'
                      ? 'color: purple; font-weight: bold;background-color: rgb(187, 255, 187);'
                       : item.l_WorkContent === '做線S'
                      ? 'color: rgb(255, 211, 6); font-weight: bold; bold;background-color: rgb(187, 255, 187);'
                      : item.l_WorkContent === '焊接S'
                      ? 'color: blue; font-weight: bold; bold;background-color: rgb(187, 255, 187);'
                      : 'color: black;'
                  "
                >
                  {{ translatedText[item.l_WorkContent] }}
                </td>
                
                  <td>{{ item.seatID }}</td>
                  <td
                  :style="
                        item.r_WorkContent === '做線'
                      ? 'color: rgb(255, 211, 6); font-weight: bold;'
                      : item.r_WorkContent === '焊接'
                      ? 'color: blue; font-weight: bold;'
                      : item.r_WorkContent === '成型'
                      ? 'color: purple; font-weight: bold;'
                      : item.r_WorkContent === '成型S'
                      ? 'color: purple; font-weight: bold;background-color: rgb(187, 255, 187);'
                       : item.r_WorkContent === '做線S'
                      ? 'color: rgb(255, 211, 6); font-weight: bold; bold;background-color: rgb(187, 255, 187);'
                      : item.r_WorkContent === '焊接S'
                      ? 'color: blue; font-weight: bold; bold;background-color: rgb(187, 255, 187);'
                      : 'color: black;'
                  "
                >
                  {{ translatedText[item.r_WorkContent] }}
                </td>
                  <td>{{ (item.r_PT * 1).toFixed(2) }}/hr</td>
                  <td :title="'工時:'+ ''+  item.R_PT"  :style="{ backgroundColor: (item.r_WoID === '' && item.r_NameID !== '') ? 'red' : getBackgroundColor(item.r_NfcCode), textAlign: 'center', verticalAlign: 'middle' }">{{ item.r_NameID }}</td>
                  <td >{{ item.r_Machine }}</td>
             
                </tr>
              </tbody>
          </table>




</div>
<div class="right-content" v-if="wo_selectment">
    <header >{{ translatedText.工單查詢 }}</header>
    <label for="ERP">輸入工單或料號 </label>
    <input id="ERP" type="text" v-model="selectedpart"   >
    <button @click="woselect" :disabled="isButtonDisabled">{{ translatedText.查詢 }}</button>

    <span v-if="selectedpart">料號{{ selectedItemNum }} 品名:{{ selectedItemDesc }}</span>
    <hr></hr>
    <div class="chart-container">
     <canvas id="mixedChart"></canvas>
  </div>

    <table border="1">
      <caption style="text-align: right; font-style: italic;">資料來源: ERP 人時差異(含製費): 直接人工效率差異-實際差異+製造費用差異-實際差異</caption>
      <thead>
          <tr>
              <th>日期</th>
              <th>廠區</th>
              <th>部門</th>
              <th>工單</th>
              <th>數量</th>
              <th>標準工時</th>
              <th>ERP工時</th>
              <th>效率</th>
              <th>人時差異(含製費)</th>
              <th>溢領金額</th>
              <th>溢領比例%</th>
              <th>工單類型</th>
          </tr>
      </thead>
      <tbody>
          <tr v-for="(item, index) in secondResult" :key="index">
              <td>{{ item.WODate }}</td>
              <td>{{ item.WAMMCU }}</td>
              <td>{{ item.Shift }}</td>
              <td  @click="selectwo(item.WONum)" class="clickable">{{ item.WONum }}</td>
              <td>{{ item.UORG }}</td>
              <td>{{ ((item.SWH )*1).toFixed(2)}}</td>
              <td>{{ ((item.AWH )*1).toFixed(2)}}</td>
              <td>{{ item.eff }} %</td>
              <td>{{ item.womoney !== null && typeof item.womoney === 'number' ? item.womoney.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : '-' }}</td>
<td>{{ item.溢領金額 !== null && typeof item.溢領金額 === 'number' ? item.溢領金額.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : '-' }}</td>

              <td v-if="item.溢領比例  !== null && typeof item.溢領比例 === 'number' ">{{ (item.溢領比例 *1).toFixed(2)  }} % </td>
              <td v-else>-</td>
              <td>{{ item.PP }}</td>
          </tr>
          <tr v-if="secondResult.length === 0">
              <td colspan="10" style="text-align:center;">No data available</td>
          </tr>
      </tbody>
  </table>
  <table border="1">
    <thead>
        <tr>
            <th>生產部門</th>
            <th>工作內容</th>
            <!-- 動態生成表頭 -->
            <th v-for="(day, index) in dynamicHeaders" :key="index">{{ day }}</th>
            <th>TOTAL(hrs)</th>
        </tr>
    </thead>
    <tbody>
        <!-- 動態生成表格數據 -->
        <tr v-for="(row, index) in firstResult" :key="index">
            <td>{{ row['生產部門'] }}</td>
            <td>{{ row['工作內容'] }}</td>
            <td v-for="(day, index) in dynamicHeaders" :key="index">
              {{ row[day] *1 ? row[day] : '-' }}
            </td>
            <td>{{(calculateRowTotal(row) ).toFixed(2) }}</td>
        </tr>
        <!-- 顯示每列的加總 -->
        <tr>
            <td><strong>TOTAL(hrs)</strong></td>
            <td></td>
            <td v-for="(day, index) in dynamicHeaders" :key="'total-' + index">
                {{ (calculateColumnTotal(day)).toFixed(2) }}
            </td>
            <td>{{ (calculateGrandTotal()).toFixed(2) }}</td>
        </tr>
        <!-- 如果沒有數據 -->
        <tr v-if="firstResult.length === 0">
            <td colspan="100%" style="text-align:center;">No data available</td>
        </tr>
    </tbody>
</table>

</div>
  <div class="right-content" v-if="wo_mangeContent">
    <header >{{ translatedText.工單管理 }}</header>
<br></br>
    <table>
      <thead>
        <tr>
          <th>{{ translatedText.ID }} </th>
          <th>{{ translatedText.工單 }} </th>
          <th>{{ translatedText.品名 }}</th>
          <th>{{ translatedText.數量 }} </th>
          <th>{{ translatedText.標準工時 }} </th>
          <th>{{ translatedText.過往效率 }} </th>
          <th>{{ translatedText.功能 }}</th>
          <th>{{ translatedText.日期 }}</th>

        </tr>
      </thead>
      <tbody>
<template v-for="(item, index) in realTimeData">
    <template v-if="index === 0 || item.NFC_CODE !== realTimeData[index - 1].NFC_CODE || (item.NFC_CODE == realTimeData[index - 1].NFC_CODE && realTimeData[index - 1].Trans_id == 'LOT_PAUSE') ">
        <tr  :key="item.WO_ID"  v-if="item.Trans_id !== 'LOT_PAUSE'"  >
            <td  :rowspan="getRowSpan(index)" :style="{ backgroundColor: getBackgroundColor(item.NFC_CODE)}">{{ item.NFC_CODE }}</td>
          <td>{{ item.WO_ID }}</td>
          <td>{{ item.PART_DESC }}</td>
          <td>{{ item.qty }}</td>
          <td>{{ item.std }}</td>
          <td v-if="item.PasstEFF > 0 ">{{ (item.PasstEFF * 100).toFixed(2) }}%</td>
          <td v-else>近一年無生產</td>
          <td  :rowspan="getRowSpan(index)" >
            <button @click="completeTask(item.WO_ID, item.NFC_CODE)">{{ translatedText.完成 }}</button>
            <button @click="showRemarkSelect(item.WO_ID, item.NFC_CODE)"> {{ translatedText.暫停 }}</button>
          </td>
        </tr>
        <tr v-else>            
          <td>{{ item.NFC_CODE }}</td>
          <td >{{ item.WO_ID }}</td>
          <td>{{ item.PART_DESC }}</td>
          <td>{{ item.qty }}</td>
          <td>{{ item.std }}</td>
          <td v-if="item.PasstEFF > 0 ">{{ (item.PasstEFF * 100).toFixed(2) }}%</td>
          <td v-else>近一年無生產</td>
          <td >
            <button :disabled="isButtonDisabled" @click="REWORK(item)">{{ translatedText.復工 }}</button>
          </td>
          <td>{{ item.rework_date }}
            <button
              :disabled="isButtonDisabled"
              @click="openDateDialog(item.ID)"
            >
              {{ translatedText.調整 }}
            </button>
          </td>
        </tr>
    </template>
 <template v-else>
    <tr  :key="item.WO_ID"  v-if="item.Trans_id !== 'LOT_PAUSE'  "  >
      <td >{{ item.WO_ID }}</td>
      <td>{{ item.PART_DESC }}</td>
      <td>{{ item.qty }}</td>
      <td>{{ item.std }}</td>
      <td v-if="item.PasstEFF > 0 ">{{ (item.PasstEFF * 100).toFixed(2) }}%</td>
      <td v-else>N/A</td>
    </tr>
    <tr v-else>            
      <td >{{ item.WO_ID }}</td>
      <td>{{ item.PART_DESC }}</td>
      <td>{{ item.qty }}</td>
      <td>{{ item.std }}</td>
      <td v-if="item.PasstEFF > 0 ">{{ (item.PasstEFF * 100).toFixed(2) }}%</td>
      <td v-else>近一年無生產</td>
      <td >
        <button :disabled="isButtonDisabled" @click="REWORK(item)">{{ translatedText.復工 }}</button>
      </td>
    </tr>

</template>
</template>
      </tbody>
    </table>
    <hr></hr>
    <hr></hr>
    <label for="ERP">{{ translatedText.輸入工單 }}</label>
    <input id="ERP" type="text" v-model="selectedERP"  @keydown.enter="checkAndSelectERP" >

    <button type="button" @click="checkAndSelectERP" :disabled="isButtonDisabled" @keydown.enter="checkAndSelectERP">
      {{ translatedText.查詢 }}
    </button>
    <label>
      <input type="radio" v-model="Stickers" value="GEN">
      N/A
    </label>
    <label>
      <input type="radio" v-model="Stickers" value="TZ">
      {{ translatedText.貼紙班 }} 
    </label>
    <label>
      <input type="radio" v-model="Stickers" value="CD">
      {{ translatedText.裁剝班 }} 
    </label>
    


    <label >  {{ translatedText.workOrder1 }}</label>


    <hr></hr>
    <table>
        <caption style="font-size: 18px;">{{ translatedText.設定工單列表 }}</caption>
      <thead>
        <tr>

          <th>{{ translatedText.工單 }}</th>
          <th>{{ translatedText.料號 }}</th>
          <th>{{ translatedText.品名 }}</th>
          <th>{{ translatedText.數量 }}</th>
          <th>{{ translatedText.標準工時 }}</th>
          <th>{{ translatedText.過往效率 }}</th>
          <th>{{ translatedText.功能 }}</th> <!-- 新添加的列标题 -->
       
        </tr>
      </thead>
      <tbody>
        <tr v-for="item in ERPDATA" :key="item.wadoco" >
          <td >{{ item.wadoco }}</td>
          <td>{{ item.walitm }}</td>
          <td>{{ item.wadl01 }}</td>
          <td>{{ item.wauorg }}</td>
          <td>{{ item.wlrunl_sum }}</td>
          <td>{{ (item.avgStdEff * 100).toFixed(2)}}%</td>
          <td><button @click="removeRow(item)">{{ translatedText.移除 }}</button></td> <!-- 新添加的移除按钮 -->
        </tr>
        <tr>
            <td colspan="3">{{ translatedText.總和 }}</td>
            <td>{{ calculateTotal('wauorg') }}</td>
            <td>{{ calculateTotal('wlrunl_sum').toFixed(2) }}</td>
          </tr>
      </tbody>
    </table>

    <template>
      <div>
        <!-- 彈出視窗 -->
        <div v-if="showSelect" class="modal">
          <div class="modal-content">
            <span class="close" @click="closeModal">&times;</span>
            <h3>請選擇暫停原因</h3>
            <select v-model="selectedRemark" style="margin-top: 10px; width: 100%;">
              <option disabled value=""></option>
              <option value="生管通知暂停">生管通知暂停</option>
              <option value="物料欠料(工單欠料)">物料欠料(工單欠料)</option>
              <option value="物料欠料(益領欠料)">物料欠料(益領欠料)</option>
              <option value="物料異常">物料異常</option>
              <option value="不良品無法出理">不良品無法出理</option>
              <option value="模製具異常">模製具異常</option>
              <option value="設備異常">設備異常</option>
            </select>
          <!--   <h3>預計復工日期</h3>
            <input
              type="date"
              v-model="selectedpauseDate"
              style="margin-top: 10px; width: 100%;"
            />-->
            <div style="margin-top: 15px;">
              <button @click="closeModal" style="margin-right: 10px;">取消</button>
              <button @click="pauseTask">確認</button>
            </div>
          </div>
        </div>
      </div>
    </template>

  <!-- 日期選擇對話框 -->
  <div v-if="showDialog" class="modal">
    <div class="modal-content">
      <h3>選擇日期</h3>
      <input
        type="date"
        v-model="selectedDate"
      />
      <div style="margin-top: 15px;">
        <button @click="updateReworkDate">確定</button>
        <button @click="closeDialog">取消</button>
      </div>
    </div>
  </div>

    <hr></hr>
    <label for="dpSelect">{{ translatedText.choose }}:</label>
    <select id="dpSelect" v-model="selectednfccode" >
      <option v-for="dpOption in dpOptions" :key="dpOption" :value="dpOption">{{ dpOption }}</option>
    </select>
    <button  @click="uploadData">{{ translatedText.提交 }}</button>
    <br>

    <div v-if="showShopFloor">
      <label for="ERP">{{ translatedText.輸入開始序號 }}</label>
      <input id="ERP" type="text" />
      <hr></hr>
      <table>
          <caption style="font-size: 18px;">{{ translatedText.工站管理 }}</caption>
          <thead>
              <tr>
                  <th>{{ translatedText.工站編號 }}</th>
                  <th>{{ translatedText.工站名稱 }}</th>
                  <th>{{ translatedText.綁定工站 }}</th>
                  <th>{{ translatedText.測試工站 }}</th>
              </tr>
          </thead>
          <tbody>
              <tr v-for="item in sfoperator" :key="item.OPERATION_NO">
                  <td>{{ item.OPERATION_NO }}</td>
                  <td>{{ item.OPERATION_DESC }}</td>
                  <td>{{ item.LINK }}</td>
                  <td>{{ item.TEST }}</td>
              </tr>
          </tbody>
      </table>
  </div>
</div>
  <div class="right-content" v-if="fqc_mangeContent">
    <header >{{translatedText.完工數量}}</header>
    <br></br>
    <table>
      <thead>
        <tr>
          <th>{{translatedText.工單}}</th>
          <th>{{translatedText.品名}}</th>
          <th>{{translatedText.數量}}</th>
          <th>{{translatedText.標準工時}}</th>
          <th>{{translatedText.執行工時}}</th>
          <th>{{translatedText.已完成數量}}</th>
          <th>{{translatedText.功能}}</th> <!-- 新增的列 -->

        </tr>
      </thead>
      <tbody>
        <template v-for="(item, index) in realTimeData">

          <!-- 只在編號的第一行渲染 -->
          <tr :key="item.WO_ID" v-if="item.Trans_id !== 'LOT_PAUSE'">
            <td :style="{ backgroundColor: getBackgroundColor(item.NFC_CODE), textAlign: 'center', verticalAlign: 'middle' }">{{ item.WO_ID }}</td>
            <td>{{ item.PART_DESC }}</td>
            <td>{{ item.qty }}</td>
            <td>{{ item.std }}</td>
            <td v-if="item.time > 0">{{ item.time.toFixed(2) }}</td>
            <td v-else>未生產</td>
            <td>
        
              <input type="number" v-model="item.FQC" @change="validateInput(item)">
        
              <br>
               <span v-if="item.inputError" style="color: red;">{{translatedText.fqcer1}}</span>
               <span v-if="item.inputError2" style="color: red;">{{translatedText.fqcer2}}</span>
            </br>
            </td>
            <td>
              <button @click="completeWorkOrder(item.WO_ID, item.FQC)">{{translatedText.提交}}</button>
            </td>
          </tr>
        </template>
      </tbody>


    </table>
    <header >{{translatedText.星級完成數量}}</header>
    <br></br>
    <button style="float: right;" @click="updateAllRatings">{{ translatedText.提交 }}</button>  
    <table>
      <thead>
        <tr>
          <th>{{translatedText.日期}}</th>
          <th>{{translatedText.工號}}</th>
          <th>{{translatedText.姓名}}</th>
          <th>{{translatedText.工站}}</th>
          <th>{{translatedText.執行工時}}/H</th>
          <th>08-10</th>
          <th>10-12</th>
          <th>13-15</th>
          <th>15-17</th>
          <th>17-20</th>
          <th>{{translatedText.已完成數量}}</th>
      <!--    <th>{{translatedText.功能}}</th>  新增的列 -->

        </tr>
      </thead>
      <tbody>
        <template v-for="(item, index) in RATING_data">

          <!-- 只在編號的第一行渲染 -->
          <tr >
            <td>{{ item.MFG_DAY }}</td>
            <td>{{ item.JOB_NUMBER }}</td>
            <td>{{ item.USER_NAME }}</td>
            <td>{{ item.WORK_CONTENT }}</td>
            <td>{{ item.DATE_MINUTE }}</td>
      <!-- 各时间段的输入框 -->
      <td> <input type="number"  v-model="item.COMPLETED_QTY_1"  class="short-input"> </td>
      <td> <input type="number"  v-model="item.COMPLETED_QTY_2"  class="short-input"> </td>
      <td> <input type="number"  v-model="item.COMPLETED_QTY_3"  class="short-input"> </td>
      <td> <input type="number"  v-model="item.COMPLETED_QTY_4"  class="short-input"> </td>
      <td> <input type="number"  v-model="item.COMPLETED_QTY_5"  class="short-input"> </td>

      <!-- 已完成数量为五个时间段的总和 -->
      <td>{{ calculateTotalCompletedQty(item) }}

        <br>
        <span v-if="item.inputError" style="color: red;">{{translatedText.fqcer1}}</span>
        <span v-if="item.inputError2" style="color: red;">{{translatedText.fqcer2}}</span>
        </br>
      </td>

          <!--      <td>
              <button @click="updateRATINGDate(item.id, item.COMPLETED_QTY_1,item.COMPLETED_QTY_2,item.COMPLETED_QTY_3,item.COMPLETED_QTY_4,item.COMPLETED_QTY_5,   calculateTotalCompletedQty(item))">{{translatedText.提交}}</button>
            </td>-->
          </tr>
        </template>
      </tbody>
    </table>
</div>
  <div class="right-content" v-if="seat_mangeContent">
    <header >{{ translatedText.工站管理 }}</header>
    <br></dbr>
    
    <button v-if="!seateditMode"  @click="enableseatEditMode" >{{ translatedText.修改 }}</button>
    <button @click="canceseatlEdit" >{{ translatedText.取消 }} </button>

    <button v-if="seateditMode" @click="addSeat" >{{ translatedText.增加座位 }}</button> 
    <button v-if="seateditMode" @click="removeSeat" >{{ translatedText.刪除座位 }}</button> 

    <button v-if="seateditMode" @click="completeSeat" >{{ translatedText.完成 }}</button> 
    <div v-if="showseatForm">
      <form @submit.prevent="inputseat">
        <table>
        <thead>
          <tr>
            <th>{{ translatedText.卡機號 }}_L</th>
            <th>{{ translatedText.工站名稱 }}_L</th>
            <th>{{ translatedText.座位 }}</th>
            <th>{{ translatedText.工站名稱 }}_R</th>
            <th>{{ translatedText.卡機號 }}_R</th>
          </tr>
        </thead>
        <tbody>
          <tr>
          <td><input v-model="newSeat.machine_L" @change="checkDuplicate(newSeat.machine_L,'machine_L')" required /></td>
          <td>
            <select id="work_content_R" v-model="newSeat.work_content_L">
              <option value="一般">{{ translatedText.一般 }}</option>
              <option value="做線">{{ translatedText.做線 }}</option>
              <option value="焊接">{{ translatedText.焊接 }}</option>
              <option value="成型">{{ translatedText.成型 }}</option>
          </td>
          <td><input v-model="newSeat.seatID" :value="this.seatData.length + 1" required /></td>
          <td>
            <select id="work_content_R" v-model="newSeat.work_content_R">
              <option value="一般">{{ translatedText.一般 }}</option>
              <option value="做線">{{ translatedText.做線 }}</option>
              <option value="焊接">{{ translatedText.焊接 }}</option>
              <option value="成型">{{ translatedText.成型 }}</option>
          </td>
          <td><input v-model="newSeat.machine_R"  @change="checkDuplicate(newSeat.machine_R,'machine_R')"  /></td>

          </tr>
        </tbody>

        
      </table>
      <button type="submit">{{ translatedText.insert }}</button>
      </form>
     </div>
  <table>
    <thead>
      <tr>
        <th  v-if="showActions">{{ translatedText.delete }}</th>
        <th>{{ translatedText.卡機號 }}_L</th>
        <th>{{ translatedText.工站名稱 }}_L</th>
        <th>{{ translatedText.座位 }}</th>
        <th>{{ translatedText.工站名稱 }}_R</th>
        <th>{{ translatedText.卡機號 }}_R</th>
      </tr>
    </thead>
    <tbody>
      <p v-if="this.hostMachine && this.hostMachine.length > 0 && this.hostMachine[0].HOSTID">hostid: {{ this.hostMachine[0].HOSTID }}</p>

      <tr  v-for="(item, index) in seatData" :key="item.seatID">
        <td  v-if="showActions" > 
    
            <button @click="DELETESEATtb(index)">刪除</button>
 
        </td>
        <td v-if="!item.editMode">{{ item.machine_L }}</td>
        <td v-else><input v-model="item.machine_L " @change="checkDuplicate2(item.machine_L,'machine_L',item)"> </td>
        <td v-if="!item.editMode">{{ translatedText[item.work_content_L] }}</td>
        <td v-else>
          <select id="work_content_R" v-model="item.work_content_L">
            <option value="一般">{{ translatedText.一般 }}</option>
            <option value="做線">{{ translatedText.做線 }}</option>
            <option value="焊接">{{ translatedText.焊接 }}</option>
            <option value="成型">{{ translatedText.成型 }}</option>
        </td>
        <td>{{ item.seatID }}</td>
        <td v-if="!item.editMode">{{ translatedText[item.work_content_R]  }}</td>
        <td v-else>
          <select id="work_content_R" v-model="item.work_content_R">
            <option value="一般">{{ translatedText.一般 }}</option>
            <option value="做線">{{ translatedText.做線 }}</option>
            <option value="焊接">{{ translatedText.焊接 }}</option>
            <option value="成型">{{ translatedText.成型 }}</option>
        </td>
        <td v-if="!item.editMode">{{ item.machine_R }}</td>
        <td v-else><input v-model="item.machine_R " @change="checkDuplicate(newSeat.machine_R)"> </td>
      </tr>
    </tbody>
  </table>
</div>
<div class="right-content" v-if="staff_mangeContent">
  <label >{{ translatedText.area }}:</label>
  <select id="areaSelect" v-model="selectedArea" @change="handleInputChange">
    <option value="ZH">ZH</option>
    <option value="TC">TC</option>
    <option value="VN">VN</option>
    <option value="TW">TW</option>
  </select>

  <label >{{ translatedText.部門 }}:</label>
  <select id="DSelect" v-model="selectedD" @change="handleInputChange">
      <option value="1">1</option>                                                     
      <option value="2">2</option>                                                                                 
      <option value="3">3</option> 
      <option value="4">4</option>
      <option value="6">6</option>
    </select>
  <label >{{ translatedText.D }}</label>
  <select id="SSelect" v-model="selectedS" @change="handleInputChange">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
    </select>
  <label >{{ translatedText.S }}</label>
  <select id="CSelect" v-model="selectedC" @change="handleInputChange">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="S1">S1</option>
      <option value="S2">S2</option>
      <option value="S3">S3</option>
      <option value="S4">S4</option>
      <option value="S5">S5</option>
      <option value="S6">S6</option>
    </select>

  <label >{{ translatedText.C }}</label>
  <header >{{ translatedText.人員管理 }}</header>
  <br></br>
   <button @click="new_staff" >{{ translatedText.New }}</button>
   <button @click="show_delete" >{{ translatedText.delete }}</button>
   <button @click="show_UPDATE" >{{ translatedText.修改 }}</button>
   <button @click="show_CANCLE" >{{ translatedText.取消 }}</button>
   <div v-if="showForm">
    <form @submit.prevent="addNewStaff">
      <label>{{ translatedText.部門 }}</label>
      <input v-model="newStaff.department"  required />

      <label>{{ translatedText.工號 }}</label>
      <input v-model="newStaff.jobnumber" required />

      <label>{{ translatedText.姓名 }}</label>
      <input v-model="newStaff.username" required />

      <label>{{ translatedText.工作拉 }}</label>
      <input v-model="newStaff.work_department"  />


      <button type="submit">{{ translatedText.完成 }}</button>
    </form>
  </div>
    <table>
        <thead>
          <tr>
            <th  class="number-column"> {{ translatedText.ID }}  </th>
            <th  class="number-column">{{ translatedText.出勤 }}</th>
            <th class="number-column">{{ translatedText.部門 }}</th>
            <th class="number-column">{{ translatedText.工作拉 }}</th>
            <th class="number-column">{{ translatedText.工號 }}</th>
            <th class="number-column">{{ translatedText.姓名 }}</th>
            <th class="number-column">{{ translatedText.備註 }}</th>
            <th v-if="!showActions">{{ translatedText.Status }}</th>
            <th class="number-column" v-if="!showActions">{{ translatedText.工作部門 }}</th>
            <th v-if="!showActions">{{ translatedText.事由 }}</th>
            <th v-if="showActions">{{ translatedText.功能 }}</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(item, index) in staffData" :key="item.id">
            <td :style="item.online === '01' ? (item.out_department.length > 9 ? { backgroundColor: 'red' } : { backgroundColor: '#19f032' }) : {}">
              {{ index + 1 }}
            </td> 
            <td> <input type="checkbox" :checked="item.show === 'T'" @change="toggleStatus(item.id,item.show)"></td> 
            <td>
              <template v-if="item.editable">
                <input v-model="item.department" required>
              </template>
              <template v-else>
                {{ item.department }}
              </template>
            </td>
            <td>
              <template v-if="item.editable">
                <input v-model="item.work_department" required>
              </template>
              <template v-else>
                {{ item.work_department }}
              </template>
            </td>
            <td>
              <template v-if="item.editable">
                <input v-model="item.jobnumber" required>
              </template>
              <template v-else>
                {{ item.jobnumber }}
              </template>
            </td>
            <td class="number-column">
              <template v-if="item.editable">
                <input v-model="item.username" required>
              </template>
              <template v-else>
                {{ item.username }}
              </template>
            </td>
            <td class="number-column">
              <template v-if="item.editable">
                <input v-model="item.remark" required>
              </template>
              <template v-else>
                {{ item.remark }}
              </template>
            </td>
            <td class="number-column" v-if="!showActions">
              <span v-if="item.status === '年休' || item.status === '請假' || item.status === '哺乳假' || item.status === '工傷' || item.status === '工傷陪護' || item.status === '借出' || item.status === '新進員工' || item.status === '夜班'|| item.status === '備註'">       
                {{ translatedText[item.status] }}，({{ translatedText.應報考勤 }}:{{ item.hr_time }}/hr) <button @click="delete_hr(item.id)" >{{ translatedText.取消 }}</button>
            </span>
            <span v-else>
                <button @click="updateStatus(item.jobnumber, '年休')">{{ translatedText.年休 }}</button>
                <button @click="updateStatus(item.jobnumber, '請假')">{{ translatedText.請假 }}</button>
                <button @click="updateStatus(item.jobnumber, '哺乳假')">{{ translatedText.哺乳假 }}</button>
                <button @click="updateStatus(item.jobnumber, '工傷')">{{ translatedText.工傷 }}</button>
                <button @click="updateStatus(item.jobnumber, '工傷陪護')">{{ translatedText.工傷陪護 }}</button>
                <button @click="updateStatus(item.jobnumber, '借出')">{{ translatedText.借出 }}</button>
                <button @click="updateStatus(item.jobnumber, '夜班')">{{ translatedText.夜班 }}</button>
                <button @click="updateStatus(item.jobnumber, '備註')">{{ translatedText.備註 }}</button>
            </span>
            </td>
            <td v-if="!showActions && item.department.substring(0, 6) !== item.out_department">
              {{ item.out_department }}
            </td>
            <td v-else="!showActions">
            
            </td>
            <td v-if="!showActions">{{ item.note }}</td>
            <td  v-if="showActions" > 
              <template v-if="item.editable">
                <button @click="UPDATE_staffData(item)">{{ translatedText.完成 }}</button>
              </template>
              <template v-else>
                <button @click="delete_staffData(item.id)">{{ translatedText.delete }}</button>
              </template>
     
            </td>
          </tr>
        </tbody>
      </table>
      

</div>
<div class="right-content" v-if="ATT_ADJ_confirm">
  <label >{{ translatedText.area }}:</label>
  <select id="PDareaSelect" v-model="selectedArea" @change="att_hr_SUM_ADJ">
    <option value="ZH">ZH</option>
    <option value="TC">TC</option>
    <option value="VN">VN</option>
    <option value="TW">TW</option>
  </select>
  日期<input type="date" v-model="selectedDate" @change="att_hr_SUM_ADJ" >
  <button @click="executeSelected" :disabled="isButtonDisabled">{{ translatedText.提交 }}</button>
  <table id="ADJ2">
    <thead>
      <tr>
        <th>{{ translatedText.日期 }}</th>
        <th>{{ translatedText.部門 }}</th>
        <th>{{ translatedText.工號 }}</th>
        <th>{{ translatedText.姓名 }}</th>
        <th>{{ translatedText.系統計算考勤工時 }}</th>
        <th>{{ translatedText.調整 }}</th>
        <th>{{ translatedText.事由 }}</th>
        <th>
          全選<input type="checkbox" @change="toggleSelectAll" v-model="selectAll">
        </th>
      </tr>
    </thead>
    <tbody style="overflow-y: scroll" >
      <template v-for="(item, index) in ATT_time_ADJ_data">
       <tr v-if="Number(item.出勤人數) !== 0"  :key="item.部門">

        <td>{{ item.mfG_DAY }}</td>
        <td >{{ item.department }}</td>
  
        <td>{{ item.jobnumber}}</td>
        <td>{{ item.username}} </td>
        <td> {{ (item.attenD_TIME)*1}}</td>
        <td> {{ (item.adj_time)}}</td>
        <td> {{ (item.adj_reson)}}</td>
        <td>
          <input type="checkbox" v-model="item.selected">
        </td>
       </tr>
     </template>
    </tbody>
  </table>



</div>
<div class="right-content" v-if="ATT_timeContent">
  <label >{{ translatedText.area }}:</label>
  <select id="PDareaSelect" v-model="selectedArea" @change="att_hr_SUM_data">
    <option value="ZH">ZH</option>
    <option value="TC">TC</option>
    <option value="VN">VN</option>
    <option value="TW">TW</option>
  </select>
  <input type="date" v-model="selectedDate" @change="att_hr_SUM_data">

  <br></br>
  <header > {{ selectedDate}}{{ translatedText.考勤日報 }}</header>
  <table id="stff3">
 
    <thead>
      <tr>
        <th  class="number-column">{{ translatedText.show }}<input type="checkbox" @change="toggleATTSelectAll" v-model="WOselectAll"></th>
        <th>{{ translatedText.部門 }}</th>
        <th>{{ translatedText.出勤人數 }}</th>
        <th>{{ translatedText.實際掛卡工時 }}</th>
        <th>{{ translatedText.系統計算考勤工時 }}</th>
        <th>{{ translatedText.回報管理部考勤工時 }}</th>
        <th>{{ translatedText.差異 }}</th>
        <th>{{ translatedText.原因 }}</th>
      </tr>
    </thead>

    <tr >
      <td colspan="2">{{ translatedText.加總 }}</td>
      <td>{{ calculateTotal_hrsum('出勤人數') }}</td>
      <td>{{ calculateTotal_hrsum('實際工時').toFixed(2) }}</td>
      <td>{{ calculateTotal_hrsum('考勤工時')+ calculateTotal_hrsum('調整工時')}}</td>
      <td>{{ calculateTotal_hrsum('考勤工時')+ calculateTotal_hrsum('調整工時') + calculateTotal_hrsum('人工調整')}}</td>
      <td>{{ calculateTotal_hrsum('人工調整') }}</td>
      <td></td>
    </tr>
    <tbody style="overflow-y: scroll" >
      <template v-for="(item, index) in ATT_time_SUM_data">
       <tr v-if="Number(item.考勤工時)+Number(item.調整工時) !== 0"  :key="item.部門">
        <td>
          <input class="ATT_INPUT" type="checkbox" v-model="showInSecondTable[item.部門]" @click="att_hr_data(item.部門)" >
        </td>
        <td  v-if="index === 0 || item.部門 !== ATT_time_SUM_data[index - 1].部門" :rowspan="countShiftDesc(index,ATT_time_SUM_data)">{{ formatDepartment(item.部門) }}</td>
        <td>{{ item.出勤人數 }}</td>
        <td >{{ item.實際工時 }}</td>
  
        <td>{{ (item.考勤工時)*1 + (item.調整工時)*1 }}</td>
        <td>{{ (item.考勤工時)*1 + (item.調整工時)*1  + (item.人工調整)*1}} </td>
        <td> {{ (item.人工調整)*1}}</td>
        <td> {{ (item.調整原因)}}</td>

       </tr>
     </template>
    </tbody>
  </table>

  <hr></hr>
  <div class="container">
  <button @click=" downloadExcel" class="export-button">{{ translatedText.導出 }} Excel</button>
 
  </div>
  <table id="stff">
    <thead>
      <tr >
        <th  class="number-column">{{ translatedText.部門 }}</th>
        <th  class="number-column">{{ translatedText.工作拉 }}</th>
        <th  class="number-column">{{ translatedText.工號 }}</th>
        <th  class="number-column">{{ translatedText.姓名 }}</th>
        <th  class="number-column">{{ translatedText.實際掛卡工時 }}</th>
        <th  class="number-column">{{ translatedText.系統計算考勤工時 }}</th>
        <th  >{{ translatedText.調整 }}</th>
        <th  class="number-column">{{ translatedText.回報管理部考勤工時 }}</th>
        <th  class="number-column">{{ translatedText.正班工時 }}</th>
        <th  class="number-column">{{ translatedText.加班工時 }}</th>
        <th  >{{ translatedText.假別 }}</th>
        <th  >{{ translatedText.事由 }}</th>
        <th>{{ translatedText.差異 }}{{ translatedText.原因 }}</th>
      </tr>
    </thead>

    <tbody style="overflow-y: scroll">
      <template v-for="(item, index) in ATT_time_data">
        <!-- 添加用于显示部门总和的行 -->
        <tr v-if="(index === 0 || item.部門 !== ATT_time_data[index - 1].部門) && showInSecondTable[item.部門]" style="background-color: lightblue">
          <td>{{ formatDepartment(item.部門) }}</td>
          <td colspan="3">{{ translatedText.部門 }}{{ translatedText.加總 }}</td>
          <td>{{ calculateDepartmentTotal('實際工時', item.部門).toFixed(2) }}</td>
          <td>{{ (calculateDepartmentTotal('調整工時', item.部門) + calculateDepartmentTotal('考勤工時', item.部門)).toFixed(1) }}</td>
          <td>{{ calculateDepartmentTotal('手動調整工時', item.部門) }}</td>
          <td>{{ (calculateDepartmentTotal('調整工時', item.部門) + calculateDepartmentTotal('考勤工時', item.部門) + calculateDepartmentTotal('手動調整工時', item.部門)).toFixed(1) }}</td>
          <td>{{ (calculateExcessHoursTotal(item.部門)).toFixed(1)  }}</td>
          <td>{{ (calculateDepartmentTotal('調整工時', item.部門) + calculateDepartmentTotal('考勤工時', item.部門) + calculateDepartmentTotal('手動調整工時', item.部門)).toFixed(1) - calculateExcessHoursTotal(item.部門) }}</td>
          <td colspan="3"></td>
        </tr>
    
        <tr :key="item.部門" v-if="showInSecondTable[item.部門]">
          <td v-if="index === 0 || item.部門 !== ATT_time_data[index - 1].部門" :rowspan="countShiftDesc(index, ATT_time_data)">{{ formatDepartment(item.部門) }}</td>
          <td>{{ item.排拉 }}</td>
          <td @click="fetchAttendanceData(item.工號, item.姓名)" class="clickable">{{ item.工號 }}</td>
          <td class="number-column">{{ item.姓名 }}</td>
          <td>{{ ((item.實際工時)*1).toFixed(2) }}</td>
          <td>{{ (item.考勤工時) * 1 + (item.調整工時) * 1 }}</td>
          <td v-if="item.手動調整工時 != 0">{{ item.手動調整工時 }}</td><!-- 增加有效考勤 -->
          <td v-else><button @click="showAdjustmentDialog(item)">{{ translatedText.調整 }}</button></td>
          <td>{{ (item.調整工時) * 1 + (item.考勤工時) * 1 + (item.手動調整工時) * 1 }}</td><!-- 總考勤 -->
          <td v-if="((item.調整工時) * 1 + (item.考勤工時) * 1 + (item.手動調整工時) * 1) >= 8">8</td>
          <td v-else>{{ (item.調整工時) * 1 + (item.考勤工時) * 1 + (item.手動調整工時) * 1 }}</td><!-- 考勤 -->
          <td v-if="((item.調整工時) * 1 + (item.考勤工時) * 1 + (item.手動調整工時) * 1) >= 8">{{ ((item.調整工時) * 1 + (item.考勤工時) * 1) + (item.手動調整工時) * 1 - 8 }}</td>
          <td v-else>0</td>
          <td>{{ item.假別 }}</td>
          <td>{{ item.事由 }}</td>
          <td>{{ item.調整理由 }}</td>
        </tr>
        
      </template>
    </tbody>

    
  </table>
  <div v-if="attendanceData.length > 0" class="dialogA">
    <h3>NFC考勤資料 - {{ selectedJobNumber }} - {{ selectedName }} </h3>
    <table  class="scrollable-table">
      <thead>
        <tr>
          <th>放卡時間 </th>
          <th>拿卡時間 </th>
          <th>工單部門 </th>
          <th>工單號 </th>
          <th>工時(分鐘) </th>
          <th>工作內容 </th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="data in attendanceData" :key="data.check_in_time">
          <td>{{ data.check_in_time }}</td>
          <td>{{ data.check_out_time }}</td>
          <td>{{ data.wO_DEPARTMENT }}</td>
          <td>{{ data.wO_ID }}</td>
          <td>{{ data.elapsed_time }}</td>
          <td>{{ data.work_content }}</td>
        </tr>
      </tbody>
    </table>
    <button @click="attendanceData = []">關閉 </button>
  </div>
  <div v-if="showDialog" class="dialog-overlay">
    <div class="dialog">
      <h3>調整工時</h3>
      <label>工時:
        <input type="number" v-model="adjustmentValue" step="0.5">
      </label>

      <br></br>
      <label>原因:
        <select v-model="selectedreson">
          <option v-for="reson in resons" :value="reson">{{ reson }}</option>
        </select>
      </label>
      <br></br>
      <button @click="applyAdjustment">確定</button>
      <button @click="closeDialog">取消</button>
    </div>
  </div>
  <dvi >
  <table id="stff2" style="display: none;" >
    <thead>
      <tr> <th colspan="8">{{ selectedDate}}考勤日報</th></tr>
      <tr>

        <th>{{ translatedText.部門 }}</th>
        <th>{{ translatedText.出勤人數 }}</th>
        <th>{{ translatedText.實際掛卡工時 }}</th>
        <th>{{ translatedText.系統計算考勤工時 }}</th>
        <th>{{ translatedText.回報管理部考勤工時 }}</th>
        <th>{{ translatedText.差異 }}</th>
        <th>{{ translatedText.原因 }}</th>
     
      </tr>
    </thead>

    <tbody style="overflow-y: scroll" >
      <tr>
        <td colspan="1">{{ translatedText.加總 }}</td>
        <td>{{ calculateTotal_hrsum('出勤人數') }}</td>
        <td>{{ calculateTotal_hrsum('實際工時').toFixed(2) }}</td>
        <td>{{ calculateTotal_hrsum('考勤工時')+ calculateTotal_hrsum('調整工時')}}</td>
        <td>{{ calculateTotal_hrsum('考勤工時')+ calculateTotal_hrsum('調整工時')+ calculateTotal_hrsum('人工調整')}}</td>
        <td>{{ calculateTotal_hrsum('人工調整') }}</td>
        <td></td>
      </tr>
      <template v-for="(item, index) in ATT_time_SUM_data">
       <tr :key="item.部門" v-if="showInSecondTable[item.部門]">
   
        <td  v-if="index === 0 || item.部門 !== ATT_time_SUM_data[index - 1].部門" :rowspan="countShiftDesc(index,ATT_time_SUM_data)">{{ formatDepartment(item.部門) }}</td>
        <td>{{ item.出勤人數 }}</td>
        <td >{{ item.實際工時 }}</td>
  
        <td>{{ (item.考勤工時)*1 + (item.調整工時)*1 }}</td>
        <td>{{ (item.考勤工時)*1 + (item.調整工時)*1  + (item.人工調整)*1}} </td>
        <td> {{ (item.人工調整)*1}}</td>
        <td> {{ (item.調整原因)}}</td>

       </tr>
     </template>

     </tbody>
  </table>
  </dvi>
</div>
<div class="right-content" v-if="ATT_AbnormalContent">
  <table>
    <thead>
      <tr>
        <th>日期</th>
        <th>區域</th>
        <th>工號</th>
        <th>姓名</th>
        <th>工時</th>
        <th>出勤時數</th>
        <th>日工時</th>
        <th>加班時數</th>
        <th>HR時數</th>
      </tr>
    </thead>
    <tbody>
      <tr v-for="(item, index) in ATT_Abnormal_d" :key="index">
        <td>{{ item.mfG_DAY }}</td>
        <td>{{ item.area }}</td>
        <td>{{ item.joB_NUMBER }}</td>
        <td>{{ item.username }}</td>
        <td>{{ item.worK_TIME }}</td>
        <td>{{ item.attenD_TIME }}</td>
        <td>{{ item.daY_TIME }}</td>
        <td>{{ item.over_time }}</td>
        <td>{{ item.hR_time }}</td>
      </tr>
    </tbody>
  </table>

</div>
<div class="right-content" v-if="SHOW_WO_VERSON">
  <label >{{ translatedText.area }}:</label>
  <select id="PDareaSelect" v-model="selectedArea" @change="WO_SUM_VER">
    <option value="ZH">ZH</option>
    <option value="TC">TC</option>
    <option value="VN">VN</option>
    <option value="TW">TW</option>
  </select>

  <input type="date" v-model="selectedDate" @change="WO_SUM_VER">
  <header > {{ selectedDate}}生產日報</header>
  <br></br>

  <table id="WO1" style="display: none;" >

    <tr style="background-color: lightblue">
      <td >{{ translatedText.加總 }}</td>
      <td>{{ calculateTotal_wosum('回報工時') }}</td>
      <td>{{ calculateTotal_wosum('執行工時').toFixed(2)}}</td>
      <td>{{ calculateTotal_wosum('狀態工時').toFixed(2)}}</td>
      <td>{{ calculateTotal_wosum('狀態工時2').toFixed(2)}}</td>
      <td>{{ calculateTotal_wosum('貼紙班').toFixed(2)}}</td>
      <td>{{ calculateTotal_wosum('殘疾人').toFixed(2) }}</td>
      <td>{{ calculateTotal_wosum('無效工時').toFixed(2) }}</td>
      <td>{{ (calculateTotal_wosum('未設定工單')- calculateTotal_wosum('殘疾人')).toFixed(2) }}</td>
      <td>{{ calculateTotal_wosum('借入工時').toFixed(2) }}</td>
      <td>{{ calculateTotal_wosum('借出工時').toFixed(2) }}</td>
      <td>{{ calculateTotal_wosum('調整工時').toFixed(2) }}</td>
      <td></td>
      <td>{{ calculateTotalDifference().toFixed(2) }}</td>
    </tr>
  </thead>
    <tbody style="overflow-y: scroll" >
      <template v-for="(item, index) in WO_SUM_VERSON">
       <tr :key="item.部門" v-if="(index === 0 || item.部門 !== WO_SUM_VERSON[index - 1].部門) && showInSecondTable[item.部門]" >
        <td >{{ (item.部門) }}</td>
        <td>{{ (item.回報工時*1).toFixed(2)  }}</td>
        <td>{{ item.執行工時  }}</td>
        <td>{{ item.狀態工時*1 === 0 ? '' : item.狀態工時  }}</td>
        <td>{{ item.狀態工時2*1 === 0 ? '' : item.狀態工時2  }}</td>
        <td>{{ item.貼紙班  }}</td>
        <td>{{ item.殘疾人*1 === 0 ? '' : item.殘疾人  }} </td>
        <td>{{ item.無效工時 }}</td>
        <td>{{ (item.未設定工單 *1- (item.殘疾人*1)) === 0 ? '': item.未設定工單   }}</td>
        <td>{{ item.借入工時  }}</td>
        <td>{{ item.借出工時  }}</td>
        <td>{{ item.調整工時*1 === 0 ? '' : item.調整工時   }}</td>
        <td style="text-align: left;">{{ item.備註1 }}<br>{{ item.備註3 }}<br>{{ item.備註2 }}<br>{{ item.備註4 }}</td>
        <td>{{ 
          ((item.回報工時 - (item.執行工時*1 + item.狀態工時*1 + item.狀態工時2*1 + item.殘疾人*1 + (item.未設定工單 - item.殘疾人*1) + item.無效工時*1 + item.借出工時*1 - item.借入工時*1 + item.調整工時*1)).toFixed(2) === '0.00' || 
          (item.回報工時 - (item.執行工時*1 + item.狀態工時*1 + item.狀態工時2*1 + item.殘疾人*1 + (item.未設定工單 - item.殘疾人*1) + item.無效工時*1 + item.借出工時*1 - item.借入工時*1 + item.調整工時*1)).toFixed(2) === '-0.00') ? '' : 
          (item.回報工時 - (item.執行工時*1 + item.狀態工時*1 + item.狀態工時2*1 + item.殘疾人*1 + (item.未設定工單 - item.殘疾人*1) + item.無效工時*1 + item.借出工時*1 - item.借入工時*1 + item.調整工時*1)).toFixed(2) 
        }}</td>
              
       </tr>
     </template>
    </tbody>
  </table>
  <table>
    <thead>
      <tr>
        <th  class="number-column">{{ translatedText.show }} <input type="checkbox" @change="toggleWOSelectAll" v-model="WOselectAll"></th>
        <th>{{ translatedText.部門 }}</th>
        <th v-html="'回報管理部<br>考勤工時'"></th>
        <th>ERP工時</th>
        <th v-html="'有薪假<br>(年休/哺乳)'"></th>
        <th v-html="'有薪工時<br>(借出/委外)'"></th>
        <th>貼紙班</th>
        <th>殘疾人</th>
        <th>無效工時</th>
        <th>未設定工單</th>
        <th>借入工時</th>
        <th>借出工時</th>
        <th>調整考勤</th>
        <th>備註</th>
        <th>系統計算差異</th>
      </tr>
      <tr style="background-color: lightblue">
        <td colspan="2">{{ translatedText.加總 }}</td>
        <td>{{ calculateTotal_wosum('回報工時') }}</td>
        <td>{{ calculateTotal_wosum('執行工時').toFixed(2)}}</td>
        <td>{{ calculateTotal_wosum('狀態工時').toFixed(2)}}</td>
        <td>{{ calculateTotal_wosum('狀態工時2').toFixed(2)}}</td>
        <td>{{ calculateTotal_wosum('貼紙班').toFixed(2)}}</td>
        <td>{{ calculateTotal_wosum('殘疾人').toFixed(2) }}</td>
        <td>{{ calculateTotal_wosum('無效工時').toFixed(2) }}</td>
        <td>{{ (calculateTotal_wosum('未設定工單')- calculateTotal_wosum('殘疾人')).toFixed(2) }}</td>
        <td>{{ calculateTotal_wosum('借入工時').toFixed(2) }}</td>
        <td>{{ calculateTotal_wosum('借出工時').toFixed(2) }}</td>
        <td>{{ calculateTotal_wosum('調整工時').toFixed(2) }}</td>
        <td></td>
        <td>{{ calculateTotalDifference().toFixed(2) }}</td> <!-- 新增這一行 -->
      </tr>
    </thead>

    <tbody style="overflow-y: scroll" >
      <template v-for="(item, index) in WO_SUM_VERSON">

       <tr :key="item.部門">
        <td >
          <input class="ATT_INPUT" type="checkbox" v-model="showInSecondTable[item.部門]" @click="WOVER(item.部門)"  >
        </td>
        <td  v-if="index === 0 || item.部門 !== WO_SUM_VERSON[index - 1].部門" :rowspan="countShiftDesc(index,WO_SUM_VERSON)">{{ formatDepartment(item.部門) }}</td>
        <td>{{ item.回報工時  }}</td>
        <td>{{ item.執行工時  }}</td>
        <td>{{ item.狀態工時*1 === 0 ? '' : item.狀態工時  }}</td>
        <td>{{ item.狀態工時2*1 === 0 ? '' : item.狀態工時2  }}</td>
        <td>{{ item.貼紙班  }}</td>
        <td>{{ item.殘疾人*1 === 0 ? '' : item.殘疾人  }} </td>
        <td>{{ item.無效工時 }}</td>
        <td>{{ (item.未設定工單 *1- (item.殘疾人*1)) === 0 ? '': item.未設定工單   }}</td>
        <td>{{ item.借入工時  }}</td>
        <td>{{ item.借出工時  }}</td>
        <td>{{ item.調整工時*1 === 0 ? '' : item.調整工時   }}</td>

        <td style="text-align: left;">
          <span v-if="item.備註1">{{ item.備註1 }}<br></span>
          <span v-if="item.備註3">{{ item.備註3 }}<br></span>
          <span v-if="item.備註2">{{ item.備註2 }}<br></span>
          <span v-if="item.備註4">{{ item.備註4 }}</span>
      </td>

        <td>{{ 
          ((item.回報工時 - (item.執行工時*1 + item.狀態工時*1 + item.狀態工時2*1 + item.殘疾人*1 + (item.未設定工單 - item.殘疾人*1) + item.無效工時*1 + item.借出工時*1 - item.借入工時*1 + item.調整工時*1)).toFixed(2) === '0.00' || 
          (item.回報工時 - (item.執行工時*1 + item.狀態工時*1 + item.狀態工時2*1 + item.殘疾人*1 + (item.未設定工單 - item.殘疾人*1) + item.無效工時*1 + item.借出工時*1 - item.借入工時*1 + item.調整工時*1)).toFixed(2) === '-0.00') ? '' : 
          (item.回報工時 - (item.執行工時*1 + item.狀態工時*1 + item.狀態工時2*1 + item.殘疾人*1 + (item.未設定工單 - item.殘疾人*1) + item.無效工時*1 + item.借出工時*1 - item.借入工時*1 + item.調整工時*1)).toFixed(2) 
        }}</td>
              
       </tr>
     </template>
    </tbody>
  </table>

  <hr></hr>
  <div class="container">
    <button @click="show_ADJ" >調整</button>
    <button v-if="showADJs" @click="CHECK_WOADJ" >確定</button>
    <button v-if="showADJs" @click="show_ADJ_CANCEL" >取消</button>
  <button @click="downloadWOExcel" class="export-button">导出 Excel</button>
  </div>


  <table ID="WO2">
    <thead>
      <tr>
        <th>部門</th>
        <th>拉</th>
        <th>工單</th>
        <th>工序</th>
        <th>品名</th>
        <th>數量</th>
        <th>標準工時</th>
        <th>執行工時</th>
        <th>調整工時</th>
        <th v-if="showADJs">調整</th>

      </tr>
    </thead>
    <tbody style="overflow-y: scroll" >
      <template v-for="(item, index) in WOVERSON">

        <tr v-if="(index === 0 || item.部門 !== WOVERSON[index - 1].部門) && showInSecondTable[item.部門]" style="background-color: lightblue">
          <td>{{ formatDepartment(item.部門) }}</td>
          <td></td>
          <td colspan="5">{{ translatedText.部門 }}{{ translatedText.加總 }}</td>
          <td>{{ calculateDepartment_WOTotal('執行工時', item.部門).toFixed(2) }}</td>
          <td>{{ calculateDepartment_WOTotal('調整工時', item.部門).toFixed(2) }}</td>
          <td colspan="1"></td>
        </tr>

        <tr :key="item.部門"  v-if="showInSecondTable[item.部門]">
        <td v-if="index === 0 || item.部門 !== WOVERSON[index - 1].部門" :rowspan="countShiftDesc(index,WOVERSON)">{{ formatDepartment(item.部門) }}</td>
        <td>{{ item.拉 }}</td>
        <td>{{ item.工單  === '' ? '未設定工單' : item.工單 }}</td>
        <td>{{ item.工序  === '' ? '-' : item.工序 }}</td>
        <td>{{ item.品名 }}</td>
        <td>{{ item.數量 }}</td>
        <td>{{ item.標準工時 }}</td>
        <td>{{ item.執行工時 }}</td>
        <td>{{ item.調整工時 }}</td>
        <td v-if="showADJs">       <input type="number" v-model="item.ADJ" step="0.01"></td>     


       </tr>
     </template>
    </tbody>

  </table>

</div>  
<div class="right-content" v-if="CARD_mangeContent">

  <header >{{ translatedText.卡片設定 }}</header>

    <br>
    <form @submit.prevent="selectMachine">
      <label for="card">{{ translatedText.輸入卡機 }}:</label>
      <input id="card" type="text" v-model="selectedmachine">
      <button type="submit" class="export-button">{{ translatedText.查詢 }}</button>
    </form>
    <br>
    <hr ></hr>

    <br>
    <form v-if="machine_card" class="machine-form" >
      <div class="form-group">
        <label for="nfC_ID">{{ translatedText.NFC卡號 }}: </label>
        <input id="nfC_ID" type="text" v-model="machine_card[0].nfC_ID" readonly>
      </div>
      <div class="form-group">
        <label for="department">{{ translatedText.部門 }}:</label>
        <input id="department" type="text" v-model="machine_card[0].department">
      </div>
      <div class="form-group">
        <label for="username">{{ translatedText.姓名 }}:</label>
        <select v-model="machine_card[0].username"   @change="CAEDoptions_change($event)" >
          <option v-for="option in CAEDoptions" :value="option.username" :key="option.username">{{ option.username }}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="job_number">{{ translatedText.工號 }}:</label>
        <input id="job_number" type="text" v-model="machine_card[0].job_number" readonly> 
      </div>
      <div class="form-group">
        <label for="code">{{ translatedText.NFC_CODE }}:</label>
     
        <select v-model="machine_card[0].code">
          <option value="01">01</option>
          <option value="02">02</option>
          <option value="03">03</option>
          <option value="04">04</option>
          <option value="05">05</option>
          <option value="06">06</option>
          <option value="07">07</option>

        </select>

      </div>
      <div class="form-group">
        <button @click="submitCARD_Form" type="button">{{ translatedText.提交 }}</button>
      </div>
    </form>
</div>
<div class="right-content" v-if="shift_mangeContent">
  <label >{{ translatedText.area }}:</label>
  <select v-model="selectedArea" @change="shift_data">
    <option value="ZH">ZH</option>
    <option value="TC">TC</option>
    <option value="VN">VN</option>
    <option value="TW">TW</option>
  </select>
  <header >{{ translatedText.班別管理 }}</header>

    <br>
    <button @click="new_staff" >{{ translatedText.New }}</button>
    <button @click="show_delete" >{{ translatedText.delete }}</button>
    <button @click="show_UPDATE" >{{ translatedText.修改 }}</button>
    <button @click="show_CANCLE" >{{ translatedText.取消 }}</button>
    
    <div v-if="showForm">
     <form @submit.prevent="addNewSHIFT">
       <label>HOSTID</label>
       <input v-model="newSHIFT.HOSTID"  required />
 
       <label>{{ translatedText.部門 }}</label>
       <input v-model="newSHIFT.DEPARTMENT" required />
 
 
 
       <button type="submit">{{ translatedText.完成 }}</button>
     </form>
     </div>

     <table>
      <thead>
        <tr>
          <th>HOST_ID</th>
          <th>{{translatedText.部門}}</th>
          <th>NFCcode01</th>
          <th>NFCcode02</th>
          <th>NFCcode03</th>
          <th>NFCcode04</th>
          <th>NFCcode05</th>
          <th>NFCcode06</th>
          <th>NFCcode07</th>


        </tr>
      </thead>
      <tbody>
        <template v-for="(item, index) in shiftdata">

          <!-- 只在編號的第一行渲染 -->
          <tr :key="item.hostid">
            <td>{{ item.hostid }}</td>

            <td>{{ item.department }}</td>
            <td> <input type="checkbox" :checked="item.nfccodE01_enable === 'T'" @change="toggleSHIFTStatus(item.id,item.nfccodE01_enable,'NFCCODE01_enable')"></td> 
            <td> <input type="checkbox" :checked="item.nfccodE02_enable === 'T'" @change="toggleSHIFTStatus(item.id,item.nfccodE02_enable,'NFCCODE02_enable')"></td> 
            <td> <input type="checkbox" :checked="item.nfccodE03_enable === 'T'" @change="toggleSHIFTStatus(item.id,item.nfccodE03_enable,'NFCCODE03_enable')"></td> 
            <td> <input type="checkbox" :checked="item.nfccodE04_enable === 'T'" @change="toggleSHIFTStatus(item.id,item.nfccodE04_enable,'NFCCODE04_enable')"></td> 
            <td> <input type="checkbox" :checked="item.nfccodE05_enable === 'T'" @change="toggleSHIFTStatus(item.id,item.nfccodE05_enable,'NFCCODE05_enable')"></td> 
            <td> <input type="checkbox" :checked="item.nfccodE06_enable === 'T'" @change="toggleSHIFTStatus(item.id,item.nfccodE06_enable,'NFCCODE06_enable')"></td> 
            <td> <input type="checkbox" :checked="item.nfccodE07_enable === 'T'" @change="toggleSHIFTStatus(item.id,item.nfccodE07_enable,'NFCCODE07_enable')"></td> 
            <td>
        
          </tr>
        </template>
      </tbody>
    </table>


</div>
<div class="right-content" v-if="woderpreport">
  <label >{{ translatedText.area }}:</label>
  <select id="PDareaSelect" v-model="selectedArea" @change="woderp">
    <option value="ZH">ZH</option>
    <option value="TC">TC</option>
    <option value="VN">VN</option>
    <option value="TW">TW</option>
  </select>
  <input type="date" v-model="selectedDate" @change="woderp">
  <header >{{ translatedText.工單狀態與ERP對比報表 }}</header>
  <br></br>
  <button @click="exportToExcel2">打印明細</button>
  <table > 
    <thead>
      <caption style="text-align: right; font-style: italic;">總表</caption>
      <tr>
        <th>{{ translatedText.部門 }}</th>
        <th>NFC工時與ERP工時不符</th>
        <th>NFC已完成ERP未結案</th>
        <th>NFC未完成ERP已結案</th>
        <th>NFC沒資料ERP已結案</th>
      </tr>
    </thead>
    <tbody style="overflow-y: scroll">
      <template v-for="(item, index) in woderpdata">
        <tr >
          <!-- 只在編號的第一行渲染 -->
          <td>{{item.部門 }}</td>
          <td>{{ item.nfc與erp工時不符數量 }}</td>
          <td>{{ item.nfc已完成erp未結案數量 }}</td>
          <td>{{ item.nfc未完成erp已結案}}</td>
          <td>{{ item.nfc沒資料erp已結案 }}</td>
      </tr>
      </template>
    </tbody>
  </table>
  <table  style="display: none;">
    <thead>
      <tr>
        <th>部門</th>
        <th>NFC工單狀態</th>
        <th>日期</th>
        <th>工單</th>
        <th>品名</th>
        <th>數量</th>
        <th>標準工時</th>
        <th>NFC執行工時</th>
        <th>ERP輸入工時</th>
        <th>ERP狀態</th>
        <th>ERP已入庫數</th>
      </tr>
    </thead>
    <tbody style="overflow-y: scroll">
      <template v-for="(item, index) in erpdata1">
        <tr >
          <!-- 只在編號的第一行渲染 -->
          <td>{{item.部門 }}</td>
          <td>{{ item.nfC工單狀態 }}</td>
          <td>{{ item.日期 }}</td>
          <td>{{ item.工單}}</td>
          <td>{{ item.品名 }}</td>
          <td>{{ item.數量 }}</td>
          <td>{{ item.標準工時 }}</td>
          <td>{{ item.nfC執行工時 }}</td>
          <td>{{ item.erP輸入工時 }}</td>
          <td>{{ item.erP狀態 }}</td>
          <td>{{ item.erP已入庫數 }}</td>
      </tr>
      </template>
    </tbody>
  </table>

</div>
<div class="right-content" v-if="SNLISTcontent">
  <header >{{ translatedText.序號查詢 }}</header>
  <div class="search-section">
    <input
      v-model="snInput"
      type="text"
      placeholder="輸入序號"
    />
    <button @click="fetchSNData">查詢</button>
  </div>
  
  <table v-if="snList.length">
    <thead>
      <tr>
        <th v-for="(value, key) in snList[0]" :key="key">{{ key }}</th>
      </tr>
    </thead>
    <tbody>
      <tr v-for="(row, index) in snList" :key="index">
        <td v-for="(value, key) in row" :key="key">{{ value }}</td>
      </tr>
    </tbody>
  </table>
  <p v-else>沒有數據</p>
  <table v-if="sfHLinkList.length">
    <caption>SF_H_LINK 結果</caption>
    <thead>
      <tr>
        <th v-for="(value, key) in sfHLinkList[0]" :key="key">{{ key }}</th>
      </tr>
    </thead>
    <tbody>
      <tr v-for="(row, index) in sfHLinkList" :key="index">
        <td v-for="(value, key) in row" :key="key">{{ value }}</td>
      </tr>
    </tbody>
  </table>
  <p v-else>沒有 SF_H_LINK 資料</p>
</div>
<div class="right-content" v-if="PDSNLISTcontent">
  <header >{{ translatedText.出貨序號表 }}</header>
  <label >產品類型</label>
  <select id="PDTYPESelect" v-model="PDTYPESelect" >
    <option value="15-3600-01E">BUSTER(15-3600-01E)</option>
    <option value="24-2147-01">READER01(24-2147-01)</option>
    <option value="24-2147-02">READER02(24-2147-02)</option>
  </select>
  start<input type="date" v-model="selectedDate" >
  end<input type="date" v-model="selectedDate2">
    <button @click="fetchPDSNData">查詢</button>
  <button @click="PDSNexportToExcel">打印明細</button>
  <div style="display: flex; align-items: center;">
    <h2 style="margin-right: 20px;">生產數據</h2>
    <p style="margin-right: 20px;">完成數量: {{ getTotalCountPDLIST() }} 筆</p>

  </div>
  <table v-if="SFPDSNLINK.length">
    <thead>
      <tr>
        <th v-for="(value, key) in SFPDSNLINK[0]" :key="key">{{ key }}</th>
      </tr>
    </thead>
    <tbody>
      <tr v-for="(row, index) in SFPDSNLINK" :key="index">
        <td v-for="(value, key) in row" :key="key">{{ value }}</td>
      </tr>
    </tbody>
  </table>
  <p v-else>沒有數據</p>
</div>
<div class="right-content" v-if="FAILSNLISTcontent">
  <header >{{ translatedText.不良品紀錄查詢 }}</header>
  <label >產品類型</label>
  <select id="PDTYPESelect" v-model="PDTYPESelect" >
    <option value="15-3600-01E">BUSTER(15-3600-01E)</option>
    <option value="24-2147-01">READER01(24-2147-01)</option>
    <option value="24-2147-02">READER02(24-2147-02)</option>
  </select>
  start<input type="date" v-model="selectedDate" >
  end<input type="date" v-model="selectedDate2">
    <button @click="fetchfailSNData">查詢</button>
  <button @click="PDSNexportToExcel">打印明細</button>
  <div style="display: flex; align-items: center;">
    <h2 style="margin-right: 20px;">生產數據</h2>
    <p style="margin-right: 20px;">
      總生產數量: {{ SFPDSNLINKqty.length > 0 ? SFPDSNLINKqty[0].sn_qty : 0 }} 
    </p>
    

    <p style="margin-right: 20px;">不良品重工完成數量: {{ getTotalCountPDLIST() }} </p>
    <p style="margin-right: 20px;">
      直通率: {{ SFPDSNLINKqty.length > 0 
        ? (( (SFPDSNLINKqty[0].sn_qty - getTotalCountPDLIST()) / SFPDSNLINKqty[0].sn_qty    ) * 100.0 ).toFixed(2)

        : '0.00' }} %
    </p>
    
    <p style="margin-right: 20px;">不良品數量: 0</p>
    <p style="margin-right: 20px;">不良率: 0.00%</p>

  </div>
  <table v-if="SFPDSNLINK.length">
    <thead>
      <tr>
        <th v-for="(value, key) in SFPDSNLINK[0]" :key="key">{{ key }}</th>
      </tr>
    </thead>
    <tbody>
      <tr v-for="(row, index) in SFPDSNLINK" :key="index">

        <td v-for="(value, key) in row" :key="key" v-if="value !== null && value !== undefined">
          {{ value }}
        </td>
      </tr>
    </tbody>
  </table>
  <p v-else>沒有數據</p>
</div>
<div class="right-content" v-if="SHOPSTcontent">
  <header >{{ translatedText.過站管理 }}</header>


  <label>當前選擇工單</label>
  <select  id="SFSELECT" v-model="SFselectedWO" @change="fetchOperations">
    <!-- 生成下拉选项 -->
    <option v-for="(item, index) in realTimeData" :key="item" :value=" item.WO_ID" >{{  item.WO_ID }}</option>
  </select >


  <label >當前選擇工站</label>
    <select id="SFSELECT" v-model="SFselectedOPERATOR" @change="seloption">
       生成工站下拉選項 
    <option v-for="(operation, index) in SFoperations" :key="SFoperations.OPERATION_NO" :value="operation.OPERATION_NO">
      {{ operation.OPERATION_DESC }}
    </option>
  </select>

  <hr></hr>  
  <label v-if="selectedText === '最終測試'">設備序號:</label>

  <div v-if="selectedText === '最終測試'" class="machine-wrapper">
    <div 
      v-for="(machine, index) in machines" 
      :key="index"
      class="machine-container"
    >
      <button 
        :class="['test-machine-btn', { selected: deviceSerial === machine }]"
        @click="handleTestMachine(machine)"
      >
        Test machine {{ machine }}
      </button>
      <p class="device-count">使用次數: {{ getDeviceCount(machine) }}</p>
    </div>
  </div>
<br>
  <label >輸入序號:</label>  

  <input type="text" id="scan-input" ref="scanInput"  v-model="scanContent" @keydown.enter="handleEnter" placeholder="Scan content here"    
  
  :disabled="selectedText == '最終測試' && deviceSerial === ''" />



  <hr></hr>  


  <template>  


    <div class="sfcontainer">
      <!-- 左邊部分：包含原本的邏輯 -->
      <div class="left-panel">
        <div v-if="sfsnData && sfsnData.RESULT === 'Pass' && sfsnData.LINK !=='E' ">
          <p>SN: {{ sfsnData.SN }}</p>
          <p>前工站: {{ sfsnData.LASTOPDESC }}</p>
      
        </div>
        <div v-else-if="sfsnData && sfsnData.RESULT === 'Fail' && sfsnData.LINK !=='E'">   
          <p style="background-color: red; color: black; font-weight: bold;">不良品</p>
        </div>
        <div v-else-if="sfsnData && sfsnData.RESULT === 'Pass' && sfsnData.LINK ==='E' ">
          <p style="background-color: rgb(30, 255, 0); color: black; font-weight: bold;">生產完成</p>
          <ul>
            <li 
            v-for="(value, key) in transResponse" 
            :key="key" 
            :style="{ backgroundColor: value === '' ? 'red' : 'transparent', color: value === '' ? 'white' : 'black' }"
          >
              {{ key }}: {{ value }}
            </li>
            
            
          </ul>
        </div>
        <div v-else-if="!sfsnData ">
          <p>查無資料</p>
        </div>
        <div v-else>  </div>
      
        <hr></hr>  
        <div v-if="sfsnData && 
          ((  ( sfsnData.NEXTOPNO === SFselectedOPERATOR || SFselectedOPERATOR <=99 ) && selectedLINK == 'N' && sfsnData.RESULT === 'Pass') || 
          (sfsnData.RESULT === 'Fail' && SFselectedOPERATOR === '0'))" 
          class="sfbutton-container">
          <BR>
          <BR>
          <button ref="passButton" id="sfpass-button" @click="handleClick('Pass')">PASS</button>
          <button id="sffail-button" @click="handleClick('Fail')">FAIL</button>
        </div>
    

          <div v-else-if="sfsnData && (sfsnData.NEXTOPNO === SFselectedOPERATOR || SFselectedOPERATOR <= 99) && selectedLINK === 'T' && sfsnData.RESULT === 'Pass' && selectedDESC2 !== '' && sfsnData.LINK !=='E'  ">

          <label> {{this.selectedDESC1}}:</label>
          <input type="text" id="scan-input" v-model="sfsnData.TRANS_ID1" @keyup.enter="handleClick2" ref="nexInputY">
          <br>
          <label> {{this.selectedDESC2}}:</label>
          <input type="text" id="scan-input" v-model="sfsnData.TRANS_ID2" @keyup.enter="handleEnterLINKKey" ref="nexInput">
        </div>
        <div v-else-if="sfsnData &&  ( sfsnData.NEXTOPNO === SFselectedOPERATOR || SFselectedOPERATOR <=99 )  && selectedLINK == 'T' && sfsnData.RESULT === 'Pass' && selectedDESC2 === '' && sfsnData.LINK !=='E'">

          <br>
          <label> {{this.selectedDESC1}}:</label>
          <input type="text" id="scan-input" v-model="sfsnData.TRANS_ID1" @keyup.enter="handleEnterLINKKey" ref="nexInputD">
        </div>
        <div v-else-if="sfsnData &&  ( sfsnData.NEXTOPNO === SFselectedOPERATOR || SFselectedOPERATOR <=99 )  && selectedLINK == 'C' && sfsnData.RESULT === 'Pass' && selectedDESC2 === '' && sfsnData.LINK !=='E'">
          <ul>
            <li 
            v-for="(value, key) in transResponse" 
            :key="key" 
            :style="{ backgroundColor: value === '' ? 'red' : 'transparent', color: value === '' ? 'white' : 'black' }"
          >
              {{ key }}: {{ value }}
            </li>
            
            
          </ul>
          <br>
          <label> {{this.selectedDESC1}}:</label>
          <input type="text" id="scan-input" v-model="sfsnData.TRANS_ID1" @keyup.enter="handleEnterLINKKey" ref="nexInputD">
        </div>


        <div v-else-if="sfsnData && sfsnData.LINK === 'E'"></div>
        <div v-else-if="sfsnData">
          <p style="background-color: red; color: black; font-weight: bold;">工站錯誤</p>
        </div>
      </div>
      <div class="divider"></div>
      <!-- 右邊部分：顯示今日生產狀態 -->
      <div class="right-panel">
        <div style="display: flex; align-items: center;">
          <h2 style="margin-right: 20px;">今日生產數據</h2>
          <p style="margin-right: 20px;">今日比數: {{ getTotalCount() }} 筆</p>
          <p style="margin-right: 20px;">PASS數量: {{ getPassCount() }} 筆</p>
          <p>FAIL數量: {{ getFailCount() }} 筆</p>
        </div>
        <div v-if="productionData" style="max-height: 400px; overflow-y: auto;">
          <!-- 假设 productionData 是一个数组 -->
          <table>
            <thead>
              <tr>
      
                <th>序號</th>
                <th>結果</th>
                <th v-if="selectedDESC1 !== ''"> {{this.selectedDESC1}}</th>
                <th v-if="selectedDESC2 !== ''">{{ selectedDESC2 }}</th>

                <!-- 根据 API 返回的数据调整表头 -->
              </tr>
            </thead>
            <tbody>
              <tr v-for="(item, index) in productionData" :key="index">
                <td>{{ item.SN}}</td>
                <td>{{ item.RESULT }}</td>
                <td v-if="selectedDESC1 !== ''">{{ item.TRANS_ID1 }}</td>
                <td v-if="selectedDESC2 !== ''">{{ item.TRANS_ID2 }}</td>
                <!-- 根据 API 返回的数据调整表格内容 -->
              </tr>
            </tbody>
          </table>
        </div>
        <div v-else>
          <p>请选择一个选项以查看今日生产数据。</p>
        </div>
      </div>
    



</template>  



<div v-if="showModal" class="sfmodal">
  <div class="sfmodal-content">
      <p>{{ modalMessage }}</p>
  </div>
</div>

</div>
<div class="right-content" v-if="SHOW_eff_performance">
  <label>{{ translatedText.area }}:</label>
  <select id="PDareaSelect" v-model="selectedArea" @change="effper">
    <option value="ZH">ZH</option>
    <option value="TC">TC</option>
    <option value="VN">VN</option>
    <option value="TW">TW</option>
  </select>
  <label>year</label>
  <select id="PDareaSelect" v-model="selectedYear" @change="effper">
    <option value="2024">2024</option>
    <option value="2025">2025</option>
    <option value="2026">2026</option>
    <option value="2027">2027</option>
  </select>
  <label>month</label>
  <select id="monthSelect" v-model="selectedMonth" @change="effper">
    <option v-for="num in 12" :key="num" :value="String(num).padStart(2, '0')">
      {{ String(num).padStart(2, '0') }}
    </option>
  </select>
  
  <!-- Excel Sheet Tabs -->
  <div class="tabs">
    <button v-for="(sheet, index) in sheets" 
            :key="index" 
            @click="currentSheet = index"
            :class="{ active: currentSheet === index }">
      {{ sheet.name }}
    </button>
    <button @click=" downloadExcelWOPER" class="export-button">{{ translatedText.導出 }} Excel</button>
  </div>
  
  <!-- Sheet1 Content -->
    
    <table id="WOPET2" v-show="currentSheet === 0">
      <thead>
        <tr>
          <th rowspan="2">班別代號<br>Mã ca làm việc</th>
          <th v-for="(index, idx) in eff_performance_dates" 
              :key="'header-' + index" 
              :colspan="idx === eff_performance_dates.length - 1 ? '9' : '3'">
            {{ index }}
          </th>
        </tr>
        <tr>
          <template v-for="(index, idx) in eff_performance_dates" :key="'sub-header-' + index">
          <!--    <th>標準</th>
            <th>實際</th>-->
            <th>標準工時<br>Giờ công tiêu chuẩn</th>
            <th>實際工時<br>Giờ công thực tế</th>
            <th>效率<br>Hiệu suất</th>
            <template v-if="idx === eff_performance_dates.length - 1">
              <th>累計負值效率<br>Hiệu suất giá trị âm lũy kế</th>
              <th>效率上升率<BR>Tỷ lệ tăng hiệu suất</th>
              <th>最終考核效率<BR>Hiệu suất đánh giá cuối cùng</th>
              <th>當月考績<br>Kết quả đánh giá trong tháng</th> 
              <th>額外獎勵<br>Thưởng bổ sung</th> 
              <th>下月累計負值效率<BR>Hiệu suất giá trị âm lũy kế tháng sau</th>
            </template>
          </template>
        </tr>
      </thead>
      
      <tbody>
        <tr v-for="(index, erpCode1) in eff_performance_groupedData" :key="erpCode1" v-if="eff_performance_getValue(erpCode1, eff_performance_dates[2], '部門') === '2'">
          <td>{{ erpCode1 }}</td>
          <template v-for="(date, i) in eff_performance_dates" :key="'data-' + erpCode1 + '-' + date">
           <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時標準')) }}</td>
              <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時實際')) }}</td>
                         <td :style="{ backgroundColor: eff_performance_getValue(erpCode1, date, '效率') > 100 ? 'green' : '' }">
              {{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '效率')) }}
            </td>
              <!-- <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '效率')) }}</td>-->
            <template v-if="i === eff_performance_dates.length - 1">
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '累計')) }}</td>
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '上升率')) }}</td>
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '績效')) }}</td>
              <td>{{ eff_performance_getValue(erpCode1, date, '考績') === '0' ? '-' : eff_performance_getValue(erpCode1, date, '考績') }}</td>
              <td>{{ eff_performance_getValue(erpCode1, date, '考績2') === '0' ? '-' : eff_performance_getValue(erpCode1, date, '考績2') }}</td>
              
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '下月累計負值')) }}</td>
            </template>
          </template>
        </tr>
        <tr>
          <td>合计</td>
          <template v-for="(date, i) in eff_performance_dates" :key="'total-' + date">
            <td>{{ eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '人時標準', '2')) }}</td>
            <td>{{ eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '人時實際', '2')) }}</td>
            <td>{{ eff_performance_formatNumber2(eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '人時標準', '2'))
              /eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '人時實際', '2'))*100) }}</td>
            <!-- 其余单元格按需求填写 -->
          </template>
        </tr>
      </tbody>
    </table>
    <table id="WOPET3" v-show="currentSheet === 1">
      <thead>
        <tr>
          <th rowspan="2">班別代號<br>Mã ca làm việc</th>
          <th v-for="(index, idx) in eff_performance_dates" 
              :key="'header-' + index" 
              :colspan="idx === eff_performance_dates.length - 1 ? '9' : '3'">
            {{ index }}
          </th>
        </tr>
        <tr>
          <template v-for="(index, idx) in eff_performance_dates" :key="'sub-header-' + index">
          <!--    <th>標準</th>
            <th>實際</th>-->
            <th>標準工時<br>Giờ công tiêu chuẩn</th>
            <th>實際工時<br>Giờ công thực tế</th>
            <th>效率<br>Hiệu suất</th>
            <template v-if="idx === eff_performance_dates.length - 1">
              <th>累計負值效率<br>Hiệu suất giá trị âm lũy kế</th>
              <th>效率上升率<BR>Tỷ lệ tăng hiệu suất</th>
              <th>最終考核效率<BR>Hiệu suất đánh giá cuối cùng</th>
              <th>當月考績<br>Kết quả đánh giá trong tháng</th> 
              <th>額外獎勵<br>Thưởng bổ sung</th> 
              <th>下月累計負值效率<BR>Hiệu suất giá trị âm lũy kế tháng sau</th>
            </template>
          </template>
        </tr>
      </thead>
      
      <tbody>
        <tr v-for="(index, erpCode1) in eff_performance_groupedData" :key="erpCode1" v-if="eff_performance_getValue(erpCode1, eff_performance_dates[2], '部門') === '3'">
          <td>{{ erpCode1 }}</td>
          <template v-for="(date, i) in eff_performance_dates" :key="'data-' + erpCode1 + '-' + date">
           <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時標準')) }}</td>
              <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時實際')) }}</td>
                         <td :style="{ backgroundColor: eff_performance_getValue(erpCode1, date, '效率') > 100 ? 'green' : '' }">
              {{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '效率')) }}
            </td>
              <!-- <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '效率')) }}</td>-->
            <template v-if="i === eff_performance_dates.length - 1">
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '累計')) }}</td>
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '上升率')) }}</td>
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '績效')) }}</td>
              <td>{{ eff_performance_getValue(erpCode1, date, '考績') === '0' ? '-' : eff_performance_getValue(erpCode1, date, '考績') }}</td>
              <td>{{ eff_performance_getValue(erpCode1, date, '考績2') === '0' ? '-' : eff_performance_getValue(erpCode1, date, '考績2') }}</td>
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '下月累計負值')) }}</td>
            </template>
          </template>
        </tr>
        <tr>
          <td>合计</td>
          <template v-for="(date, i) in eff_performance_dates" :key="'total-' + date">
            <td>{{ eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '人時標準', '3')) }}</td>
            <td>{{ eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '人時實際', '3')) }}</td>
            <td>{{ eff_performance_formatNumber2(eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '人時標準', '3'))
              /eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '人時實際', '3'))*100) }}</td>
            <!-- 其余单元格按需求填写 -->
          </template>
        </tr>
      </tbody>
    </table>
    <table id="PPWO" v-show="currentSheet === 2">
      <thead>
        <tr>
          <th>工單<br>Công lệnh</th>
          <th>班別代號<br>Mã ca làm việc</th>
          <th>料號<br>Mã vật tư</th>
          <th>數量<br>Số lượng</th>
          <th>標準工時<br>Giờ công tiêu chuẩn</th>
          <th>實際工時<br>Giờ công thực tế</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="(item, index) in eff_performance_ppwodata" :key="item.ID">
          <td>{{ item.WONUM }}</td>
          <td>{{ item.SHIFT }}</td>
          <td>{{ item.ITEMNUM }}</td>
          <td>{{ item.QTY }}</td>
          <td>{{ item.SWH }}</td>
          <td>{{ item.AWH }}</td>
        </tr>
        <tr v-if="eff_performance_ppwodata.length > 0">
          <td>比例</td>
          <td>{{ eff_performance_ppwodata[0].Total_PP_T }}/{{ eff_performance_ppwodata[0].Total_WONUM }}</td>
          <td colspan="2">合計</td>
          <td>{{ totalSWH }}</td>
          <td>{{ totalAWH }}</td>
        </tr>
      </tbody>
    </table> 
    <table ID="DEPPER" v-show="currentSheet === 3">
      <thead>
        <tr>
          <th rowspan="2">管理部門<br>Bộ phận quản lý</th>
          <th rowspan="2">管理班別<br>Quản lý ca làm việc</th>
          <th rowspan="2">工號<br>Mã công nhân</th>
          <th rowspan="2">姓名<br>Tên</th>
          <th rowspan="2">上班天數<br>Tên</th>
          <th rowspan="2">職稱<br>Chức danh</th>
          <th v-for="(index, idx) in DEP_eff_performance_dates" 
              :key="'header-' + index" 
              :colspan="idx === DEP_eff_performance_dates.length - 1 ? '11' : '1'">
            {{ index }}
          </th>
        </tr>
        <tr>
          <template v-for="(index, idx) in DEP_eff_performance_dates" :key="'sub-header-' + index">
          <!--    <th>標準</th>
            <th>實際</th>-->
            <th>效率<br>Hiệu suất</th>
            <template v-if="idx === DEP_eff_performance_dates.length - 1">
              <th>累計負值效率<br>Hiệu suất giá trị âm lũy kế</th>
              <th>效率上升率<BR>Tỷ lệ tăng hiệu suất</th>
              <th>最終考核效率<BR>Hiệu suất đánh giá cuối cùng</th>
              <th>當月考績<br>Kết quả đánh giá trong tháng</th> 
              <th>額外獎勵<br>Thưởng bổ sung</th> 
              <th>考績獎金<br>Thưởng đánh giá hiệu suất</th> 
              <th>額外考績獎金<br>Thưởng đánh giá hiệu suất bổ sung</th> 
              <th>A15拉管理福利金<br>Quỹ phúc lợi quản lý A15</th> 
              <th>最終獎金<br>Thưởng cuối cùng</th> 
              <th>下月累計負值效率<BR>Hiệu suất giá trị âm lũy kế tháng sau</th>
            </template>
          </template>
        </tr>
      </thead>
      
      <tbody>
        <tr v-for="(index, erpCode1) in DEP_eff_performance_groupedData" :key="erpCode1">

          <td>{{DEP_eff_performance_getValue(erpCode1, '202508', '部') }}</td>
          <td>{{DEP_eff_performance_getValue(erpCode1, '202508', '班') }}</td>
          <td>{{ erpCode1 }}</td>
          <td>{{DEP_eff_performance_getValue(erpCode1, '202508', '姓名') }}</td>
          <td>{{DEP_eff_performance_getValue(erpCode1, '202508', 'LAMDAY_STR') }}</td>
          <td>{{DEP_eff_performance_getValue(erpCode1, '202508', '崗位') }}</td>
          <template v-for="(date, i) in DEP_eff_performance_dates" :key="'data-' + erpCode1 + '-' + date">
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時標準')) }}</td>-->
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時實際')) }}</td>-->
             <td :style="{ backgroundColor: DEP_eff_performance_getValue(erpCode1, date, '效率') > 100 ? 'green' : '' }">
              {{ eff_performance_formatNumber2(DEP_eff_performance_getValue(erpCode1, date, '效率')) }}
            </td>
              <!-- <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '效率')) }}</td>-->
            <template v-if="i === DEP_eff_performance_dates.length - 1">
              <td>{{ eff_performance_formatNumber2(DEP_eff_performance_getValue(erpCode1, date, '累計')) }}</td>
              <td>{{ eff_performance_formatNumber2(DEP_eff_performance_getValue(erpCode1, date, '上升率')) }}</td>
              <td>{{ eff_performance_formatNumber2(DEP_eff_performance_getValue(erpCode1, date, '績效')) }}</td>
              <td>{{DEP_eff_performance_getValue(erpCode1, date, '考績')=== '0' ? '-' :DEP_eff_performance_getValue(erpCode1, date, '考績') }}</td>
              <td>{{DEP_eff_performance_getValue(erpCode1, date, '額外考績')=== '0' ? '-' :DEP_eff_performance_getValue(erpCode1, date, '額外考績') }}</td>
              <td>{{  formatCurrency(DEP_eff_performance_getValue(erpCode1, date, '考績獎金'))=== '0' ? '-' : formatCurrency(DEP_eff_performance_getValue(erpCode1, date, '考績獎金'))}}</td>
              <td>{{formatCurrency(DEP_eff_performance_getValue(erpCode1, date, '額外考績獎金'))=== '0' ? '-' : formatCurrency(DEP_eff_performance_getValue(erpCode1, date, '額外考績獎金'))}}</td>

              <td>{{formatCurrency(DEP_eff_performance_getValue(erpCode1, date, 'A15拉管理福利金'))=== '0' ? '-' :formatCurrency(DEP_eff_performance_getValue(erpCode1, date, 'A15拉管理福利金')) }}</td>
              <td>{{formatCurrency(DEP_eff_performance_getValue(erpCode1, date, '最終獎金'))=== '0' ? '-' :formatCurrency(DEP_eff_performance_getValue(erpCode1, date, '最終獎金')) }}</td>

                            
              <td>{{ eff_performance_formatNumber2(DEP_eff_performance_getValue(erpCode1, date, '下月累計負值')) }}</td>
            </template>
          </template>
        </tr>
        <tr>
          <td colspan="17">Total</td>
          <td>{{formatCurrency( totalFinalBonus) }}</td>
        </tr>
      </tbody>

    </table>
    <table id="stffbonus"  v-show="currentSheet === 4">
      <thead>
        <tr>
          <th>班別代號<br>Mã ca làm việc</th>
          <th>工號<br>Mã công nhân</th>
          <th>姓名<br>Tên</th>
         <!-- <th>文員統計天數</th>-->
          <th>工作天數<br>Số ngày làm việc</th>
          <th>請假天數<br>Số ngày nghỉ phép</th>
          <th>崗位<br>Vị trí</th>
          <th>績效等級-I<br>Cấp độ hiệu suất - I</th>
          <th>獎金-I<br>Thưởng-I</th>
          <th>績效等級-II<br>Cấp độ hiệu suất - II</th>
          <th>獎金-Ii<br>Thưởng-II</th>
          <th>最終獎金<br>Thưởng cuối cùng</th>


        </tr>
      </thead>
      <tbody>
        <template v-for="(group, shift) in groupedByShift">
          <tr v-for="(item, index) in group" :key="item.ID">
            <td>{{ item.SHIFT }}</td>
            <td>{{ item.JOB }}</td>
            <td>{{ item.USERNAME }}</td>
           <!--   <td>{{ item.DAYTIME }}</td>-->
            <td>{{ item.LAMDAY }}</td>
            <td>{{ item.請假天數 }}</td>
            <td>{{ item.IMPORT }}</td>
            <td>{{ item.note }}</td>
            <td>{{ formatCurrency(item.績效) }}</td>
            <td>{{ item.note2 }}</td>
            <td>{{ formatCurrency(item.額外績效) }}</td>
            <td>{{ formatCurrency(item.實際獎金) }}</td>


          </tr>
          <!-- 插入 item.SHIFT 的實際獎金統計行 -->
          <tr>
            <td colspan="9">部門 {{ shift }} 統計</td>
            <td colspan="3">{{formatCurrency(calculateShiftBonus(shift)) }}</td>
          </tr>
        </template>
        <!-- 插入總計行 -->
        <tr>
          <td colspan="9">Total</td>
          <td colspan="3">{{ formatCurrency(totalBonus) }}</td>
        </tr>
      </tbody>
    </table>
    <table ID="QCDEPPER" v-show="currentSheet === 5">
      <thead>
        <tr>
          <th rowspan="2">管理部門<br>Bộ phận quản lý</th>
          <th rowspan="2">管理班別<br>Quản lý ca làm việc</th>
          <th rowspan="2">工號<br>Mã công nhân</th>
          <th rowspan="2">姓名<br>Tên</th>
          <th rowspan="2">職稱<br>Chức danh</th>
          <th v-for="(index, idx) in QCDEP_eff_performance_dates" 
              :key="'header-' + index" 
              :colspan="idx === QCDEP_eff_performance_dates.length - 1 ? '11' : '1'">
            {{ index }}
          </th>
        </tr>
        <tr>
          <template v-for="(index, idx) in QCDEP_eff_performance_dates" :key="'sub-header-' + index">
          <!--    <th>標準</th>
            <th>實際</th>-->
            <th>效率<br>Hiệu suất</th>
            <template v-if="idx === QCDEP_eff_performance_dates.length - 1">
              <th>累計負值效率<br>Hiệu suất giá trị âm lũy kế</th>
              <th>效率上升率<BR>Tỷ lệ tăng hiệu suất</th>
              <th>最終考核效率<BR>Hiệu suất đánh giá cuối cùng</th>
              <th>當月考績<br>Kết quả đánh giá trong tháng</th> 
              <th>額外獎勵<br>Thưởng bổ sung</th> 
              <th>考績獎金<br>Thưởng đánh giá hiệu suất</th> 
              <th>額外考績獎金<br>Thưởng đánh giá hiệu suất bổ sung</th> 
              <th>A15拉管理福利金<br>Quỹ phúc lợi quản lý A15</th> 
              <th>最終獎金<br>Thưởng cuối cùng</th> 
              <th>下月累計負值效率<BR>Hiệu suất giá trị âm lũy kế tháng sau</th>
            </template>
          </template>
        </tr>
      </thead>
      
      <tbody>
        <tr v-for="(index, erpCode1) in QCDEP_eff_performance_groupedData" :key="erpCode1">

          <td>{{QCDEP_eff_performance_getValue(erpCode1, '202508', '部') }}</td>
          <td>{{QCDEP_eff_performance_getValue(erpCode1, '202508', '班') }}</td>
          <td>{{ erpCode1 }}</td>
          <td>{{QCDEP_eff_performance_getValue(erpCode1, '202508', '姓名') }}</td>
          <td>{{QCDEP_eff_performance_getValue(erpCode1, '202508', '崗位') }}</td>
          <template v-for="(date, i) in QCDEP_eff_performance_dates" :key="'data-' + erpCode1 + '-' + date">
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時標準')) }}</td>-->
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時實際')) }}</td>-->
             <td :style="{ backgroundColor: QCDEP_eff_performance_getValue(erpCode1, date, '效率') > 100 ? 'green' : '' }">
              {{ eff_performance_formatNumber2(QCDEP_eff_performance_getValue(erpCode1, date, '效率')) }}
            </td>
              <!-- <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '效率')) }}</td>-->
            <template v-if="i === QCDEP_eff_performance_dates.length - 1">
              <td>{{ eff_performance_formatNumber2(QCDEP_eff_performance_getValue(erpCode1, date, '累計')) }}</td>
              <td>{{ eff_performance_formatNumber2(QCDEP_eff_performance_getValue(erpCode1, date, '上升率')) }}</td>
              <td>{{ eff_performance_formatNumber2(QCDEP_eff_performance_getValue(erpCode1, date, '績效')) }}</td>
              <td>{{QCDEP_eff_performance_getValue(erpCode1, date, '考績')=== '0' ? '-' :QCDEP_eff_performance_getValue(erpCode1, date, '考績') }}</td>
              <td>{{QCDEP_eff_performance_getValue(erpCode1, date, '額外考績') === '0' ? '-' :QCDEP_eff_performance_getValue(erpCode1, date, '額外考績') }}</td>
              <td>{{  formatCurrency(QCDEP_eff_performance_getValue(erpCode1, date, '考績獎金'))=== '0' ? '-' :formatCurrency(QCDEP_eff_performance_getValue(erpCode1, date, '考績獎金')) }}</td>
              <td>{{formatCurrency(QCDEP_eff_performance_getValue(erpCode1, date, '額外考績獎金'))=== '0' ? '-' : formatCurrency(QCDEP_eff_performance_getValue(erpCode1, date, '額外考績獎金'))}}</td>
              <td>{{formatCurrency(QCDEP_eff_performance_getValue(erpCode1, date, 'A15拉管理福利金'))=== '0' ? '-' : formatCurrency(QCDEP_eff_performance_getValue(erpCode1, date, 'A15拉管理福利金'))}}</td>
              <td>{{formatCurrency(QCDEP_eff_performance_getValue(erpCode1, date, '最終獎金'))=== '0' ? '-' :formatCurrency(QCDEP_eff_performance_getValue(erpCode1, date, '最終獎金')) }}</td>

              <td>{{ eff_performance_formatNumber2(QCDEP_eff_performance_getValue(erpCode1, date, '下月累計負值')) }}</td>
            </template>
          </template>
        </tr>
        <td colspan="16">Total</td>
        <td>{{formatCurrency( totalQCFinalBonus) }}</td>
      </tr>
      </tbody>
    </table>
    <table ID="ZHDEPPER" v-show="currentSheet === 7">
      <thead>
        <tr>
          <th rowspan="2">管理部門<br>Bộ phận quản lý</th>
          <th rowspan="2">管理班別<br>Quản lý ca làm việc</th>
          <th rowspan="2">工號<br>Mã công nhân</th>
          <th rowspan="2">姓名<br>Tên</th>
          <th rowspan="2">職稱<br>Chức danh</th>
          <th v-for="(index, idx) in ZHDEP_eff_performance_dates" 
              :key="'header-' + index" 
              :colspan="idx === ZHDEP_eff_performance_dates.length - 1 ? '11' : '1'">
            {{ index }}
          </th>
        </tr>
        <tr>
          <template v-for="(index, idx) in ZHDEP_eff_performance_dates" :key="'sub-header-' + index">
          <!--    <th>標準</th>
            <th>實際</th>-->
            <th>效率<br>Hiệu suất</th>
            <template v-if="idx === ZHDEP_eff_performance_dates.length - 1">
              <th>累計負值效率<br>Hiệu suất giá trị âm lũy kế</th>
              <th>效率上升率<BR>Tỷ lệ tăng hiệu suất</th>
              <th>最終考核效率<BR>Hiệu suất đánh giá cuối cùng</th>
              <th>當月考績<br>Kết quả đánh giá trong tháng</th> 
              <th>額外獎勵<br>Thưởng bổ sung</th> 
              <th>考績獎金<br>Thưởng đánh giá hiệu suất</th> 
              <th>額外考績獎金<br>Thưởng đánh giá hiệu suất bổ sung</th> 
              <th>A15拉管理福利金<br>Quỹ phúc lợi quản lý A15</th> 
              <th>最終獎金<br>Thưởng cuối cùng</th> 
              <th>下月累計負值效率<BR>Hiệu suất giá trị âm lũy kế tháng sau</th>
            </template>
          </template>
        </tr>
      </thead>
      
      <tbody>
        <tr v-for="(index, erpCode1) in ZHDEP_eff_performance_groupedData" :key="erpCode1">

          <td>{{ZHDEP_eff_performance_getValue(erpCode1, '202508', '部') }}</td>
          <td>{{ZHDEP_eff_performance_getValue(erpCode1, '202508', '班') }}</td>
          <td>{{ erpCode1 }}</td>
          <td>{{ZHDEP_eff_performance_getValue(erpCode1, '202508', '姓名') }}</td>
          <td>{{ZHDEP_eff_performance_getValue(erpCode1, '202508', '崗位') }}</td>
          <template v-for="(date, i) in ZHDEP_eff_performance_dates" :key="'data-' + erpCode1 + '-' + date">
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時標準')) }}</td>-->
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時實際')) }}</td>-->
             <td :style="{ backgroundColor: ZHDEP_eff_performance_getValue(erpCode1, date, '效率') > 100 ? 'green' : '' }">
              {{ eff_performance_formatNumber2(ZHDEP_eff_performance_getValue(erpCode1, date, '效率')) }}
            </td>
              <!-- <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '效率')) }}</td>-->
            <template v-if="i === ZHDEP_eff_performance_dates.length - 1">
              <td>{{ eff_performance_formatNumber2(ZHDEP_eff_performance_getValue(erpCode1, date, '累計')) }}</td>
              <td>{{ eff_performance_formatNumber2(ZHDEP_eff_performance_getValue(erpCode1, date, '上升率')) }}</td>
              <td>{{ eff_performance_formatNumber2(ZHDEP_eff_performance_getValue(erpCode1, date, '績效')) }}</td>
              <td>{{ZHDEP_eff_performance_getValue(erpCode1, date, '考績')=== '0' ? '-' :ZHDEP_eff_performance_getValue(erpCode1, date, '考績') }}</td>
              <td>{{ZHDEP_eff_performance_getValue(erpCode1, date, '額外考績') === '0' ? '-' :ZHDEP_eff_performance_getValue(erpCode1, date, '額外考績') }}</td>
              <td>{{  formatCurrency(ZHDEP_eff_performance_getValue(erpCode1, date, '考績獎金'))=== '0' ? '-' :formatCurrency(ZHDEP_eff_performance_getValue(erpCode1, date, '考績獎金')) }}</td>
              <td>{{formatCurrency(ZHDEP_eff_performance_getValue(erpCode1, date, '額外考績獎金'))=== '0' ? '-' : formatCurrency(ZHDEP_eff_performance_getValue(erpCode1, date, '額外考績獎金'))}}</td>
              <td>{{formatCurrency(ZHDEP_eff_performance_getValue(erpCode1, date, 'A15拉管理福利金'))=== '0' ? '-' : formatCurrency(ZHDEP_eff_performance_getValue(erpCode1, date, 'A15拉管理福利金'))}}</td>
             
              <td>
                {{
                  (totalBonus => (isNaN(totalBonus) || totalBonus === 0) ? '-' : formatCurrency(totalBonus))(
                    parseFloat(QCDEP_eff_performance_getValue(erpCode1, date, '考績獎金') || '0') +
                    parseFloat(QCDEP_eff_performance_getValue(erpCode1, date, '額外考績獎金') || '0') +
                    parseFloat(QCDEP_eff_performance_getValue(erpCode1, date, 'A15拉管理福利金') || '0')
                  )
                }}
              </td>
              
              <td>{{ eff_performance_formatNumber2(ZHDEP_eff_performance_getValue(erpCode1, date, '下月累計負值')) }}</td>
            </template>
          </template>
        </tr>
      </tr>
      <td colspan="16">Total</td>
      <td>{{formatCurrency( totalZHFinalBonus) }}</td>
    </tr>
      </tbody>
    </table>
    <table id="eff120" v-show="currentSheet === 6">
      <thead>
        <tr>
          <th>班別代號<br>Mã ca làm việc</th>
          <th>料號<br>Mã vật tư</th>
          <th>客戶料號<br> Số bộ phận của khách hàng</th>
          <th>工單數量<br>Mã vật tư</th>
          <th>數量<br>Số lượng</th>
          <th>標準工時<br>Giờ công tiêu chuẩn</th>
          <th>實際工時<br>Giờ công thực tế</th>
          <th>效率<br>Hiệu suất</th>
          <th>建議調整標準工時<br>Hiệu suất</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="(item, index) in eff_performance_eff120data" :key="item.ID">
          <td>{{ item.SHIFT }}</td>
          <td>{{ item.ITEMNUM }}</td>
          <td>{{ item.wad01 }}</td>
          <td>{{ item.WONUM }}</td>
          <td>{{ item.QTY }}</td>
          <td>{{ item.SWH.toFixed(2) }}</td>
          <td>{{ item.AWH.toFixed(2) }}</td>
          <td>{{ (item.eff*100).toFixed(2) }}%</td>
          <td>{{ item.sug }}</td>
          
        </tr>
      </tbody>
    </table> 

</div>
<div class="right-content" v-if="SHOW_overflow_performance">

  <label>{{ translatedText.area }}:</label>
  <select id="PDareaSelect" v-model="selectedArea" @change="overflowper">
    <option value="ZH">ZH</option>
    <option value="TC">TC</option>
    <option value="VN">VN</option>
    <option value="TW">TW</option>
  </select>
  <label>year</label>
  <select id="PDareaSelect" v-model="selectedYear" @change="overflowper">
    <option value="2024">2024</option>
    <option value="2025">2025</option>
    <option value="2026">2026</option>
    <option value="2027">2027</option>
  </select>
  <label>month</label>
  <select id="monthSelect" v-model="selectedMonth" @change="overflowper">
    <option v-for="num in 12" :key="num" :value="String(num).padStart(2, '0')">
      {{ String(num).padStart(2, '0') }}
    </option>
  </select>
  <div class="tabs">
    <button v-for="(sheet, index) in sheets" 
            :key="index" 
            @click="currentSheet = index"
            :class="{ active: currentSheet === index }">
      {{ sheet.name }}
    </button>
    <button @click=" downloadExcelWOOVER" class="export-button">{{ translatedText.導出 }} Excel</button>
  </div>
  
    <table id="WOOEVER2" v-show="currentSheet === 0">
      <thead>
        <tr>
          <th rowspan="2">班別代號</th>
          <th v-for="(index, idx) in eff_performance_dates" 
              :key="'header-' + index" 
              :colspan="idx === eff_performance_dates.length - 1 ? '10' : '3'">
            {{ index }}
          </th>
        </tr>
        <tr>
          <template v-for="(index, idx) in eff_performance_dates" :key="'sub-header-' + index">
          <!--    <th>標準</th>
            <th>實際</th>-->
            <th>應領金額</th>
            <th>溢領金額</th>
            <th>溢領比例</th>
            <template v-if="idx === eff_performance_dates.length - 1">
              <th>歸還溢領</th>
              <th>當月溢領比例<BR>上升率</th>
              <th>當月最終<BR>效率考核</th>
              <th>考績</th> 
              <th>額外考績</th> 
              <th>下月歸還溢領</th>
            </template>
          </template>
        </tr>
      </thead>
      
      <tbody>
        <tr v-for="(index, erpCode1) in eff_performance_groupedData" :key="erpCode1" v-if="eff_performance_getValue(erpCode1, eff_performance_dates[2], '部門') === '2'">
          <td>{{ erpCode1 }}</td>
          <template v-for="(date, i) in eff_performance_dates" :key="'data-' + erpCode1 + '-' + date">
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時標準')) }}</td>-->
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時實際')) }}</td>-->
             <td> {{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '應領金額')) }} </td>
              <td> {{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '溢領金額')) }} </td>
                         <td :style="{ backgroundColor: eff_performance_getValue(erpCode1, date, '溢領比例') < 0.8 ? 'green' : '' }">
              {{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '溢領比例')) }}
            </td>
              <!-- <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '效率')) }}</td>-->
            <template v-if="i === eff_performance_dates.length - 1">
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '累計')) }}</td>
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '上升率')) }}</td>
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '績效')) }}</td>
              <td>{{eff_performance_getValue(erpCode1, date, '考績') }}</td>
              <td>{{eff_performance_getValue(erpCode1, date, '考績2') }}</td>
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '下月累計負值')) }}</td>
            </template>
          </template>
        </tr>
        <tr>
          <td>合计</td>
          <template v-for="(date, i) in eff_performance_dates" :key="'total-' + date">
            <td>{{ eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '應領金額', '2')) }}</td>
            <td>{{ eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '溢領金額', '2')) }}</td>
            <td>{{ eff_performance_formatNumber2(eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '溢領金額', '2'))
              /eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '應領金額', '2'))*100) }}</td>
            <!-- 其余单元格按需求填写 -->
          </template>
        </tr>
      </tbody>
    </table>
    <table id="WOOEVER3" v-show="currentSheet === 1">
      <thead>
        <tr>
          <th rowspan="2">班別代號</th>
          <th v-for="(index, idx) in eff_performance_dates" 
              :key="'header-' + index" 
              :colspan="idx === eff_performance_dates.length - 1 ? '10' : '3'">
            {{ index }}
          </th>
        </tr>
        <tr>
          <template v-for="(index, idx) in eff_performance_dates" :key="'sub-header-' + index">
          <!--    <th>標準</th>
            <th>實際</th>-->
            <th>應領金額</th>
            <th>溢領金額</th>
            <th>溢領比例</th>
            <template v-if="idx === eff_performance_dates.length - 1">
              <th>歸還溢領</th>
              <th>當月溢領比例<BR>上升率</th>
              <th>當月最終<BR>效率考核</th>
              <th>考績</th> 
              <th>額外考績</th> 
              <th>下月歸還溢領</th>
            </template>
          </template>
        </tr>
        
      </thead>
      
      <tbody>
        <tr v-for="(index, erpCode1) in eff_performance_groupedData" :key="erpCode1" v-if="eff_performance_getValue(erpCode1, eff_performance_dates[2], '部門') === '3'">
          <td>{{ erpCode1 }}</td>
          <template v-for="(date, i) in eff_performance_dates" :key="'data-' + erpCode1 + '-' + date">
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時標準')) }}</td>-->
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時實際')) }}</td>-->
             <td> {{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '應領金額')) }} </td>
              <td> {{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '溢領金額')) }} </td>
                         <td :style="{ backgroundColor: eff_performance_getValue(erpCode1, date, '溢領比例') < 0.8 ? 'green' : '' }">
              {{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '溢領比例')) }}
            </td>
              <!-- <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '效率')) }}</td>-->
            <template v-if="i === eff_performance_dates.length - 1">
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '累計')) }}</td>
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '上升率')) }}</td>
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '績效')) }}</td>
              <td>{{eff_performance_getValue(erpCode1, date, '考績') }}</td>
              <td>{{eff_performance_getValue(erpCode1, date, '考績2') }}</td>
              <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '下月累計負值')) }}</td>
            </template>
          </template>
        </tr>
        <tr>
          <td>合计</td>
          <template v-for="(date, i) in eff_performance_dates" :key="'total-' + date">
            <td>{{ eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '應領金額', '3')) }}</td>
            <td>{{ eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '溢領金額', '3')) }}</td>
            <td>{{ eff_performance_formatNumber2(eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '溢領金額', '3'))
              /eff_performance_formatNumber(eff_performance_sumColumn(eff_performance_groupedData, date, '應領金額', '3'))*100) }}</td>
            <!-- 其余单元格按需求填写 -->
          </template>
        </tr>
      </tbody>
    </table>
    <table id="WOPP3" v-show="currentSheet === 2">
      <thead>
        <tr>
          <th>工單</th>
          <th>部門</th>
          <th>料號</th>
          <th>數量</th>
          <th>標準工時</th>
          <th>執行工時</th>
        </tr>
        
      </thead>
      <tbody>
        <tr v-for="(item, index) in eff_performance_ppwodata" :key="item.ID">
          <td>{{ item.WONUM }}</td>
          <td>{{ item.SHIFT }}</td>
          <td>{{ item.wad01 }}</td>
          <td>{{ item.QTY }}</td>
          <td>{{ item.SWH }}</td>
          <td>{{ item.AWH }}</td>
        </tr>
        <tr v-if="eff_performance_ppwodata.length > 0">
          <td>比例</td>
          <td>{{ eff_performance_ppwodata[0].Total_PP_T }}/{{ eff_performance_ppwodata[0].Total_WONUM }}</td>
          <td colspan="2">合計</td>
          <td>{{ totalSWH }}</td>
          <td>{{ totalAWH }}</td>
        </tr>
      </tbody>
    </table> 
    <table ID="DEPOVER" v-show="currentSheet === 3">
      <thead>
        <tr>
          <th rowspan="2">部門</th>
          <th rowspan="2">班</th>
          <th rowspan="2">工號</th>
          <th rowspan="2">姓名</th>
          <th rowspan="2">上班天數</th>
          <th rowspan="2">職稱</th>
          <th v-for="(index, idx) in DEP_eff_performance_dates" 
              :key="'header-' + index" 
              :colspan="idx === DEP_eff_performance_dates.length - 1 ? '11' : '1'">
            {{ index }}
          </th>
        </tr>
        <tr>
          <template v-for="(index, idx) in DEP_eff_performance_dates" :key="'sub-header-' + index">
          <!--    <th>標準</th>
            <th>實際</th>-->
            <th>效率</th>
            <template v-if="idx === DEP_eff_performance_dates.length - 1">
              <th>累計<BR>負值效率</th>
              <th>當月效率<BR>上升率</th>
              <th>當月最終<BR>效率考核</th>
              <th>考績</th> 
              <th>額外考績</th> 
              <th>考績獎金</th> 
              <th>額外考績獎金</th> 
              <th>A15拉管理福利金</th> 
              <th>最終獎金</th> 
              <th>下月累計<BR>負值效率</th>
            </template>
          </template>
        </tr>
      </thead>
      
      <tbody>
        <tr v-for="(index, erpCode1) in DEP_eff_performance_groupedData" :key="erpCode1">

          <td>{{DEP_eff_performance_getValue(erpCode1, '202508', '部') }}</td>
          <td>{{DEP_eff_performance_getValue(erpCode1, '202508', '班') }}</td>
          <td>{{ erpCode1 }}</td>
          <td>{{DEP_eff_performance_getValue(erpCode1, '202508', '姓名') }}</td>
          <td>{{DEP_eff_performance_getValue(erpCode1, '202508', 'LAMDAY_STR') }}</td>
          <td>{{DEP_eff_performance_getValue(erpCode1, '202508', '崗位') }}</td>
          <template v-for="(date, i) in DEP_eff_performance_dates" :key="'data-' + erpCode1 + '-' + date">
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時標準')) }}</td>-->
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時實際')) }}</td>-->
             <td :style="{ backgroundColor: DEP_eff_performance_getValue(erpCode1, date, '效率') < 0.8 ? 'green' : '' }">
              {{ eff_performance_formatNumber2(DEP_eff_performance_getValue(erpCode1, date, '效率')) }}
            </td>
              <!-- <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '效率')) }}</td>-->
            <template v-if="i === DEP_eff_performance_dates.length - 1">
              <td>{{ eff_performance_formatNumber2(DEP_eff_performance_getValue(erpCode1, date, '累計')) }}</td>
              <td>{{ eff_performance_formatNumber2(DEP_eff_performance_getValue(erpCode1, date, '上升率')) }}</td>
              <td>{{ eff_performance_formatNumber2(DEP_eff_performance_getValue(erpCode1, date, '績效')) }}</td>
              <td>{{DEP_eff_performance_getValue(erpCode1, date, '考績')=== '0' ? '-' :DEP_eff_performance_getValue(erpCode1, date, '考績') }}</td>
              <td>{{DEP_eff_performance_getValue(erpCode1, date, '額外考績') === '0' ? '-' :DEP_eff_performance_getValue(erpCode1, date, '額外考績') }}</td>
              <td>{{  formatCurrency(DEP_eff_performance_getValue(erpCode1, date, '考績獎金'))=== '0' ? '-' : formatCurrency(DEP_eff_performance_getValue(erpCode1, date, '考績獎金'))}}</td>
              <td>{{formatCurrency(DEP_eff_performance_getValue(erpCode1, date, '額外考績獎金'))=== '0' ? '-' : formatCurrency(DEP_eff_performance_getValue(erpCode1, date, '額外考績獎金'))}}</td>
              <td>{{formatCurrency(DEP_eff_performance_getValue(erpCode1, date, 'A15拉管理福利金')) }}</td>
              <td>{{formatCurrency(DEP_eff_performance_getValue(erpCode1, date, '最終獎金'))=== '0' ? '-' :formatCurrency(DEP_eff_performance_getValue(erpCode1, date, '最終獎金')) }}</td>
              <td>{{ eff_performance_formatNumber2(DEP_eff_performance_getValue(erpCode1, date, '下月累計負值')) }}</td>
            </template>
          </template>
        </tr>
        <tr>
          <td colspan="17">Total</td>
          <td>{{formatCurrency( totalFinalBonus) }}</td>
        </tr>
      </tbody>
    </table>

    <!-- 第二個表的內容，與第一個表類似，可根據需要替換 -->
    <table ID="STAFF_OVERBOUNS" v-show="currentSheet === 4"> 
      <thead>
        <tr>
          <th>班別代號<br>Mã ca làm việc</th>
          <th>工號<br>Mã công nhân</th>
          <th>姓名<br>Tên</th>
         <!-- <th>文員統計天數</th>-->
          <th>工作天數<br>Số ngày làm việc</th>
          <th>請假天數<br>Số ngày nghỉ phép</th>
          <th>崗位<br>Vị trí</th>
          <th>績效等級-I<br>Cấp độ hiệu suất - I</th>
          <th>獎金-I<br>Thưởng-I</th>
          <th>績效等級-II<br>Cấp độ hiệu suất - II</th>
          <th>獎金-Ii<br>Thưởng-II</th>
          <th>最終獎金<br>Thưởng cuối cùng</th>
        </tr>
      </thead>
      <tbody>
        <template v-for="(group, shift) in groupedByShift">
          <tr v-for="(item, index) in group" :key="item.ID">
            <td>{{ item.SHIFT }}</td>
            <td>{{ item.JOB }}</td>
            <td>{{ item.USERNAME }}</td>
           <!--   <td>{{ item.DAYTIME }}</td>-->
            <td>{{ item.LAMDAY }}</td>
            <td>{{ item.請假天數 }}</td>
            <td>{{ item.IMPORT }}</td>
            <td>{{ item.note }}</td>
            <td>{{ formatCurrency(item.績效) }}</td>
            <td>{{ item.note2 }}</td>
            <td>{{ formatCurrency(item.額外績效) }}</td>
            <td>{{ formatCurrency(item.實際獎金) }}</td>
          </tr>
          <!-- 插入 item.SHIFT 的實際獎金統計行 -->
          <tr>
            <td colspan="9">部門 {{ shift }} 統計</td>
            <td colspan="3">{{formatCurrency(calculateShiftBonus(shift)) }}</td>
          </tr>
        </template>
        <!-- 插入總計行 -->
        <tr>
          <td colspan="9">Total</td>
          <td colspan="3">{{ formatCurrency(totalBonus) }}</td>
        </tr>
      </tbody>
    </table>
    <table ID="QCDEPOVER" v-show="currentSheet === 5">
      <thead>
        <tr>
          <th rowspan="2">部門</th>
          <th rowspan="2">班</th>
          <th rowspan="2">工號</th>
          <th rowspan="2">姓名</th>
          <th rowspan="2">職稱</th>
          <th v-for="(index, idx) in QCDEP_eff_performance_dates" 
              :key="'header-' + index" 
              :colspan="idx === QCDEP_eff_performance_dates.length - 1 ? '11' : '1'">
            {{ index }}
          </th>
        </tr>
        <tr>
          <template v-for="(index, idx) in QCDEP_eff_performance_dates" :key="'sub-header-' + index">
          <!--    <th>標準</th>
            <th>實際</th>-->
            <th>效率</th>
            <template v-if="idx === QCDEP_eff_performance_dates.length - 1">
              <th>累計<BR>負值效率</th>
              <th>當月效率<BR>上升率</th>
              <th>當月最終<BR>效率考核</th>
              <th>考績</th> 
              <th>額外考績</th> 
              <th>考績獎金</th> 
              <th>額外考績獎金</th> 
              <th>A15拉管理福利金</th> 
              <th>最終獎金<br>Thưởng cuối cùng</th> 
              <th>下月累計<BR>負值效率</th>
            </template>
          </template>
        </tr>
      </thead>
      
      <tbody>
        <tr v-for="(index, erpCode1) in QCDEP_eff_performance_groupedData" :key="erpCode1">

          <td>{{QCDEP_eff_performance_getValue(erpCode1, '202508', '部') }}</td>
          <td>{{QCDEP_eff_performance_getValue(erpCode1, '202508', '班') }}</td>
          <td>{{ erpCode1 }}</td>
          <td>{{QCDEP_eff_performance_getValue(erpCode1, '202508', '姓名') }}</td>
          <td>{{QCDEP_eff_performance_getValue(erpCode1, '202508', '崗位') }}</td>
          <template v-for="(date, i) in QCDEP_eff_performance_dates" :key="'data-' + erpCode1 + '-' + date">
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時標準')) }}</td>-->
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時實際')) }}</td>-->
             <td :style="{ backgroundColor: QCDEP_eff_performance_getValue(erpCode1, date, '效率') < 0.8 ? 'green' : '' }">
              {{ eff_performance_formatNumber2(QCDEP_eff_performance_getValue(erpCode1, date, '效率')) }}
            </td>
              <!-- <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '效率')) }}</td>-->
            <template v-if="i === QCDEP_eff_performance_dates.length - 1">
              <td>{{ eff_performance_formatNumber2(QCDEP_eff_performance_getValue(erpCode1, date, '累計')) }}</td>
              <td>{{ eff_performance_formatNumber2(QCDEP_eff_performance_getValue(erpCode1, date, '上升率')) }}</td>
              <td>{{ eff_performance_formatNumber2(QCDEP_eff_performance_getValue(erpCode1, date, '績效')) }}</td>
              <td>{{QCDEP_eff_performance_getValue(erpCode1, date, '考績')=== '0' ? '-' :QCDEP_eff_performance_getValue(erpCode1, date, '考績') }}</td>
              <td>{{QCDEP_eff_performance_getValue(erpCode1, date, '額外考績') === '0' ? '-' :QCDEP_eff_performance_getValue(erpCode1, date, '額外考績') }}</td>
              <td>{{  formatCurrency(QCDEP_eff_performance_getValue(erpCode1, date, '考績獎金'))=== '0' ? '-' :formatCurrency(QCDEP_eff_performance_getValue(erpCode1, date, '考績獎金')) }}</td>
              <td>{{formatCurrency(QCDEP_eff_performance_getValue(erpCode1, date, '額外考績獎金'))=== '0' ? '-' : formatCurrency(QCDEP_eff_performance_getValue(erpCode1, date, '額外考績獎金'))}}</td>
              <td>{{formatCurrency(QCDEP_eff_performance_getValue(erpCode1, date, 'A15拉管理福利金')) }}</td>
              <td>{{formatCurrency(QCDEP_eff_performance_getValue(erpCode1, date, '最終獎金'))=== '0' ? '-' : formatCurrency(QCDEP_eff_performance_getValue(erpCode1, date, '最終獎金'))}}</td>

              
              
              <td>{{ eff_performance_formatNumber2(QCDEP_eff_performance_getValue(erpCode1, date, '下月累計負值')) }}</td>
            </template>
          </template>
        </tr>
      </tr>
      <td colspan="16">Total</td>
      <td>{{formatCurrency( totalQCFinalBonus) }}</td>
    </tr>
      </tbody>
    </table>
    <table ID="CNDEPOVER" v-show="currentSheet === 7">
      <thead>
        <tr>
          <th rowspan="2">部門</th>
          <th rowspan="2">班</th>
          <th rowspan="2">工號</th>
          <th rowspan="2">姓名</th>
          <th rowspan="2">職稱</th>
          <th v-for="(index, idx) in ZHDEP_eff_performance_dates" 
              :key="'header-' + index" 
              :colspan="idx === ZHDEP_eff_performance_dates.length - 1 ? '11' : '1'">
            {{ index }}
          </th>
        </tr>
        <tr>
          <template v-for="(index, idx) in ZHDEP_eff_performance_dates" :key="'sub-header-' + index">
          <!--    <th>標準</th>
            <th>實際</th>-->
            <th>效率</th>
            <template v-if="idx === ZHDEP_eff_performance_dates.length - 1">
              <th>累計<BR>負值效率</th>
              <th>當月效率<BR>上升率</th>
              <th>當月最終<BR>效率考核</th>
              <th>考績</th> 
              <th>額外考績</th> 
              <th>考績獎金</th> 
              <th>額外考績獎金</th> 
              <th>A15拉管理福利金</th> 
              <th>最終獎金<br>Thưởng cuối cùng</th> 
              <th>下月累計<BR>負值效率</th>
            </template>
          </template>
        </tr>
      </thead>
      
      <tbody>
        <tr v-for="(index, erpCode1) in ZHDEP_eff_performance_groupedData" :key="erpCode1">

          <td>{{ZHDEP_eff_performance_getValue(erpCode1, '202508', '部') }}</td>
          <td>{{ZHDEP_eff_performance_getValue(erpCode1, '202508', '班') }}</td>
          <td>{{ erpCode1 }}</td>
          <td>{{ZHDEP_eff_performance_getValue(erpCode1, '202508', '姓名') }}</td>
          <td>{{ZHDEP_eff_performance_getValue(erpCode1, '202508', '崗位') }}</td>
          <template v-for="(date, i) in ZHDEP_eff_performance_dates" :key="'data-' + erpCode1 + '-' + date">
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時標準')) }}</td>-->
             <!--  <td>{{ eff_performance_formatNumber(eff_performance_getValue(erpCode1, date, '人時實際')) }}</td>-->
             <td :style="{ backgroundColor: ZHDEP_eff_performance_getValue(erpCode1, date, '效率') < 1 ? 'green' : '' }">
              {{ eff_performance_formatNumber2(ZHDEP_eff_performance_getValue(erpCode1, date, '效率')) }}
            </td>
              <!-- <td>{{ eff_performance_formatNumber2(eff_performance_getValue(erpCode1, date, '效率')) }}</td>-->
            <template v-if="i === ZHDEP_eff_performance_dates.length - 1">
              <td>{{ eff_performance_formatNumber2(ZHDEP_eff_performance_getValue(erpCode1, date, '累計')) }}</td>
              <td>{{ eff_performance_formatNumber2(ZHDEP_eff_performance_getValue(erpCode1, date, '上升率')) }}</td>
              <td>{{ eff_performance_formatNumber2(ZHDEP_eff_performance_getValue(erpCode1, date, '績效')) }}</td>
              <td>{{ZHDEP_eff_performance_getValue(erpCode1, date, '考績')=== '0' ? '-' :ZHDEP_eff_performance_getValue(erpCode1, date, '考績') }}</td>
              <td>{{ZHDEP_eff_performance_getValue(erpCode1, date, '額外考績') === '0' ? '-' :ZHDEP_eff_performance_getValue(erpCode1, date, '額外考績') }}</td>

              <td>{{  formatCurrency(ZHDEP_eff_performance_getValue(erpCode1, date, '考績獎金'))=== '0' ? '-' :formatCurrency(ZHDEP_eff_performance_getValue(erpCode1, date, '考績獎金')) }}</td>
              <td>{{formatCurrency(ZHDEP_eff_performance_getValue(erpCode1, date, '額外考績獎金'))=== '0' ? '-' : formatCurrency(ZHDEP_eff_performance_getValue(erpCode1, date, '額外考績獎金'))}}</td>
              <td>{{formatCurrency(ZHDEP_eff_performance_getValue(erpCode1, date, 'A15拉管理福利金')) }}</td>
              <td>
                {{
                  (totalBonus => isNaN(totalBonus) || totalBonus === 0 ? '-' : formatCurrency(totalBonus))(
                    (parseFloat(ZHDEP_eff_performance_getValue(erpCode1, date, '考績獎金')) || 0) +
                    (parseFloat(ZHDEP_eff_performance_getValue(erpCode1, date, '額外考績獎金')) || 0) +
                    (parseFloat(ZHDEP_eff_performance_getValue(erpCode1, date, 'A15拉管理福利金')) || 0)
                  )
                }}
              </td>

              <td>{{ eff_performance_formatNumber2(ZHDEP_eff_performance_getValue(erpCode1, date, '下月累計負值')) }}</td>
            </template>
          </template>
        </tr>
      </tr>
      <td colspan="16">Total</td>
      <td>{{formatCurrency( totalZHFinalBonus) }}</td>
    </tr>
      </tbody>
    </table>








</div>

<div  class="right-content" v-if="SHOW_RATING_VERSON">
  <label >{{ translatedText.area }}:</label>
  <select id="PDareaSelect" v-model="selectedArea" @change="RATING_SUM_VER">
    <option value="ZH">ZH</option>
    <option value="TC">TC</option>
    <option value="VN">VN</option>
    <option value="TW">TW</option>
  </select>

  <input type="date" v-model="selectedDate" @change="RATING_SUM_VER">
  <header > {{ selectedDate}}產能日報</header>
  <br></br>


  <table>
    <thead>
      <tr>
        <th  class="number-column">{{ translatedText.show }} <input type="checkbox" @change="toggleRATINGSelectAll" v-model="WOselectAll"></th>
        <th>{{ translatedText.部門 }}</th>
        <th>人數</th>
        <th>做線</th>
        <th>焊接</th>
        <th>成型</th>

      </tr>

    </thead>

    <tbody style="overflow-y: scroll" >
      <template v-for="(item, index) in RATING_SUM_VERSON">

       <tr :key="item.部門">
        <td >
          <input class="ATT_INPUT" type="checkbox" v-model="showInSecondTable[item.部門]" @click="RATINGVER(item.部門)"  >
        </td>
        <td  v-if="index === 0 || item.部門 !== RATING_SUM_VERSON[index - 1].部門" :rowspan="countShiftDesc(index,RATING_SUM_VERSON)">{{ formatDepartment(item.部門) }}</td>
        <td>{{ item.人數  }}</td>
        <td>{{ item.做線  }}</td>
        <td>{{ item.焊接 }}</td>
        <td>{{ item.成型}}</td>

       </tr>
     </template>
    </tbody>
  </table>

  <hr></hr>
  <!-- <div class="container">
<button @click="show_ADJ" >調整</button>
    <button v-if="showADJs" @click="CHECK_WOADJ" >確定</button>
    <button v-if="showADJs" @click="show_ADJ_CANCEL" >取消</button>
 <button @click="downloadWOExcel" class="export-button">导出 Excel</button>
  </div>-->


  <table ID="WO2">
    <thead>
      <tr>
        <th>部門</th>
        <th>工號</th>
        <th>姓名</th>
        <th>工段</th>
        <th>時間</th>
        <th>總數量</th>
        <th>8-10</th>
        <th>10-12</th>
        <th>13-15</th>
        <th>15-17</th>
        <th>17-20</th>
        <!-- <th v-if="showADJs">調整</th>-->

      </tr>
    </thead>
    <tbody style="overflow-y: scroll" >
      <template v-for="(item, index) in RATINGVERSON">

        <tr :key="item.部門"  v-if="showInSecondTable[item.部門]">
        <td v-if="index === 0 || item.部門 !== RATINGVERSON[index - 1].部門" :rowspan="countShiftDesc(index,RATINGVERSON)">{{ formatDepartment(item.部門) }}</td>
        <td>{{ item.JOB_NUMBER }}</td>
        <td>{{ item.USER_NAME}}</td>
        <td>{{ item.WORK_CONTENT }}</td>
        <td>{{ item.DATE_MINUTE }}</td>
        <td>{{ item.COMPLETED_QTY }}</td>
        <td>{{ item.COMPLETED_QTY_1 }}</td>
        <td>{{ item.COMPLETED_QTY_2 }}</td>
        <td>{{ item.COMPLETED_QTY_3 }}</td>
        <td>{{ item.COMPLETED_QTY_4 }}</td>
        <td>{{ item.COMPLETED_QTY_5 }}</td>
            <!--  <td v-if="showADJs">       <input type="number" v-model="item.ADJ" step="0.01"></td>     -->


       </tr>
     </template>
    </tbody>

  </table>

</div>  
<div  class="right-content" v-if="SF_SN_MG">
  <h3>生成序號</h3>
  <form @submit.prevent="generateSerialNumbers">
    <div>
      <label for="woId">工單號:</label>
      <input type="text" id="woId" v-model="woId" required />
    </div>
    <div>
      <label for="initialSerialNumber">初始序號:</label>
      <input
        type="text"
        id="initialSerialNumber"
        v-model="initialSerialNumber"
        required
      />
    </div>
    <div>
      <label for="count">生成數量:</label>
      <input
        type="number"
        id="count"
        v-model.number="count"
        min="1"
        required
      />
    </div>
    
    <button type="submit">生成</button>
  </form>

  <div v-if="responseMessage" class="response-message">
    <p>{{ responseMessage }}</p>
  </div>

</div>


<div class="right-content" v-if="showSET">
  <el-table
    v-if="tableData.length"
    :data="tableData"
    style="width: 100%"
    border
    stripe
  >
    <el-table-column
      prop="MACHINE_NUMBER"
      label="機台號碼"
      width="150">
    </el-table-column>
    <el-table-column
      prop="job_number"
      label="工單號碼"
      width="150">
    </el-table-column>
  </el-table>

  <p v-else style="color: gray;">資料載入中或目前沒有資料。</p>
</div>






   </div>






</div>


<script>
    Vue.component('hello-world', {
  extends: VueChartJs.Bar,
  props: ['Area', 'Year'],
  data() {
    return {
      chartData: {
        labels: [
          "January", "February", "March", "April", "May", "June", 
          "July", "August", "September", "October", "November", "December"
        ],
        datasets: [],
      },
      options: {
        scales: {
          y: {
            ticks: {
              callback: function(value) {
                return (value ) + '%';
              }
            },

            position: 'left',
            title: {
              display: true,
              text: '效率',
              fontSize: 70,  // 设置字体大小
            },
            beginAtZero: false,
          },
          quantity: {
            position: 'right',
            title: {
              display: true,
              text: '',
              
              fontSize: 26,  // 设置字体大小
            },
            beginAtZero: true,
          },
        },
        responsive: true,
        maintainAspectRatio: false,

      },
      wodata:[],
    };
  },
  computed: {
    quantityTitleText() {
      return this.Area === 'VN' ? '人時差異(含製費)(VND)' : '人時差異(含製費)(RMB)';
    }
  },
  watch: {
    quantityTitleText(newText) {
      this.options.scales.quantity.title.text = newText;
    }
  },
  mounted() {
    this.options.scales.quantity.title.text = this.quantityTitleText;
    this.renderChart(this.chartData, this.options);
  },
  methods: {

    fetchData() {
      const apiUrl = `http://192.168.207.17:5024/api/Report/WOQTY?AREA=${this.Area}&YEAR=${this.Year}`;

      axios.get(apiUrl)
        .then(response => {
          this.wodata=response.data;
          this.fetchData2();
        })
        .catch(error => {
          console.error('Error fetching data:', error);
        });
    },
    fetchData2() {
      const apiUrl = `http://192.168.207.17:5024/api/Report/WOEFF?AREA=${this.Area}&YEAR=${this.Year}`;

      axios.get(apiUrl)
        .then(response => {
          this.wodata.push(...response.data);
          this.processData();
        })
        .catch(error => {
          console.error('Error fetching data:', error);
        });
    },
    processData() {
      // Clear existing datasets
      this.chartData.datasets = [];
      // Define fixed colors for each label
      const labelColors = {
        '1D': 'rgba(255, 192, 192, 1)',
        '2D': 'rgba(75, 192, 192, 1)',
        '3D': 'rgba(255, 99, 132, 1)',
        '4D': 'rgba(255, 205, 86, 1)',
        '6D': 'rgba(54, 162, 235, 1)',
        '': 'rgba(54, 205, 235, 1)',
        '2D1S': 'rgba(255, 99, 132, 1)', // 粉红色
    '2D2S': 'rgba(255, 165, 0, 1)',   // 澄色
    '3D1S': 'rgba(25, 101, 0, 1)', 
    '3D2S': 'rgba(75, 192, 192, 1)',     // 绿色
    '4D1S': 'rgba(54, 162, 235, 1)',     // 蓝色
    '6D1S': 'rgba(75, 0, 130, 1)',    // 靛色
    '6D2S': 'rgba(128, 0, 128, 1)',   // 紫色
        // Add more colors if needed
      };

      // Process each dataset
      this.wodata.forEach(item => {
  let chartType, yAxisID, label2;

  if (item.item === '效率') {
    chartType = 'line';
    yAxisID = 'y';
    label2 = `${item.d}  (效率)`;
  } else if (item.item === '人時差異(含製費)(VND)') {
    chartType = 'bar';
    yAxisID = 'quantity';
    label2 = `${item.d}   人時差異(含製費)(VND)`;
  }else if (item.item === '人時差異(含製費)(RMB)') {
    chartType = 'bar';
    yAxisID = 'quantity';
    label2 = `${item.d}  人時差異(含製費)(RMB)`;
  } else {
    // 添加默認的圖表類型和標籤
    return;
  }

  const dataValues = Object.values(item).slice(2);
        console.log('值.11',dataValues);
        const filteredData = dataValues.map(value => (value === '' ? null : parseFloat(value) ));



// If item.item is '效率', multiply values by 100
if (item.item === '效率') {
  const filteredData = dataValues.map(value => (value === '' ? null : parseFloat(value) *100 ));
}

// 检查数据是否全部为 null，如果是则不添加数据集

       if (filteredData.every(value => value === null)) {
              return;
              }
           
  const dataset = {
    type: chartType,
    label: label2,
    backgroundColor: labelColors[item.d] || 'rgba(0, 0, 0, 1)', // Use fixed color or default
    borderColor: labelColors[item.d] || 'rgba(75, 192, 192, 1)',
    borderWidth: 2,
    yAxisID: yAxisID,
    data: filteredData,
  };

  this.chartData.labels = Object.keys(item).slice(2);
  this.chartData.datasets.push(dataset);
});

      // Render the updated chart
      this.renderChart(this.chartData, this.options);
    },
  },

});

    Vue.component('report', {
      props: ['Area', 'Year'],
  template: `
    <div>
      <template v-for="(subTable, key) in groupedData">
        <h2>{{ key }} 部</h2>
        <table >
          <caption style="text-align: right; font-style: italic;">資料來源: ERP
人時差異(含製費): 直接人工效率差異-實際差異+製造費用差異-實際差異</caption>
          <thead>
            <tr class="sticky-header">
              <th>Department</th>
              <th>Item</th>
              <th>January</th>
              <th>February</th>
              <th>March</th>
              <th>April</th>
              <th>May</th>
              <th>June</th>
              <th>July</th>
              <th>August</th>
              <th>September</th>
              <th>October</th>
              <th>November</th>
              <th>December</th>
            </tr>
          </thead>
          <tbody>
            <template v-for="(row, index) in subTable" :key="index">
              <tr>
                <td v-if="index === 0 || row.shiftDesc !== subTable[index - 1].shiftDesc" :rowspan="countShiftDesc(index, subTable)">{{ row.shiftDesc }}</td>
                
                <td :style="{ 'white-space': 'nowrap' }">{{ row.item }}</td>

<td v-if="parseFloat(row.jan) !== null && !isNaN(parseFloat(row.jan))" 
    :style="{ 'background-color': row.item === '效率' && parseFloat(row.jan) < 90.00 ? 'red' : 'white' }">
    
    {{ row.item === '效率' ? (parseFloat(row.jan) ).toFixed(2) + '%' :
       row.jan }}
</td>
<td v-else></td>

    <td v-if="parseFloat(row.feb)  !== null && !isNaN(parseFloat(row.feb))" :style="{ 'background-color': row.item === '效率' && parseFloat(row.feb) < 90.00 ? 'red' : 'white' }">{{ row.item === '效率' ? (parseFloat(row.feb) ).toFixed(2) + '%' : row.feb }}</td>
    <td v-else></td>
    <td v-if="parseFloat(row.mar)  !== null && !isNaN(parseFloat(row.mar))" :style="{ 'background-color': row.item === '效率' && parseFloat(row.mar) < 90.00 ? 'red' : 'white' }">{{ row.item === '效率' ? (parseFloat(row.mar) ).toFixed(2) + '%' : row.mar }}</td>
    <td v-else></td>
    <td v-if="parseFloat(row.apr)  !== null && !isNaN(parseFloat(row.apr))" :style="{ 'background-color': row.item === '效率' && parseFloat(row.apr) < 90.00 ? 'red' : 'white' }">{{ row.item === '效率' ? (parseFloat(row.apr) ).toFixed(2) + '%' : row.apr }}</td>
    <td v-else></td>
    <td v-if="parseFloat(row.may)  !== null && !isNaN(parseFloat(row.may))" :style="{ 'background-color': row.item === '效率' && parseFloat(row.may) < 90? 'red' : 'white' }">{{ row.item === '效率' ? (parseFloat(row.may) ).toFixed(2) + '%' : row.may }}</td>
    <td v-else></td>
    <td v-if="parseFloat(row.jun)  !== null && !isNaN(parseFloat(row.jun))" :style="{ 'background-color': row.item === '效率' && parseFloat(row.jun) < 90 ? 'red' : 'white' }">{{ row.item === '效率' ? (parseFloat(row.jun) ).toFixed(2) + '%' : row.jun }}</td>
    <td v-else></td>
    <td v-if="parseFloat(row.jul)  !== null && !isNaN(parseFloat(row.jul))" :style="{ 'background-color': row.item === '效率' && parseFloat(row.jul) < 90? 'red' : 'white' }">{{ row.item === '效率' ? (parseFloat(row.jul) ).toFixed(2) + '%' : row.jul }}</td>
    <td v-else></td>
    <td v-if="parseFloat(row.aug)  !== null && !isNaN(parseFloat(row.aug))" :style="{ 'background-color': row.item === '效率' && parseFloat(row.aug) < 90? 'red' : 'white' }">{{ row.item === '效率' ? (parseFloat(row.aug) ).toFixed(2) + '%' : row.aug }}</td>
    <td v-else></td>
    <td v-if="parseFloat(row.sep)  !== null && !isNaN(parseFloat(row.sep))" :style="{ 'background-color': row.item === '效率' && parseFloat(row.sep) < 90? 'red' : 'white' }">{{ row.item === '效率' ? (parseFloat(row.sep) ).toFixed(2) + '%' : row.sep }}</td>
    <td v-else></td>
    <td v-if="parseFloat(row.oct)  !== null && !isNaN(parseFloat(row.oct))" :style="{ 'background-color': row.item === '效率' && parseFloat(row.oct) < 90? 'red' : 'white' }">{{ row.item === '效率' ? (parseFloat(row.oct) ).toFixed(2) + '%' : row.oct }}</td>
    <td v-else></td>
    <td v-if="parseFloat(row.nov)  !== null && !isNaN(parseFloat(row.nov))" :style="{ 'background-color': row.item === '效率' && parseFloat(row.nov) < 90 ? 'red' : 'white' }">{{ row.item === '效率' ? (parseFloat(row.nov) ).toFixed(2) + '%' : row.nov }}</td>
    <td v-else></td>    
    <td v-if="parseFloat(row.dec)  !== null  && !isNaN(parseFloat(row.dec)) " :style="{ 'background-color': row.item === '效率' && parseFloat(row.dec) < 90 ? 'red' : 'white' }">{{ row.item === '效率' ? (parseFloat(row.dec) ).toFixed(2) + '%' : row.dec }}</td>
    <td v-else></td>

              </tr>
            </template>
          </tbody>
        </table>
      </template>
    </div>
  `,
  data() {
    return {
      report: [],
    };
  },
  computed: {
    groupedData() {
      // 根據 row.D 將數據分組
      const groupedData = {};
      this.report.forEach(row => {
        if (!groupedData[row.d]) {
          groupedData[row.d] = [];
        }
        groupedData[row.d].push(row);
      });
      return groupedData;
    },
  },
  methods: {
    
    countShiftDesc(index, group) {
    let count = 1;
    const shiftDescCounts = {}; // 用于存储不同 shiftDesc 的计数

    while (index + count < group.length && group[index + count].shiftDesc === group[index].shiftDesc) {
      count++;

      // 统计每个不同 shiftDesc 的次数
      const currentShiftDesc = group[index].shiftDesc;
      shiftDescCounts[currentShiftDesc] = (shiftDescCounts[currentShiftDesc] || 0) + 1;
    }

    console.log("ShiftDesc Counts:", shiftDescCounts); // 输出不同 shiftDesc 的次数
    return count;
  },
    fetchReportData() {
      // 使用 Axios 或其他 HTTP 請求庫從 API 獲取數據
      // 這裡僅為示範，實際上應使用你喜歡的方式進行 API 請求
      // 這裡使用 fetch API

      fetch(`http://192.168.207.17:5024/api/Report?AREA=${this.Area}&YEAR=${this.Year}`)
        .then(response => response.json())
        .then(data => {
          this.report = data;
        })
        .catch(error => {
          console.error('Error fetching report data:', error);
        });
    },
  },
  mounted() {

  },
});
Vue.component('pdr-report', {
  extends: VueChartJs.Bar,
  props: ['Area'],
  data() {
    return {
      chartData: {
        labels: [
          "January", "February", "March", "April", "May", "June", 
          "July", "August", "September", "October", "November", "December"
        ],
        datasets: [],
      },
      options: {
        scales: {
          y: {
            ticks: {
              callback: function(value) {
                return (value ) + '%';
              }
            },

            position: 'left',
            title: {
              display: true,
              text: '效率',
              fontSize: 70,  // 设置字体大小
            },
            beginAtZero: false,
          },
        },
        responsive: true,
        maintainAspectRatio: false,
      },
    };
  },
  methods: {
    fetchData2() {

      const today = new Date();
      const year = today.getFullYear(); // 取得今天的年份

      const apiUrl = `http://192.168.207.17:5024/api/Report/WOEFF?AREA=${this.Area}&YEAR=${year}`;

      axios.get(apiUrl)
        .then(response => {
          this.processData2(response.data);
        })
        .catch(error => {
          console.error('Error fetching data:', error);
        });
    },
    processData2(apiData) {
      // Clear existing datasets
      this.chartData.datasets = [];

      // Define fixed colors for each label
      const labelColors = {
        '1D': 'rgba(255, 192, 192, 1)',
        '2D': 'rgba(75, 192, 192, 1)',
        '3D': 'rgba(255, 99, 132, 1)',
        '4D': 'rgba(255, 205, 86, 1)',
        '6D': 'rgba(54, 162, 235, 1)',
        '': 'rgba(54, 205, 235, 1)',
        '2D1S': 'rgba(255, 99, 132, 1)', // 粉红色
    '2D2S': 'rgba(255, 165, 0, 1)',   // 澄色
    '3D1S': 'rgba(25, 101, 0, 1)',   // 黄色
    '3D2S': 'rgba(75, 192, 192, 1)',     // 绿色
    '4D1S': 'rgba(54, 162, 235, 1)',     // 蓝色
    '6D1S': 'rgba(75, 0, 130, 1)',    // 靛色
    '6D2S': 'rgba(128, 0, 128, 1)',   // 紫色
        // Add more colors if needed
      };

      // Process each dataset
      apiData.forEach(item => {
        let chartType, yAxisID, label2;

        if (item.item === '效率') {
          chartType = 'line';
          yAxisID = 'y';
          label2 = `${item.d}  效率`;
        } else {
          // 添加默認的圖表類型和標籤
          return;
        }
        const dataValues = Object.values(item).slice(2);
        console.log('值.',dataValues);
        const filteredData = dataValues.map(value => (value === '' ? null : parseFloat(value) ));

// 检查数据是否全部为 null，如果是则不添加数据集
       if (filteredData.every(value => value === null)) {
              return;
              }

        const dataset = {
          type: chartType,
          label: label2,
          backgroundColor: labelColors[item.d] || 'rgba(0, 0, 0, 1)', // Use fixed color or default
          borderColor: labelColors[item.d] || 'rgba(0, 0, 0, 1)',
          borderWidth: 2,
          yAxisID: yAxisID,
        
          data:filteredData,
         
          
        };
        console.log('值.',dataset);
          
          this.chartData.labels = Object.keys(item).slice(2);
          this.chartData.datasets.push(dataset);
  
      });

      // Render the updated chart
      this.renderChart(this.chartData, this.options);
    },
  },
  mounted() {
    // 调用 fetchData 方法以获取数据并更新图表
    this.fetchData2();
  },
});


new Vue({

  el: '#app',
  data: {
     isOpen: true,
    editMode: false,
    showSET:false,
    selectedLabel:"",
    currentSheet: 0, // 預設顯示第1個工作表
      sheets: [
        { name: '二部績效' },
        { name: '三部績效' },
        { name: 'PP工單' },
        { name: '主管績效' },
        { name: '員工績效獎' },
        { name: '產線外人員績效' },
        { name: '效率大於120' },
      ],
    currentLanguage: 'zh',
    translatedText: {
                總數量:'總數量',
                一般:'一般',
                焊接:'焊接',
                成型:'成型',
                做線:'做線',
                焊接S:'焊接',
                成型S:'成型',
                做線S:'做線',
                在線生產看板: '在線生產看板',
                每日生產看版:'每日生產看版',
                星級完成數量:'重點工站完成數量',
                工單管理: '工單管理',
                工單查詢: '工單查詢',
                工站管理: '工站管理',
                工站設定:'工站設定',
                人員管理: '人員管理',
                考勤異常: '考勤異常',
                生產看版: '生產看版',
                工單分析圖表: '工單分析圖表',
                未結工單: '未結工單',
               完工數量:'完工數量',
                生產日報:'生產日報',
                產能日報:'產能日報',
                卡片設定:'卡片設定',
                考勤日報:'考勤日報',
                登入:'登入',
                NFC_SYSTEAM:'NFC 系統',
                考勤系統:'考勤系統',
                生產數據:'生產數據',
                area:'廠區',
                部門:'部門',
                D:'部',
                S:'課',
                C:'班',
                L:'拉',
                在線人數:'在線人數',
                應出席人數:'應出席人數',
                實際出席人數:'實際出席人數',
                請假人數:'請假人數',
               流水線在線人數:'流水線在線人數',
                借入人數:'借入人數',
                借出人數:'借出人數',
                工單列表:'工單列表',
                ID:'編號',
                工單:'工單',
                品名:'品名',
                數量:'數量',
                標準工時:'標準工時',
                執行工時:'執行工時',
                當前效率:'當前效率',
                過往效率:'過往效率',
                已完成數量:'已完成數量',
                設備:'設備',
                姓名:'姓名',
                工時:'工時',
                工站:'工站',
                座位:'座位',
                工站列表:'工站列表',
                功能:'功能',
                fqcer1:'輸入值不能小於原值',
                fqcer2:'輸入值不能大於工單數量',
                完成:'完成',
                暫停:'暫停',
                復工:'復工',
                輸入工單:'輸入工單',
                查詢:'查詢',
                提交:'提交',
                workOrder1:'100:試產工單, 200:來料全檢, 400:重工,700 物料員工時',
                貼紙班:'貼紙班',
                裁剝班:'裁線班',
                料號:'料號',
                設定工單列表:'設定工單列表',
                移除:'移除',
                總和:'總和',
                choose:'選擇NFC_CODE',
                修改:'修改',
                取消:'取消',
                增加座位:'增加座位',
                刪除座位:'刪除座位',
                卡機號:'卡機號',
                工站名稱:'工站名稱',
                insert:'插入',
                delete:'刪除',
                New:'新增',
                出勤:'出勤',
                工作拉:'工作拉',
                工號:'工號',
                Status:'狀態',
                事由:'事由',
                年休:'年休',
                請假:'請假',
                哺乳假:'哺乳假',
                工傷:'工傷',
                工傷陪護:'工傷陪護',
                借出:'借出',
                新進員工:'新進員工',
                夜班:'夜班',
                考勤日報:'考勤日報',
                show:'顯示',
                出勤人數:'出勤人數',
                實際掛卡工時:'實際掛卡工時',
                總共考勤工時:'總共考勤工時',
                回報管理部考勤工時:'回報管理部考勤工時', 
                差異:'差異', 
                原因:'原因',
                輸入卡機:'輸入卡機',
                NFC卡號:'NFC卡號',
                NFC_CODE:'NFC_CODE',
                刷新:'刷新',
                在線工單:'在線工單',
                平均效率:'平均效率',
                低於90工單數:'低於90%工單數',
                已完成工單:'已完成工單',
                未結案工單:'未結案工單',
                無效工時:'無效工時(hrs)',
                本日:'本日',
                本月:'本月',
                上月:'上月',
                pd1:'備註：(本月、上月)資料來源ERP',
                應報考勤:'應報考勤',
                加總:'加總',
                導出:'導出',
                系統計算考勤工時:'系統計算考勤工時',
                增加有效考勤工時:'增加有效考勤工時',
                正班工時:'正班工時',
                加班工時:'加班工時',
                假別:'假別',
                更新完成:'更新完成',
                更新失敗:'更新失敗',
                重複輸入:'输入值重复，请重新输入！',
                查無卡號:'查無卡號',
                工單已存在:'该工單號已存在于表格中。',
                未添加工單:'未添加工單',
                查無工單:'查無工單，是否手動增加？',
                請輸暫停理由:'請輸暫停理由：',
                未生產:'未生產',
                調整:'調整',
                忘記設定:'忘記設定',
                忘記設定狀態:'忘記設定狀態',
                工作部門:'工作部門',
                備註:'備註',
                考勤調整確認:'考勤調整確認',
                日期:'日期',
                班別管理:'班別管理',
                工單狀態與ERP對比報表:'工單狀態與ERP對比報表',
                ERP入庫數量:'ERP入庫數量',
                過站管理:'過站管理',
                序號管理:'序號管理',
                序號查詢:'序號查詢',
                出貨序號表:'出貨序號表',
                不良品紀錄查詢:'不良品紀錄查詢',
                工站編號:'工站編號',
                綁定工站:'綁定工站',
                測試工站:'測試工站',
                輸入開始序號:'輸入開始序號',


            },
            showShopFloor: false,  // 控制是否显示 label, input 和 table
            Stickers:false,
            eff_performance_ppwodata: [],
            eff_performance_eff120data: [],
            eff_stff_bonus:[],
            eff_performance_data: [],
            RATING_data:[],
           eff_performance_dates: [],
           eff_performance_groupedData: {},
           DEP_eff_performance_data: [],
           DEP_eff_performance_dates: [],
           DEP_eff_performance_groupedData: {},
           QCDEP_eff_performance_data: [],
           QCDEP_eff_performance_dates: [],
           QCDEP_eff_performance_groupedData: {},
           ZHDEP_eff_performance_data: [],
           ZHDEP_eff_performance_dates: [],
           ZHDEP_eff_performance_groupedData: {},
           sfoperator: [
            // 示例数据
            { OPERATION_NO: '0', OPERATION_DESC: '重工', LINK: 'N', TEST: 'N' },
            { OPERATION_NO: '10', OPERATION_DESC: '萬用表測試', LINK: 'N', TEST: 'T' },
            { OPERATION_NO: '20', OPERATION_DESC: '標籤綁定', LINK: 'T', TEST: 'N' },
            { OPERATION_NO: '30', OPERATION_DESC: '外觀檢查', LINK: 'N', TEST: 'T' },
            { OPERATION_NO: '40', OPERATION_DESC: '最終測試', LINK: 'N', TEST: 'T' },
        ],
        isAuthenticated: false,
        user: {permissions: []},
        credentials: {
          username: '',
          password: '',
        },
        showDefectForming: false,   // 控制「成形」顯示/隱藏
        showDefectFormingNG: false, // 控制「成形NG」顯示/隱藏
        showDefectWelding: false,   // 控制「焊接」顯示/隱藏
        showDefectWeldingNG: false, // 控制「焊接NG」顯示/隱藏
                productOptions: [], // **存放品名列表**
        tableData: [  {            
          ID: "",
          AREA: "",
          MFG_DAY: "",
          DEPARTMENT: "",
          people: "",
          time: "",
          product: "",
          expected: "",
          actual: "",
          line: "",
          defectForming: "",
          defectWelding: "",
          NG: "",
          other1: "",
          other2: "0",
          other3: ""
        }
                ],
                timeOptions: {
            "8:00-10:00": 2.00,
            "10:00-11:20": 1.33,
            "12:20-15:00": 2.66,
            "15:00-17:00": 2,
            "17:00-20:00": 3
        },
        showSelect: false,        // 控制下拉選單的顯示
      selectedRemark: "",       // 暫停原因
      selectedpauseDate: "",
      currentWoId: null,        // 存儲當前的工單ID
      currentNfcCode: null,     // 存儲當前的NFC代碼
     sfsnData: null , // 存储 API 响应的所有数据
    scanContent: '',
    deviceSerial:'',
    displayContent: '',
     settingsOpen: false, // 新增状态用来控制是否展开设置
     performance: false,
     CHECHED: true,
     selectAll: false,
     WOselectAll: false,
     ighlight: false,
    showActions: false, // 控制功能列的显示与隐藏        
    loading: false,
     initialSerialNumber: "",
      count: 0,
      woId: "",
      responseMessage: null,
    showyear : false,
    showCLASS: false,
    showDemoContent: false,
    REWOID:false,
    woderpreport:false,
    iframeHeight:500,
    isButtonDisabled: false,
    selectednfccode:'',
    currentTime: '',
    SHOW_PD_VERSON: false,
    SHOW_WO_VERSON: false,
    SHOW_eff_performance: false,
    SHOW_overflow_performance:false,
    showRealTimeContent: false,
    showPDRealTimeContent: false,
    SHOPSTcontent:false,
   SHOW_RATING_VERSON: false,
   SF_SN_MG:false,
    SNLISTcontent:false,
    PDSNLISTcontent: false,
    FAILSNLISTcontent:false,
    wo_mangeContent:false,
    wo_selectment:false,
    fqc_mangeContent :false,
    seat_mangeContent:false,
    staff_mangeContent:false,
    ATT_timeContent:false,
    ATT_AbnormalContent:false,
    CARD_mangeContent:false,
    shift_mangeContent:false,
    oldPassword: "", // 舊密碼綁定
    newPassword: "", // 新密碼綁定
    showForm: false,
    stff_show2: false,
    ATT_ADJ_confirm:false,
    selectedmachine:'',
    selectedyear:'',
    selectedmonth:'',
    selectedYear:'',
    selectedMonth:'',
    selectedArea: '',
    SFselectedWO: '',
    selectedText:'',
    selectedLINK:'',
    selectedDESC1:'',
    selectedDESC2:'',
    TRANS1_LIMIT:0,
    TRANS2_LIMIT:0,
    SFselectedOPERATOR:'',
    selectedD:'',
    selectedS:'',
    selectedC:'',
    selectedL:'',
    userIp: '',
    inputValue: 0 ,
    snInput: '',  // 用戶輸入的 SN
      snList: [],   // API 返回的數據列表
      SFoperations:[],
    selectedDepartment: 'DSC',
    productionData: [], // 用于存储从 API 获取的数据
    dpOptions: [],
    CAEDoptions: [],
      selectedUsername: '',
      machine_card: null,
    realTimeData: [],
    shiftdata:[],
    QUERRYTIME: [],
    ERPDATA:[],
    ATT_time_ADJ_data:[],
    selectedERP:'',
    selectedpart:'',
    onlineData: [],
    seatData: [],
    staffData: [],
    sfHLinkList: [],    
    SFPDSNLINK:[],  // SF_H_LINK API 返回的數據
    SFPDSNLINKqty:[],  // SF_H_LINK API 返回的數據
    newStaff:[],
    newSHIFT:[],
    newSeat:[],
    PDVERSON:[],
    woderpdata:[],
    erpdata1:[],
    erpdata2:[],
    erpdata3:[],
    erpdata4:[],
    erpdata5:[],
    erpdata6:[],
    WOVERSON:[],
    transResponse:[],
    WO_SUM_VERSON:[],
    RATING_SUM_VERSON:[],
    RATINGVERSON:[],
    PDTOVERSON:[],
    HOSTMACHINE:[],
    ATT_Abnormal_d: [],
    ATT_time_data:[],
    ATT_time_SUM_data:[],
    attendanceData: [], // Data fetched from the API
    selectedJobNumber: '', // Selected job number
    selectedName: '', // Selected name
// Your condition to show rows
    fqc:[],
    MFG_D:'',
    isLoggedIn:false,
    repasswords:false,
    showADJs:false,
    username:'',
    password:'',
    power:'',
    showInSecondTable: {
        // 设置部门对应的初始状态为 true
        '2D1S1C': false 
      },
    dynamicHeaders: [], // 存儲動態列名（MFG_DAY）
    firstResult: [], // 存儲第一個查詢的數據
    chartInstance: null, // 保存图表实例
        secondResult: [],
        selectedItemDesc: '',
        selectedItemNum: '',
    selectedDate: '',
    selectedDate2: '',
    PDTYPESelect:'',
    selectedColor: '#00bfff',
    seateditMode:false,
    seathostid:'',
     showseatForm:false,
      scanContent: '',
      displayContent: '',
      showModal: false,
      modalMessage: '',
      adjWOValue: 0.00,
      showDialog: false,
      adjustmentValue: 0,
      selectedreson: '',
      resons: ['忘記掛卡/取卡', '掛卡異常', '網路異常', '斷電', '自離', '新員工', '重複掛卡','忘記設定狀態','掛錯卡', '狀態設定錯誤','其他'], // Example job orders
      currentItem: null,
      ATTSUMdata:[],
      ATTSUMdata2:[],
      WOSUMdata:[],
      WOSUMdata2:[],
      machines: ['01', '02', '03', '04'], // 機器編號陣列
      employmentTime: [
          { name: 'John Doe', STAR: 'Finance', END: 'Finance' },
          { name: 'Jane Smith', STAR: 'Finance', END: '2Finance' },
          { name: 'Michael Johnson', STAR: 'Finance', END: 'Finance' }
          // Add more employment time data here
        ],
        employees: [
          { name: 'John Doe', age: 30, department: 'IT' },
          { name: 'Jane Smith', age: 25, department: 'HR' },
          { name: 'Michael Johnson', age: 35, department: 'Finance' }
          // Add more employees here
        ],

  },
  watch: {
      adjustmentValue(value) {
        if (value % 0.5 !== 0) {
          this.adjustmentValue = Math.round(value * 2) / 2;
        }
 },
 selectAll(value) {
      this.ATT_time_ADJ_data.forEach(item => {
        item.selected = value;
      });
    },

   sfsnData(newVal) {
     /* this.$nextTick(() => {
        if (newVal && newVal.NEXTOPNO === this.SFselectedOPERATOR && newVal.LINK === 'T' && newVal.RESULT === 'Pass') {
          this.$refs.nexInputY.focus();
        }
        if (newVal && 
          ((newVal.NEXTOPNO === this.SFselectedOPERATOR && newVal.LINK === 'N' && newVal.RESULT === 'Pass') || 
           (newVal.RESULT === 'Fail' && this.SFselectedOPERATOR === '0'))) {
          this.$nextTick(() => {
            this.$refs.passButton.focus();
          });
        }
      });*/

      this.$nextTick(() => {
    if (this.selectedLINK === 'N') {
        if (this.$refs.passButton) {
            this.$refs.passButton.focus();
        }
    } else if (this.selectedLINK === 'T' && this.selectedDESC2 !== '') {
        if (this.$refs.nexInputY) {
            this.$refs.nexInputY.focus();
        }
    } else {
        if (this.$refs.nexInputD) {
            this.$refs.nexInputD.focus();
        }
    }
});
    }

 
},

computed: {

  totalZHFinalBonus() {
    return Object.keys(this.ZHDEP_eff_performance_groupedData).reduce((total, erpCode1) => {
      const date = this.ZHDEP_eff_performance_dates[this.ZHDEP_eff_performance_dates.length - 1]; // 使用最後的日期
      const bonus = parseFloat(this.ZHDEP_eff_performance_getValue(erpCode1, date, '考績獎金')) || 0;
      const extraBonus = parseFloat(this.ZHDEP_eff_performance_getValue(erpCode1, date, '額外考績獎金')) || 0;
      const managementFund = parseFloat(this.ZHDEP_eff_performance_getValue(erpCode1, date, 'A15拉管理福利金')) || 0;
      return total + bonus + extraBonus + managementFund;
    }, 0); // 兩位小數
  },
  totalQCFinalBonus() {
    return Object.keys(this.QCDEP_eff_performance_groupedData).reduce((total, erpCode1) => {
      const date = this.QCDEP_eff_performance_dates[this.QCDEP_eff_performance_dates.length - 1]; // 使用最後的日期
      const bonus = parseFloat(this.QCDEP_eff_performance_getValue(erpCode1, date, '考績獎金')) || 0;
      const extraBonus = parseFloat(this.QCDEP_eff_performance_getValue(erpCode1, date, '額外考績獎金')) || 0;
      const managementFund = parseFloat(this.QCDEP_eff_performance_getValue(erpCode1, date, 'A15拉管理福利金')) || 0;
      return total + bonus + extraBonus + managementFund;
    }, 0); // 兩位小數
  },
  totalFinalBonus() {
      const lastDate = this.DEP_eff_performance_dates[this.DEP_eff_performance_dates.length - 1];
      return Object.keys(this.DEP_eff_performance_groupedData).reduce((total, erpCode1) => {
        const bonus = parseFloat(this.DEP_eff_performance_getValue(erpCode1, lastDate, '最終獎金')) || 0;
        return total + bonus;
      }, 0); // 四捨五入到小數點兩位
    },
  totalSWH() {
    return this.eff_performance_ppwodata
      .reduce((total, item) => total + Number(item.SWH), 0)
      .toFixed(2);
  },
  totalAWH() {
    return this.eff_performance_ppwodata
      .reduce((total, item) => total + Number(item.AWH), 0)
      .toFixed(2);
  },
  groupedByShift() {
      // 根據 SHIFT 分組
      return this.eff_stff_bonus.reduce((acc, item) => {
        if (!acc[item.SHIFT]) {
          acc[item.SHIFT] = [];
        }
        acc[item.SHIFT].push(item);
        return acc;
      }, {});
    },
    totalBonus() {
      // 計算實際獎金總計
      return this.eff_stff_bonus.reduce((total, item) => total + Number(item.實際獎金 || 0), 0);
    },
    processedData() {
      // 1. 使用 reduce 方法对数据进行预处理，合并相同部门的行并计算執行工時总和
      return this.WOVERSON.reduce((acc, item) => {
        // 找到 acc 中是否已存在相同部门的项
        const existingItem = acc.find(i => i.部門 === item.部門 && i.工單 === item.工單 && i.品名 === item.品名 && i.數量 === item.數量 && i.標準工時 === item.標準工時);
        if (existingItem) {
          // 如果已存在，则累加執行工時
          existingItem.執行工時 += item.執行工時;
        } else {
          // 如果不存在，则加入新的项
          acc.push({
            ...item,
            total執行工時: item.執行工時, // 新增 total執行工時 字段来显示合并后的執行工時
            uniqueKey: `${item.部門}_${item.工單}_${item.品名}_${item.數量}_${item.標準工時}` // 使用 uniqueKey 来确保每行的唯一性
          });
        }
        return acc;
      }, []);
    }
  },

  methods: { 
    getSummaries(param) {
  const { columns, data } = param;
  const sums = [];

  // 確保變數在迴圈外部定義，避免 ReferenceError
  let totalExpected = 0; // 總標準產能
  let totalActual = 0; // 總實際產出

  columns.forEach((column, index) => {
    if (index === 0) {
      sums[index] = '總計';
      return;
    }

    const prop = column.property;
    if (prop) {
      if (['workhorse', 'expected', 'actual', 'line', 'defectForming', 'defectWelding', 'NG', 'other1', 'other2', 'other3'].includes(prop)) {
        const total = data.reduce((sum, row) => sum + (Number(row[prop]) || 0), 0);
        sums[index] = total;

        // 記錄總標準產能與總實際產出，以計算總體效率
        if (prop === 'expected') totalExpected = total;
        if (prop === 'actual') totalActual = total;

      } else if (prop === 'wohourse') {
        sums[index] = data.reduce((sum, row) => sum + (Number(this.calculateHours(row)) || 0), 0).toFixed(2);

      } else if (prop === 'efficiency') {
        // 計算總體效率
        sums[index] = totalExpected > 0 ? ((totalActual / totalExpected) * 100).toFixed(2) + '%' : '0%';

      } else {
        sums[index] = ''; // 其他欄位不加總
      }
    }
  });

  return sums;
},
    toggleMenu() {
      this.isOpen = !this.isOpen;
    },
    async fetchProductOptions() {

      const today = new Date();
  const year = today.getFullYear();
  const month = String(today.getMonth() + 1).padStart(2, '0'); // 補零
  const day = String(today.getDate()).padStart(2, '0'); // 補零
  const formattedDate = `${year}${month}${day}`; // YYYYMMDD
      if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
} else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
}
        try {
         // const apiUrl = `http://192.168.207.17:5024/api/C_PDREPORT/SELECPD?area=${this.selectedArea}&department=${this.selectedDepartment}&&mfg_day=${formattedDate}`;
            let response = await fetch(`http://192.168.207.17:5024/api/C_PDREPORT/SELECTPARTDESC?area=${this.selectedArea}&department=${this.selectedDepartment}&mfg_day=${formattedDate}`);
            let data = await response.json();
            if (data.result && Array.isArray(data.result)) {
                this.productOptions = data.result.map(item => ({
                    label: item.PART_DESC.trim(),  
                    value: item.PART_DESC.trim(),   
                    name: item.PART_DESC.trim(),
                    stdm: item.stdm || 0 
                }));
            }
        } catch (error) {
            console.error("獲取品名失敗:", error);
        }
    },
    resetExpected(row,rowIndex) {
    this.$nextTick(() => {
        // 找出所有屬於相同時段的行
        let mergedRows = this.tableData.filter(r => r.time === row.time);

        // 找到該時段的第一行
        let firstRow = mergedRows[0];

        // 計算該時段的最大時數 (第一行時數)
        let maxHours = this.calculateHours(firstRow);

        // 計算目前所有行的輸入工時總和 (確保數值為數字)
        let totalWorkhorse = mergedRows.reduce((sum, r) => sum + (Number(r.workhorse) || 0), 0);

        // 若總和超過最大值，則調整當前輸入的值
        if (totalWorkhorse > maxHours) {
            let excess = totalWorkhorse - maxHours;
            row.workhorse = Math.max(0, (Number(row.workhorse) || 0) - excess);
        }

        // 確保數值精確到小數點後兩位
        row.expected = this.calculateExpected(row,rowIndex);
        row.workhorse = parseFloat(row.workhorse.toFixed(2));
    });
},
    calculateExpected(row, rowIndex) {
    // 找到合併的第一個 row
    let firstRowIndex = rowIndex;
    while (firstRowIndex > 0 && this.tableData[firstRowIndex - 1].time === row.time) {
        firstRowIndex--;
    }

    // 取得第一列的 `people`
    let firstRowPeople = this.tableData[firstRowIndex].people;

    // 計算預期產量
    let product = this.productOptions.find(p => p.name === row.product);
    let stdm = product ? product.stdm : 0;
    let timeMinutes = this.timeOptions[row.time] || 0;
     return Math.floor(row.workhorse * stdm);
   // return Math.floor(row.workhorse * firstRowPeople * stdm);
},

    calculateHours(row) {
        return (row.people || 0.00) * (this.timeOptions[row.time] || 0.00);
    },
    async fetchTableData() {

      const today = new Date();
  const year = today.getFullYear();
  const month = String(today.getMonth() + 1).padStart(2, '0'); // 補零
  const day = String(today.getDate()).padStart(2, '0'); // 補零
  const formattedDate = `${year}${month}${day}`; // YYYYMMDD
      if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
} else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
}




      try {
        const apiUrl = `http://192.168.207.17:5024/api/C_PDREPORT/SELECPD?area=${this.selectedArea}&department=${this.selectedDepartment}&&mfg_day=${formattedDate}`;
        const response = await axios.get(apiUrl);
        console.log("Response:", response.data);
        if (!response.data.result || !Array.isArray(response.data.result)) {
          console.error("API response is invalid:", response.data);
          return;
        }

        // 清理數據，把 undefined、空字串 或 "undefined" 轉為空值或 0
        this.tableData = response.data.result.map(item => ({
            ID: item.ID || "",  
          AREA: item.AREA || "",
          MFG_DAY: item.MFG_DAY, // API 回傳沒有 MFG_DAY，從參數取得
          DEPARTMENT: item.DEPARTMENT || "",
          people: item.people || "0",
          time: item.time || "",
          workhorse: item.workhorse || "",
          product: item.product || "",
          expected: item.expected || "0",
          actual: item.actual || "0",
          line: item.line && item.line !== "undefined" ? item.line : "",
          defectForming: item.defectForming && item.defectForming !== "undefined" ? item.defectForming : "0",
          defectWelding: item.defectWelding && item.defectWelding !== "undefined" ? item.defectWelding : "0",
          NG: item.NG && item.NG !== "undefined" ? item.NG : "0",
          other1: item.other1 && item.other1 !== "undefined" ? item.other1 : "0",
          other2: item.other2 && item.other2 !== "undefined" ? item.other2 : "0",
          other3: item.other3 && item.other3 !== "undefined" ? item.other3 : "0"
        }));
      } catch (error) {
        console.error("Error fetching data:", error);
      }
    },
    async toggleEditMode() { // 確保這裡是 async
    this.editMode = !this.editMode;
    const today = new Date();
  const year = today.getFullYear();
  const month = String(today.getMonth() + 1).padStart(2, '0'); // 補零
  const day = String(today.getDate()).padStart(2, '0'); // 補零
  const formattedDate = `${year}${month}${day}`; // YYYYMMDD

    if (!this.editMode) {
      try {
        // 確保所有數據轉成字串
        const formattedData = this.tableData.map(row => ({
       //   AREA: String(row.AREA),
     //     MFG_DAY: String(row.MFG_DAY),
       //   DEPARTMENT: String(row.DEPARTMENT),
          ID: String(row.ID)|| "0",
          AREA: this.selectedArea,
          MFG_DAY: formattedDate,
          DEPARTMENT: this.selectedDepartment,
          PEOPLE: String(row.people),
          TIME: String(row.time),
          PRODUCT: String(row.product),
          WORKHORSE:String(row.workhorse),
          EXPECTED: String(row.expected),
          ACTUAL: String(row.actual),
          LINE: String(row.line),
          DEFECTFORMING: String(row.defectForming),
          DEFECTWELDING: String(row.defectWelding),
          NG: String(row.NG),
          OTHER1: String(row.other1),
          OTHER2: String(row.other2),
          OTHER3: String(row.other3)
        }));
        console.log("送出前的資料:", JSON.stringify(formattedData, null, 2));

        console.log("Response:", formattedData);

        const response = await axios.post("http://192.168.207.17:5024/api/C_PDREPORT/InsertOrUpdate", 
  formattedData, // 直接傳遞數據
  { headers: { "Content-Type": "application/json" } }
);
        console.log("Response:", response.data);
        this.$message.success("資料已成功提交！");


      this.fetchTableData();

      } catch (error) {
        console.error("API Error:", error);
        this.$message.error("提交失敗，請稍後再試！");

      }
    } else {
      this.fetchProductOptions(); // 在編輯模式開啟時調用
    }
  },
  addRow() {
        this.tableData.push({ ID:0 ,people: 0, time: "", product: "", expected: 0, actual: 0 });
    },
    async removeRow2(row, index) {
  const deletedId = row.ID; // 取得要刪除的 ID
  console.log("🔹 刪除的 ID:", deletedId);
  if (!deletedId) {
    console.warn("⚠️ ID 為 null，直接刪除前端資料");
    this.tableData.splice(index, 1);
    return;
  }
  try {
    const response = await axios.post(
      "http://192.168.207.17:5024/api/C_PDREPORT/delete",
      { ID: String(deletedId) },
      {
        headers: {
          "Content-Type": "application/json",
        },
      }
    );

    console.log("🔹 API Response:", response);

    if (response.data && response.data.message === "Record deleted successfully.") {
      this.tableData.splice(index, 1);
    } else {
      alert("刪除失敗：" + (response.data?.message || "未知錯誤"));
    }
  } catch (error) {
    console.error("🔴 刪除時發生錯誤:", error);
    if (error.response) {
      console.error("🔴 伺服器回應:", error.response);
      alert("錯誤：" + (error.response.data?.message || "請求無效"));
    } else {
      alert("無法連線到伺服器，請稍後再試");
    }
  }
},

    calculateEfficiency(row) {
        if (row.expected === 0) return 0;
        return ((row.actual / row.expected) * 100).toFixed(2);
    },

    // **合併相同時段的儲存格**
    mergeTable({ row, column, rowIndex }) {
    // 這裡使用 column.id 來判斷需要合併的欄位
    if (["time", "people","wohourse"].includes(column.property)) { 
        let prevRow = this.tableData[rowIndex - 1];

        // 第一行 或者 「時段不同」時，開始合併
        if (rowIndex === 0 || row.time !== prevRow?.time) {
            let count = 1;
            for (let i = rowIndex + 1; i < this.tableData.length; i++) {
                if (this.tableData[i].time === row.time) {
                    count++;
                } else {
                    break;
                }
            }
            return { rowspan: count, colspan: 1 };
        } else {
            return { rowspan: 0, colspan: 0 };
        }
    }
},

    


    handleTestMachine(machineNumber) {
    this.deviceSerial = machineNumber; // 更新 deviceSerial 為按鈕所對應的編號
    this.$refs.scanInput.focus();
    console.log('Selected device serial:', this.deviceSerial);
  },
    async revise() {
      if (!this.oldPassword || !this.newPassword) {
        alert("請輸入舊密碼和新密碼！");
        return;
      }

      try {
        const response = await fetch("http://192.168.207.17:5024/api/LOGIN/Revise", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            Username: this.user.username, // 請替換為目前使用者的用戶名
            Password: this.oldPassword,
            NewPassword: this.newPassword,
          }),
        });

        if (response.ok) {
          const result = await response.json();
          alert("密碼修改成功！");
          this.logout();
          this.repasswords=false;
          this.user = { permissions: [] };
        this.credentials = {
          username: '',
          password: '',
        };
        this.oldPassword = ''; // 清空舊密碼輸入框
        this.newPassword = ''; // 清空新密碼輸入框
        } else if (response.status === 401) {
          alert("驗證失敗，舊密碼不正確！");
        } else {
          alert("密碼修改失敗，請稍後重試！");
        }
      } catch (error) {
        console.error("API 呼叫失敗:", error);
        alert("出現錯誤，請稍後再試！");
      }
    },
  
    calculateTotalCompletedQty(item) {
    // 数字相加
    const total = (parseFloat(item.COMPLETED_QTY_1) || 0) + 
                  (parseFloat(item.COMPLETED_QTY_2) || 0) + 
                  (parseFloat(item.COMPLETED_QTY_3) || 0) + 
                  (parseFloat(item.COMPLETED_QTY_4) || 0) + 
                  (parseFloat(item.COMPLETED_QTY_5) || 0);
    return total.toFixed(0); // 保留两位小数
  },
    async fetchOperations() {
      if (!this.SFselectedWO) return;

     // const apiUrl = `https://localhost:5001/api/SHOPFLOOR/OPERATION_LIST?WO_ID=${this.SFselectedWO}`;
     const apiUrl = `http://192.168.207.17:5024/api/SHOPFLOOR/OPERATION_LIST?WO_ID=${this.SFselectedWO}`;
      try {
        const response = await fetch(apiUrl);
        if (response.ok) {
          const data = await response.json();
          this.SFoperations = data.result || [];
        } else {
          console.error("API 請求失敗:", response.status);
        }
      } catch (error) {
        console.error("API 請求出錯:", error);
      }
    },
    async fetchSNData() {
      try {
        // 查詢 SN_LIST API
        const snListResponse = await axios.get(`http://192.168.207.17:5024/api/SHOPFLOOR/SN_LIST?sn=${this.snInput}`);
        this.snList = snListResponse.data.result || [];

        // 查詢 SF_H_LINK API
        const sfHLinkResponse = await axios.get(`http://192.168.207.17:5024/api/SHOPFLOOR/SN_LIST_LIK?sn=${this.snInput}`);
        this.sfHLinkList = sfHLinkResponse.data.result || [];
      } catch (error) {
        console.error('查詢失敗', error);
      }
    },
    async fetchPDSNData() {
      this.loading = true;
      const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;

    const date2 = new Date(this.selectedDate2);
    const year2 = date2.getFullYear();
    const month2 = (date2.getMonth() + 1).toString().padStart(2, '0');
    const day2 = date2.getDate().toString().padStart(2, '0');
    const formattedDate2 = `${year2}${month2}${day2}`;
      try {

        // 查詢 SF_H_LINK API
        const sfHLinkResponse = await axios.get(`http://192.168.207.17:5024/api/SHOPFLOOR/PDSN_TRANS?MFG_DAY1=${formattedDate}&MFG_DAY2=${formattedDate2}&TYPE=${this.PDTYPESelect}`);
        this.SFPDSNLINK = sfHLinkResponse.data.result || [];
        this.loading = false;
      } catch (error) {
        console.error('查詢失敗', error);
        this.loading = false;
      }
    },
    async fetchfailSNData() {
      this.loading = true;
      const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;

    const date2 = new Date(this.selectedDate2);
    const year2 = date2.getFullYear();
    const month2 = (date2.getMonth() + 1).toString().padStart(2, '0');
    const day2 = date2.getDate().toString().padStart(2, '0');
    const formattedDate2 = `${year2}${month2}${day2}`;
      try {

        // 查詢 SF_H_LINK API

        const sfHLinkResponse = await axios.get(`http://192.168.207.17:5024/api/SHOPFLOOR/FAILSN_TRANS2?MFG_DAY1=${formattedDate}&MFG_DAY2=${formattedDate2}&TYPE=${this.PDTYPESelect}`);
       //const sfHLinkResponse = await axios.get(`https://localhost:5001/api/SHOPFLOOR/FAILSN_TRANS2?MFG_DAY1=${formattedDate}&MFG_DAY2=${formattedDate2}&TYPE=${this.PDTYPESelect}`);
        this.SFPDSNLINK = sfHLinkResponse.data.result1 || [];
        this.SFPDSNLINKqty = sfHLinkResponse.data.result2 || [];
        console.log("API 請求出錯:", this.SFPDSNLINKqty[0].sn_qty);
        this.loading = false;
      } catch (error) {
        console.error('查詢失敗', error);
        this.loading = false;
      }
    },
    eff_performance_sumColumn(data, date, field, 部門) {
    return Object.keys(data).reduce((sum, erpCode) => {
      const department = this.eff_performance_getValue(erpCode, date, '部門');
      if (department === 部門) {
        const value = this.eff_performance_getValue(erpCode, date, field);
        return sum + (isNaN(value) ? 0 : Number(value));
      }
      return sum;
    }, 0);
  },

    formatCurrency(value) {
  // 將數值格式化為金錢樣式，但不添加貨幣符號
  if (typeof value === "number") {
    return new Intl.NumberFormat('zh-TW', { 
      minimumFractionDigits: 0, 
      maximumFractionDigits: 0 
    }).format(value);
  }
  return value;
},

    calculateShiftBonus(shift) {
      // 計算每個 SHIFT 的實際獎金總計
      const group = this.groupedByShift[shift] || [];
      return group.reduce((total, item) => total + Number(item.實際獎金 || 0), 0);
    },
    getTotalCount() {
    return this.productionData ? this.productionData.length : 0;
  },
  getTotalCountPDLIST() {
    return this.SFPDSNLINK ? this.SFPDSNLINK.length : 0;
  },
  getTotalCountPDLIST2() {
    return this.SFPDSNLINKqty[0].sn_qty; 
    
  },
  getTotalCountFAILREWORKLIST() {
    return this.SFPDSNLINK ?  this.SFPDSNLINK.filter(item => item.重工結果 === 'Pass').length : 0;
  },
  getPassCount() {
    return this.productionData ? this.productionData.filter(item => item.RESULT === 'Pass').length : 0;
  },
  getDeviceCount(machineNumber) {
    const count = this.productionData.filter(item => item.deviceSerial === machineNumber).length;
    return count % 80; // 80 顯示 0，81 顯示 1，160 顯示 0，161 顯示 1 ...
  },
  getFailCount() {
    return this.productionData ? this.productionData.filter(item => item.RESULT === 'Fail').length : 0;
  },
    handleClick2() {
 
      if (this.sfsnData.TRANS_ID1.length !== this.TRANS1_LIMIT) {
        this.sfsnData.TRANS_ID1 = ''; // 清空输入框内容
        this.$refs.nexInputY.focus();  // 重新聚焦到输入框


      } else {

        this.$refs.nexInput.focus();
      }
    //  this.$refs.nexInput.focus();
    },

    handleClick(result) {
    // Update modal content
    this.displayContent = this.scanContent;
    this.modalMessage = `這是${result}: ${this.displayContent}`;
    this.showModal = true;

    // Prepare the data to be sent to the API
    const requestData = {
        area: this.selectedArea, // Replace with actual value
        wo_id: this.sfsnData.WO_ID , // Replace with actual value
        part_no: this.sfsnData.part_no , // Replace with actual value
        sn:  this.sfsnData.SN, // Replace with actual value
        operatioN_NO: this.SFselectedOPERATOR,
        operatioN_DESC: this.selectedText, // 使用获取到的文本
        result: result, // Pass the result (PASS/FAIL)
        deviceSerial:this.deviceSerial
        
    };
    console.log('更新成功', requestData);
    // Call the APIhttps://localhost:5001/api/SHOPFLOOR/INSERTSN

 //   fetch('http://192.168.207.17:5024/api/SHOPFLOOR/INSERTSN', {
  fetch('http://192.168.207.17:5024/api/SHOPFLOOR/INSERTSN', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json(); // Parse JSON response
    })
    .then(data => {
        console.log('Success:', data);
        this.modalMessage = data.message; // Use message from response
    })
    .catch((error) => {
        console.error('Error:', error);
        this.modalMessage = `上傳成功: ${this.displayContent}`;
    })
    .finally(() => {
        setTimeout(() => {
            this.showModal = false;
            this.scanContent='';
            this.deviceSerial='';
            this.sfsnData=null;
            this.$refs.scanInput.focus();
        }, 500);

    });
    this.SNSUMSELECT();
},
async generateSerialNumbers() {
      const url = `http://192.168.207.17:5024/api/SHOPFLOOR/GenerateSerialNumbers`;
      try {
        const response = await axios.post(url, null, {
          params: {
            initialSerialNumber: this.initialSerialNumber,
            count: this.count,
            woId: this.woId,
          },
        });
        this.responseMessage = response.data;
      } catch (error) {
        this.responseMessage =
          error.response?.data || "序號生成失敗，請檢查輸入內容。";
      }
    },
seloption() {


  const selectedOperation = this.SFoperations.find(
    (operation) => operation.OPERATION_NO === this.SFselectedOPERATOR
  );
  

  // 如果找到对应的工站，则更新 selectedText
  this.selectedText = selectedOperation 
    ? selectedOperation.OPERATION_DESC 
    : '';
    this.selectedLINK = selectedOperation 
    ? selectedOperation.LINK 
    : '';
    this.selectedDESC1 = selectedOperation 
    ? selectedOperation.TRANS_DESC1 
    : '';
    this.selectedDESC2 = selectedOperation 
    ? selectedOperation.TRANS_DESC2 
    : '';
    this.TRANS1_LIMIT = selectedOperation 
    ? selectedOperation.TRANS1_LIMIT 
    : '';
    this.TRANS2_LIMIT = selectedOperation 
    ? selectedOperation.TRANS2_LIMIT 
    : '';


    console.log('Success from INSERTSN:',  this.selectedText);


//this.selectedText = this.SFoperations[this.SFselectedOPERATOR].OPERATION_DESC || '';


this.SNSUMSELECT();
    
  },

  SNSUMSELECT(){
    const area = this.selectedArea;
    const wo = this.SFselectedWO;
    const operation = this.SFselectedOPERATOR;

    const apiUrl = `http://192.168.207.17:5024/api/SHOPFLOOR/SNresultSELECT?area=${area}&operation=${operation}&wo=${wo}`;
    axios.get(apiUrl)
      .then(response => {
        this.productionData = response.data; // 将返回的数据存储到 productionData 中
      })
      .catch(error => {
        console.error("API 调用失败:", error);
      });
      console.log("API:", this.productionData);
  },


  handleEntertosc(){
    this.$refs.scanInput.focus();


  },
handleEnterLINKKey() {

 if (this.sfsnData.TRANS_ID2.length !== this.TRANS2_LIMIT && this.selectedDESC2!=='') {
     this.sfsnData.TRANS_ID2 = ''; // 清空输入框内容
    this.$refs.nexInput.focus();

 } else if ((this.sfsnData.TRANS_ID1.length !== this.TRANS1_LIMIT && this.selectedDESC2==='')){ 

  this.sfsnData.TRANS_ID1 = ''; // 清空输入框内容
  this.$refs.nexInputD.focus();

 
} else {
        this.displayContent = this.scanContent;
    this.modalMessage = `這是: ${this.displayContent}`;
    this.showModal = true;

    // 請求1的數據
    const requestData1 = {
        area: this.selectedArea,
        part_no: this.sfsnData.part_no, // Replace with actual value
        operatioN_NO: this.SFselectedOPERATOR, // Replace with actual value
        masteR_ID: this.sfsnData.SN,
        tranS_ID1: this.sfsnData.TRANS_ID1,  // 根據需求設置
        tranS_ID2: this.sfsnData.TRANS_ID2,
    };

    // 請求2的數據
    const requestData2 = {
        area: this.selectedArea, // Replace with actual value
        wo_id: this.sfsnData.WO_ID, // Replace with actual value
        part_no: this.sfsnData.part_no, // Replace with actual value
        sn: this.sfsnData.SN, // Replace with actual value
        operatioN_NO: this.SFselectedOPERATOR, // Replace with actual value
        operatioN_DESC: this.selectedText, // Replace with actual value
        result: 'Pass' ,// Pass the result (PASS/FAIL)
        deviceSerial:this.deviceSerial
    };
    // 同時發送兩個請求
    Promise.all([
    fetch('http://192.168.207.17:5024/api/SHOPFLOOR/INSERT_LINK', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestData1)
    }),
    fetch('http://192.168.207.17:5024/api/SHOPFLOOR/INSERTSN', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestData2)
    })
])
.then(responses => {
    // 动态解析响应
    return Promise.all(responses.map(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.text().then(text => {
            try {
                return JSON.parse(text);
            } catch {
                return { message: text }; // 返回原始文本作为 message
            }
        });
    }));
})
.then(dataArray => {
    const [data1, data2] = dataArray;
    console.log('Success from INSERT_LINK:', data1);
    console.log('Success from INSERTSN:', data2);
    this.modalMessage = `${data1.message}\n${data2.message}`;
})
.catch(error => {
    console.error('Error:', error);
    this.modalMessage = `上傳失敗: ${this.displayContent}`;
    setTimeout(() => {
        this.showModal = false;
        this.scanContent = '';
        this.deviceSerial='';
        this.sfsnData = null;
        this.$refs.scanInput.focus();
    }, 500);
    this.seloption();
})
.finally(() => {
    setTimeout(() => {
        this.showModal = false;
        this.scanContent = '';
        this.deviceSerial='';
        this.sfsnData = null;
        this.$refs.scanInput.focus();
    }, 500);
    this.seloption();
});
  
      }
},

async handleEnter() {
      
      try {
        const response = await axios.get(
          'http://192.168.207.17:5024/api/SHOPFLOOR/SNSELECT',
          {
            params: {
              area: this.selectedArea,
              SN: this.scanContent,
              OP: this.SFselectedOPERATOR
            }
          }
        );

        // 假设响应数据是一个数组，我们只取第一个元素
        if (response.data && response.data.length > 0) {
          this.sfsnData = response.data[0];
  
          console.log('Success from INSERT_LINK:', this.SFselectedOPERATOR);
          if (this.SFselectedOPERATOR === '40' ) {
        // 调用第二个 API
        const response2 = await axios.get(
          'http://192.168.207.17:5024/api/SHOPFLOOR/SN_TRANS',
          {
            params: {
              sn: this.scanContent // 使用 scanContent 作为 sn 参数
            }
          }
        );

        // 保存第二个 API 的结果
        this.transResponse = response2.data.result[0]; // 假设返回的数据直接赋值
      } else {
        this.transResponse = null; // 如果条件不符合，清空第二个 API 数据
      }
      console.log('Success from INSERT_LINK:',  this.transResponse);
      this.scanContent='';

        } else {
          // 如果没有数据，清空显示
          this.sfsnData = null;
          this.scanContent='';
        }
      } catch (error) {
        console.error('API 请求失败:', error);
        // 处理错误时也清空显示
        this.sfsnData = null;       
         this.scanContent='';
            }




    },

          /*  handleKeydown(event) {
          if (event.key === 'a' || event.key === 'A') {
            this.handleClick('PASS');

          } else if (event.key === 'b' || event.key === 'B') {
            this.handleClick('FAIL');
          }
        },*/
        async RATING_fetchData() {

          if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
} else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
}
          const Department = this.selectedDepartment;
          const area = this.selectedArea;

          try {
            const response = await axios.get(`http://192.168.207.17:5024/api/READWOID/SELECT_RATING?area=${area}&department=${Department}`);
            this.  RATING_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
    async eff_performance_fetchData() {
      const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.207.17:5024/api/performance/effperformance?area=${area}&year=${year}&month=${month}`);
            this.  eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async DEP_eff_performance_fetchData() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.207.17:5024/api/performance/DEPPER?area=${area}&year=${year}&month=${month}`);
            this.  DEP_eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async QCDEP_eff_performance_fetchData() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.207.17:5024/api/performance/QCDEPPER?area=${area}&year=${year}&month=${month}`);
            this.  QCDEP_eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async ZHDEP_eff_performance_fetchData() {
          try {
            const response = await axios.get('http://192.168.207.17:5024/api/performance/ZHDEPPER?area=VN');
            this.  ZHDEP_eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async DEP_eff_OVERFLOW_fetchData() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.207.17:5024/api/performance/DEPover?area=${area}&year=${year}&month=${month}`);
            this.  DEP_eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async QCDEP_eff_OVERFLOW_fetchData() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.207.17:5024/api/performance/QCDEPover?area=${area}&year=${year}&month=${month}`);
            this.  QCDEP_eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async CNDEP_eff_OVERFLOW_fetchData() {
          try {
            const response = await axios.get('http://192.168.207.17:5024/api/performance/CNDEPover?area=VN');
            this.  ZHDEP_eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async eff_performance_ppwo() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.207.17:5024/api/performance/PPWO?area=${area}&year=${year}&month=${month}`);
            this.eff_performance_ppwodata = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async eff_performance_eff120() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.207.17:5024/api/performance/eff120?area=${area}&year=${year}&month=${month}`);
            this.eff_performance_eff120data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async eff_stff_bonus_fetchData() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.207.17:5024/api/performance/stff_bonus?area=${area}&year=${year}&month=${month}`);
            this.eff_stff_bonus = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async eff_stff_OVER_bonus_fetchData() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.207.17:5024/api/performance/stff_OVER_bonus?area=${area}&year=${year}&month=${month}`);
            this.eff_stff_bonus = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async overflow_performance_fetchData() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.207.17:5024/api/performance/overflowperformance?area=${area}&year=${year}&month=${month}`);
            this.  eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        eff_performance_processData() {
          const dateSet = new Set();
          const grouped = {};

          // 处理数据
          this. eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });

          this.eff_performance_dates = Array.from(dateSet).sort();
          this.eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.eff_performance_groupedData);
        },
        DEP_eff_performance_processData() {
          const dateSet = new Set();
          const grouped = {};

          // 处理数据
          this.DEP_eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });

          this.DEP_eff_performance_dates = Array.from(dateSet).sort();
          this.DEP_eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.DEP_eff_performance_groupedData);
        },
        QCDEP_eff_performance_processData() {
          const dateSet = new Set();
          const grouped = {};

          // 处理数据
          this.QCDEP_eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });

          this.QCDEP_eff_performance_dates = Array.from(dateSet).sort();
          this.QCDEP_eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.QCDEP_eff_performance_groupedData);
        },
        ZHDEP_eff_performance_processData() {
          const dateSet = new Set();
          const grouped = {};

          // 处理数据
          this.ZHDEP_eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });

          this.ZHDEP_eff_performance_dates = Array.from(dateSet).sort();
          this.ZHDEP_eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.ZHDEP_eff_performance_groupedData);
        },
        DEP_eff_OVERFLOE_processData() {
          const dateSet = new Set();
          const grouped = {};

          // 处理数据
          this.DEP_eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });

          this.DEP_eff_performance_dates = Array.from(dateSet).sort();
          this.DEP_eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.DEP_eff_performance_groupedData);
        },
        QCDEP_eff_OVERFLOE_processData() {
          const dateSet = new Set();
          const grouped = {};

          // 处理数据
          this.QCDEP_eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });

          this.QCDEP_eff_performance_dates = Array.from(dateSet).sort();
          this.QCDEP_eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.QCDEP_eff_performance_groupedData);
        },
        CNDEP_eff_OVERFLOE_processData() {
          const dateSet = new Set();
          const grouped = {};

          // 处理数据
          this.ZHDEP_eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });

          this.ZHDEP_eff_performance_dates = Array.from(dateSet).sort();
          this.ZHDEP_eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.ZHDEP_eff_performance_groupedData);
        },
        overflow_performance_processData() {
          const dateSet = new Set();
          const grouped = {};

          // 处理数据
          this. eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });

          this.eff_performance_dates = Array.from(dateSet).sort();
          this.eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.eff_performance_groupedData);
        },
        eff_performance_getValue(erpCode, date, field) {
          return this.eff_performance_groupedData[erpCode] && this.eff_performance_groupedData[erpCode][date] ? this.eff_performance_groupedData[erpCode][date][field] : '-';
        },
        DEP_eff_performance_getValue(erpCode, date, field) {
          return this.DEP_eff_performance_groupedData[erpCode] && this.DEP_eff_performance_groupedData[erpCode][date] ? this.DEP_eff_performance_groupedData[erpCode][date][field] : '-';
        },
        QCDEP_eff_performance_getValue(erpCode, date, field) {
          return this.QCDEP_eff_performance_groupedData[erpCode] && this.QCDEP_eff_performance_groupedData[erpCode][date] ? this.QCDEP_eff_performance_groupedData[erpCode][date][field] : '-';
        },
        ZHDEP_eff_performance_getValue(erpCode, date, field) {
          return this.ZHDEP_eff_performance_groupedData[erpCode] && this.ZHDEP_eff_performance_groupedData[erpCode][date] ? this.ZHDEP_eff_performance_groupedData[erpCode][date][field] : '-';
        },
        overflow_performance_getValue(erpCode, date, field) {
          return this.eff_performance_groupedData[erpCode] && this.eff_performance_groupedData[erpCode][date] ? this.eff_performance_groupedData[erpCode][date][field] : '-';
        },

        eff_performance_formatNumber(value) {
        return (typeof value === 'number' && !isNaN(value)) ? value.toFixed(2) : '-';
         },
        overflow_performance_formatNumber(value) {
          return typeof value === 'number' ? value.toFixed(2) : '-';
        },
        eff_performance_formatNumber2(value) {
           return (typeof value === 'number' && !isNaN(value)) ? value.toFixed(2) + '%' : '-';
         },
        overflow_performance_formatNumber2(value) {
          return typeof value === 'number' ? value.toFixed(2)+'%' : '-';
        },
        
        async effper() {
    // 使用 selectedArea 作为参数进行 API 调用
    await this.eff_performance_fetchData();
     this.eff_performance_processData();
     await this.eff_performance_ppwo();
     await this. eff_performance_eff120();
     await this.eff_stff_bonus_fetchData();
    await this.DEP_eff_performance_fetchData();
      this.DEP_eff_performance_processData();
    await this.QCDEP_eff_performance_fetchData();
     this.QCDEP_eff_performance_processData();
    await this.ZHDEP_eff_performance_fetchData();
  this.ZHDEP_eff_performance_processData();

  },
  async overflowper() {
    // 使用 selectedArea 作为参数进行 API 调用
    await this.overflow_performance_fetchData();
     this.overflow_performance_processData();
     await this.eff_performance_ppwo();
     await this.eff_stff_OVER_bonus_fetchData();
     await this.DEP_eff_OVERFLOW_fetchData();
     this.DEP_eff_OVERFLOE_processData();
     await this.QCDEP_eff_OVERFLOW_fetchData();
     this.QCDEP_eff_OVERFLOE_processData();
     await this.CNDEP_eff_OVERFLOW_fetchData();
     this.CNDEP_eff_OVERFLOE_processData();
  },
  processData(data) {
    // 处理和分组数据的逻辑
    // ...
  },
  calculateTotaleff(group, type) {
    return Object.values(group).reduce((total, monthData) => total + (monthData[type] || 0), 0);
  },
    woselect() {
      this.loading = true;
      this.secondResult = [];
    axios.get('http://192.168.207.17:5024/api/READWOID/part_list', {
        params: {
            part: this.selectedpart
        }
    })
    .then(response => {
        console.log('API response:', response.data); // 調試信息

        this.secondResult = response.data.result || [];
        this.loading = false;
        // 假设 response.data.result 是一个数组，你可以选择第一个元素的 ItemDesc 或其他逻辑
        if (this.secondResult.length > 0) {
            this.selectedItemDesc = this.secondResult[0].ItemDesc;
            this.selectedItemNum = this.secondResult[0].ItemNum;
        } else {
            this.selectedItemDesc = '';
            this.selectedItemNum = '';
        }
        this.loading = false;
        this.generateCharts();
    })
    .catch(error => {
      this.loading = false;
        console.error('API call failed: ', error);
        this.secondResult = [];
        this.selectedItemDesc = '';
        this.selectedItemNum = '';
    });
},
generateCharts() {
    // 如果存在旧的图表实例，则销毁它
    if (this.chartInstance) {
        this.chartInstance.destroy();
        this.chartInstance = null; // 确保旧实例已被销毁
    }

    // 反向排序副本
    const data = this.secondResult.slice().reverse();
    const labels = data.map(item => item.WONum);
    const effData = data.map(item => item.eff);
    const womoneyData = data.map(item => {
  // 判断 womoney 是否为 null 或者是一个空对象
  if (item.womoney !== null && typeof item.womoney === 'number') {
    return item.womoney;
  } else {
    return 0; // 如果为空值，则返回 0
  }
});


    // 绘制混合图表
    const mixedCtx = document.getElementById('mixedChart').getContext('2d');
    this.chartInstance = new Chart(mixedCtx, {
        type: 'bar', // 主图表类型设为柱状图
        data: {
            labels: labels,
            datasets: [
                {
                    label: '人時差異(含製費)',
                    data: womoneyData,
                    backgroundColor: 'rgba(255, 99, 132, 0.7)',
                    borderColor: 'rgba(255, 99, 132,  0.7)',
                    borderWidth: 1,
                    type: 'bar', // 数据集类型为柱状图
                    yAxisID: 'y1' // 指定使用右侧 y 轴
                },
                {
                    label: '效率 ',
                    data: effData,
                    borderColor: 'rgba(25, 101, 0,  0.7)',
                    backgroundColor: 'rgba(25, 101, 0, 0.7)',
                    type: 'line', // 数据集类型为折线图
                    yAxisID: 'y2' // 指定使用左侧 y 轴
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: true },
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            return `${tooltipItem.dataset.label}: ${tooltipItem.raw}`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    beginAtZero: true
                },
                y1: {
                    beginAtZero: true,
                    position: 'left',
                    title: {
                        display: true,
                        text: '人時差異(含製費)'
                    }
                },
                y2: {
                    beginAtZero: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: '效率'
                    },
                    ticks: {
                        color: 'rgba(75, 192, 192, 1)' // 将折线图的 y 轴刻度标记颜色设置为折线图的颜色
                    }
                }
            }
        }
    });
},

                selectwo(woid) {
                    axios.get('http://192.168.207.17:5024/api/READWOID/combined_data', {
                        params: {
                          wo_id: woid
                        }
                    })
                    .then(response => {
                        console.log('API response:', response.data); // 調試信息
                        if (response.data.firstResult && response.data.firstResult.length > 0) {
                            this.processFirstResult(response.data.firstResult);
                        } else {
                            this.firstResult = [];
                        }
                        this.firstResult = response.data.firstResult || [];
                    })
                    .catch(error => {
                        console.error('API call failed: ', error);
                        this.firstResult = [];

                    });
                },
                processFirstResult(data) {
                    // 獲取所有動態列（MFG_DAY）
                    this.dynamicHeaders = Object.keys(data[0]).filter(key => key !== '生產部門' && key !== '工作內容');
                    
                    // 將數據存儲在 firstResult 中
                    this.firstResult = data;
                },
                calculateRowTotal(row) {
                    // 計算每行的總和
                    return this.dynamicHeaders.reduce((total, day) => {
                        const value = row[day]*1;
                        return total + (value  ? parseFloat(value) : 0);
                    }, 0);
                },
                calculateColumnTotal(day) {
                    // 計算每列的總和
                    return this.firstResult.reduce((total, row) => {
                        const value = row[day]*1;
                        return total + (value ? parseFloat(value) : 0);
                    }, 0);
                },
                calculateGrandTotal() {
                    // 計算所有列的總和
                    return this.dynamicHeaders.reduce((grandTotal, day) => {
                        return grandTotal + this.calculateColumnTotal(day);
                    }, 0);
                },
    fetchAttendanceData(jobNumber, name) {
      const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;
      const apiUrl = `http://192.168.207.17:5024/api/Attendance/ATT_RAWDATA?MFG_DAY=${formattedDate}&JOB_NUMBER=${jobNumber}`;
      fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
          this.attendanceData = data;
          this.selectedJobNumber = jobNumber;
          this.selectedName = name;
        })
        .catch(error => {
          console.error('Error fetching attendance data:', error);
        });
    },
    toggleSettings() {
      this.settingsOpen = !this.settingsOpen; // 切换设置的展开状态
    },
    toggleperformance () {
      this.performance = !this.performance; // 切换设置的展开状态
    },
    toggleSelectAll() {
      this.ATT_time_ADJ_data.forEach(item => {
        item.selected = this.selectAll;
      });
    },
    toggleWOSelectAll() {
        this.WO_SUM_VERSON.forEach(item => {
            this.$set(this.showInSecondTable, item.部門, this.WOselectAll);
        });
        const trueKeys = Object.keys(this.showInSecondTable)
  .filter(key => this.showInSecondTable[key])
  .sort((a, b) => a - b);

trueKeys.forEach(trueKey => {
  this.WOVERSON = [];
  this.WOVER(trueKey);
});

    },
    toggleRATINGSelectAll() {
        this.RATING_SUM_VERSON.forEach(item => {
            this.$set(this.showInSecondTable, item.部門, this.WOselectAll);
        });
        const trueKeys = Object.keys(this.showInSecondTable)
  .filter(key => this.showInSecondTable[key])
  .sort((a, b) => a - b);

trueKeys.forEach(trueKey => {
  this.RATINGVERSON = [];
  this.RATINGVER(trueKey);
});

    },
    toggleATTSelectAll() {
        this.ATT_time_SUM_data.forEach(item => {
            this.$set(this.showInSecondTable, item.部門, this.WOselectAll);
        });

const trueKeys = Object.keys(this.showInSecondTable)
  .filter(key => this.showInSecondTable[key])
  .sort((a, b) => a - b);

trueKeys.forEach(trueKey => {
  this.att_hr_data(trueKey);
});
    },
    async executeSelected() {
      this.loading = true;
      this.isButtonDisabled = true;
  const selectedItems = this.ATT_time_ADJ_data.filter(item => item.selected);
  try {
    for (const item of selectedItems) {
      const UPDATEData = {
        mfG_DAY: item.mfG_DAY,
        area: item.area,
        department: item.department,
        jobnumber: item.jobnumber,
        ADJTIME: item.adj_time,
        floW_ID: "NFC",
      };

      await axios.post('http://192.168.207.17:5024/api/Attendance/UPDATE_ADJS', UPDATEData, {
        headers: {
          'Content-Type': 'application/json'
        }
      });
    }

    alert(this.translatedText.更新完成);
    this.isButtonDisabled = false;
    this.loading = false;
    this.att_hr_SUM_ADJ();
  } catch (error) {
    console.error('更新失敗', error);
  }
},

    calculateTotalDifference() {

      return this.WO_SUM_VERSON.reduce((total, item) => {
        const difference = item.回報工時 - (item.執行工時 * 1 + item.狀態工時 * 1 + item.狀態工時2 * 1 + item.殘疾人 * 1 + (item.未設定工單 - item.殘疾人 * 1) + item.無效工時 * 1 + item.借出工時 * 1 - item.借入工時 * 1 + item.調整工時 * 1);
        if (this.showInSecondTable[item.部門]) {
        return total + difference;
        }else{

          return total;
        }
      }, 0);
    },
    show_ADJ() {
      this.showADJs = true;

    },
    show_ADJ_CANCEL() {
      this.showADJs = false;

    },
    CHECK_WOADJ() {
      let totalAdjustment = this.WOVERSON.reduce((sum, item) => {
        return parseFloat((sum + parseFloat(item.ADJ || 0)).toFixed(2));
      }, 0);

      if (totalAdjustment !== 0) {
        alert('調整欄位數字相加必須為0');
        console.log('Success:', totalAdjustment);
      } else {
        alert('調整正確');
        
        let adjustedItems = this.WOVERSON.filter(item => item.ADJ && item.ADJ != 0);
        
        adjustedItems.forEach(item => {
          let payload = {
            AREA: item.廠區, // Replace with actual value if needed
            MFG_DAY: item.日期,  // Replace with actual value if needed
            WO_DEPARTMENT: item.工單部門,
            wo_id: item.工單,
            part_desc: item.品名,
            Qty: item.數量,
            std_time: item.標準工時,
            working_hours: item.ADJ
          };
          console.log('更新成功', payload);
          axios.post('http://192.168.207.17:5024/api/Report/ADG_WO_TIME', payload)
            .then(response => {
              console.log('Success:', response);
              this.WO_SUM_VER();
            })
            .catch(error => {
              console.error('Error:', error);
            });
        });
  
      }
      this.showADJs = false;
    },
       ADJ_CONFIRM_ET(item) {
      const UPDATEData = {
  mfG_DAY:item.mfG_DAY,
  area: item.area,
  department: item.department,
  jobnumber:item.jobnumber,
  ADJTIME:item.adj_time,
};
axios.post('http://192.168.207.17:5024/api/Attendance/UPDATE_ADJS', UPDATEData, {
  headers: {
    'Content-Type': 'application/json'
  }
})
.then(response => {
  // Handle successful response here
  if (response.status === 200) {


  } else {

  }

})
.catch(error => {
  // Handle other errors here

});
    },

    showAdjustmentDialog(item) {
      this.currentItem = item;
      this.showDialog = true;
    },
    closeDialog() {
      this.showDialog = false;
    },
    applyAdjustment() {
      if (this.currentItem) {
        // Apply the adjustment logic here
        console.log(`Adjusted ${this.adjustmentValue} for ${this.currentItem.工號}`);
        console.log(`Job Order: ${this.selectedreson}`);
        console.log(`DATE: ${this.selectedDate}`);
        console.log(`AREA: ${this.selectedArea}`);
        
const UPDATEData = {
  area: this.selectedArea,
  mfG_DAY:this.selectedDate,
  jobnumber:this.currentItem.工號,
  adjtime: this.adjustmentValue,
  reson:this.selectedreson,
};
//axios.post('https://localhost:5001/api/Attendance/ADJTIMES', UPDATEData, {

axios.post('http://192.168.207.17:5024/api/Attendance/ADJTIMES', UPDATEData, {
  headers: {
    'Content-Type': 'application/json'
  }
})
.then(response => {
  // Handle successful response here
  if (response.status === 200) {
    console.log('更新成功', response.status);
    alert(this.translatedText.更新完成);
   
  } else {
    console.log('更新成功 (但是收到了 400 錯誤)', response);
  }

})
.catch(error => {
  // Handle other errors here
  if (error.response.status === 400 && error.response.data === "No data found to delete.") {
    // 如果错误消息是 "No data found to delete"，则继续执行 this.insert
    console.log('更新成功', error.response.status);
    alert(this.translatedText.更新完成);
   
  }
  alert(this.translatedText.更新完成);
   
});


      }
      this.att_hr_SUM_data();
      this.closeDialog();
    },
    submitCARD_Form() {
    // 构造要发送的数据对象
    const formData = {
      area: this.selectedArea, // 如果您的表单中有区域相关的数据，请将其填充在这里
      department: this.machine_card[0].department,
      jO_NUMBER: this.machine_card[0].job_number,
      username: this.machine_card[0].username,
      nfC_ID: this.machine_card[0].nfC_ID,
      code: this.machine_card[0].code
    };

    // 发送 POST 请求到指定的 API
    fetch("http://192.168.207.17:5024/api/c_CARD/updatecard", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(formData)
    })
    .then(response => {
      // 处理响应
      if (response.ok) {
        // 成功发送数据
        console.log("表单数据已成功提交");
        alert(this.translatedText.更新完成);
        // 可以在这里执行其他操作，例如显示成功消息
      } else {
        // 发生错误
        console.error("表单数据提交失败");
        alert(this.translatedText.更新失敗);
        // 可以在这里执行其他操作，例如显示错误消息
      }
    })
    .catch(error => {
      // 捕获网络错误
      console.error("网络错误:", error);
      // 可以在这里执行其他操作，例如显示网络错误消息
    });
  },
    CAEDoptions_change(event) {
    const selectedUsername = event.target.value;
    const selectedOption = this.CAEDoptions.find(option => option.username === selectedUsername);
    if (selectedOption) {
      this.machine_card[0].job_number = selectedOption.jobnumber;
    }
  },
     fetchOptions() {
      this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
      axios.post('http://192.168.207.17:5024/api/c_CARD/SELECT', {
         area: this.selectedArea,
         department:this.selectedDepartment,


})
.then(response => {
// POST請求成功，將數據賦值給seatData
//this.ATT_time_data = this.ATT_time_data.concat(response.data);
this.CAEDoptions= response.data;

console.log('值.',this.CAEDoptions);
})
.catch(error => {
// POST請求失敗，輸出錯誤信息
console.error('Error posting data:', error);
});


    },
    shift_data (){

      this.loading = true;
       if (!this.selectedArea && !this.selectedDate) {
       this.loading = false;
      return; // 如果没有选择区域，直接返回
        }
      axios.post('http://192.168.207.17:5024/api/c_shift', {
         area: this.selectedArea,

})
.then(response => {
// POST請求成功，將數據賦值給seatData
//this.ATT_time_data = this.ATT_time_data.concat(response.data);
this.shiftdata= response.data;
})
.catch(error => {
// POST請求失敗，輸出錯誤信息
console.error('Error posting data:', error);
this.shiftdata=[];

});

this.loading = false;

    },
    selectMachine(){
     // this.ATT_time_data=[];
     this.loading = true;
       if (!this.selectedArea && !this.selectedDate) {
       this.loading = false;
      return; // 如果没有选择区域，直接返回
        }
        if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
} else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
}

        axios.post('http://192.168.207.17:5024/api/c_CARD', {
         area: this.selectedArea,
         department:this.selectedDepartment,
         machine:this.selectedmachine,

})
.then(response => {
// POST請求成功，將數據賦值給seatData
//this.ATT_time_data = this.ATT_time_data.concat(response.data);
this.machine_card= response.data;
this.machine_card[0].department=this.selectedDepartment
console.log('值.',this.machine_card);
})
.catch(error => {
// POST請求失敗，輸出錯誤信息
console.error('Error posting data:', error);
this.machine_card=[];
alert(this.translatedText.查無卡號);
});

this.loading = false;
this.fetchOptions();


    },
    calculateTotal_hrsum(column) {
      return this.ATT_time_SUM_data.reduce((total, item) => {
        if (this.showInSecondTable[item.部門]) {
          return total + parseFloat(item[column] || 0);
        } else {
          return total;
        }
      }, 0);
    },
    calculateTotal_wosum(column) {
      return this.WO_SUM_VERSON.reduce((total, item) => {
        if (this.showInSecondTable[item.部門]) {
          return total + parseFloat(item[column] || 0);
        } else {
          return total;
        }
      }, 0);
    },
    checkDuplicate(inputValue,inputField,item) {
      console.log('值.',inputValue);
      
            // 检查输入值是否存在于 hostMachine.MACHIN 中
            const isDuplicate = this.hostMachine.some(machine => machine.Machine === inputValue);


            if (isDuplicate) {
                // 如果存在，将输入值重置为 '0000'
                alert(this.translatedText.重複輸入);
                this.newSeat[inputField] = '0000';
            }else{
              const newSeatS = {
                 Machine: inputValue,
                 HOSTID: this.hostMachine[0].HOSTID
                 };
                this.hostMachine.push(newSeatS);
            }
        
    },
    checkDuplicate2(inputValue,inputField,item) {
      console.log('值.',inputValue);
      
            // 检查输入值是否存在于 hostMachine.MACHIN 中
            const isDuplicate = this.hostMachine.some(machine => machine.Machine === inputValue);


            if (isDuplicate) {
                // 如果存在，将输入值重置为 '0000'
                alert(this.translatedText.重複輸入);
           
                item[inputField] = '0000';
            }else{
              const newSeatS = {
                 Machine: inputValue,
                 HOSTID: this.hostMachine[0].HOSTID
                 };
                this.hostMachine.push(newSeatS);
            }
        
    },
    async completeSeat() {
  if (this.selectedL) {
    this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
  } else {
    this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
  }

  if (this.selectedD && this.selectedS && this.selectedC) {
    try {
  // 删除座位数据
  await this.DELETESEAT();

  // 插入座位数据


  // 更新座位数据
 // await this.UPDATESEAT();

  console.log('All operations completed successfully.');
} catch (error) {
  console.error('Error during operations:', error);
}

}

},
RESET(){
  const UPDATEData = {
  area: this.selectedArea,
  department: this.selectedDepartment,
};

axios.post('http://192.168.207.17:5024/api/ONLINE/RESET', UPDATEData, {
  headers: {
    'Content-Type': 'application/json'
  }
})
.then(response => {
  // Handle successful response here
  if (response.status === 200) {
    console.log('更新成功', response.status);
    alert(this.translatedText.更新完成);
   
  } else {
    console.log('更新成功 (但是收到了 400 錯誤)', response);
  }
  this.fetchData();
})
.catch(error => {
  // Handle other errors here
  if (error.response.status === 400 && error.response.data === "No data found to delete.") {
    // 如果错误消息是 "No data found to delete"，则继续执行 this.insert
    console.log('更新成功', error.response.status);
    alert(this.translatedText.更新完成);
   
  }
  alert(this.translatedText.更新完成);
   
});

},
async insertseat2(){

  try {
  const uploadDataArray = this.seatData.map(item => ({
    area: this.selectedArea,
    department: this.selectedDepartment,
    machine_L: item.machine_L,
    work_content_L: item.work_content_L ? item.work_content_L.toString() : "",
    work_content_id_L: "123",
    seat_ID: item.seatID.toString(),
    machine_R: item.machine_R,
    work_content_R: item.work_content_R ? item.work_content_R.toString() : "",
    work_content_id_R: "123",
    host_id: this.hostMachine[0].HOSTID, // 修改为适当的变量名
  }));

  // 批量上传数据
  const responses = await Promise.all(uploadDataArray.map(async uploadData => {
    try {
      const response = await fetch('http://192.168.207.17:5024/api/c_seat/INSERT', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(uploadData),
      });

      // 检查 HTTP 状态码
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }

      // 处理响应
      const contentType = response.headers.get('Content-Type');
      if (contentType && contentType.includes('application/json')) {
        const result = await response.json();
        console.log('Upload result:', result);
        console.log('Success Message:', result.successMessage);
        return result; // 返回结果以便进一步处理
      } else {
        const resultText = await response.text();
        console.log('Success Message:', resultText);
        return resultText; // 返回结果以便进一步处理
      }
    } catch (error) {
      console.error('Error uploading data:', uploadData);
      throw error; // 重新抛出错误以便外部处理
    }
  }));

  // 处理成功上传的结果
  console.log('All uploads successful:', responses);
  this.UPDATESEAT();
  // 更新座位数据（如果需要）
} catch (error) {
  console.error('Error during upload:', error);
}



},
 UPDATESEAT(){
  const UPDATEData = {
  area: this.selectedArea,
  department: this.selectedDepartment,
};

axios.post('http://192.168.207.17:5024/api/c_seat/updateseat', UPDATEData, {
  headers: {
    'Content-Type': 'application/json'
  }
})
.then(response => {
  // Handle successful response here
  if (response.status === 200) {
    console.log('更新成功', response.status);
    alert(this.translatedText.更新完成);
   
     this.seatData = [];
     this.seateditMode = false;
     this.postData();
  } else {
    console.log('更新成功 (但是收到了 400 錯誤)', response);
  }

})
.catch(error => {
  // Handle other errors here
  if (error.response.status === 400 && error.response.data === "No data found to delete.") {
    // 如果错误消息是 "No data found to delete"，则继续执行 this.insert
    console.log('更新成功', error.response.status);
    alert(this.translatedText.更新完成);
   
     this.seatData = [];
     this.seateditMode = false;
     this.postData();
  }
  alert(this.translatedText.更新完成);
   
   this.seatData = [];
   this.seateditMode = false;
   this.postData();
});

},

 DELETESEAT(){
// 構建 DELETE 請求的主體
const deleteData = {

  area: this.selectedArea,
 department: this.selectedDepartment,
}
console.log('DEPARTMENT', deleteData);
axios.delete('http://192.168.207.17:5024/api/c_seat/DELETE', {
    data: deleteData,
    headers: {
      'Content-Type': 'application/json'
    }
  })
    .then(response => {
      // Handle successful response here
      if (response.status === 400) {
        console.log('刪除成功 (但是收到了 400 錯誤)', response);
      } else {
        console.log('有資料刪除成功', response.status);
      }
      this.seateditMode = false;
       this.insertseat2();
  
    })
    .catch(error => {
      // Handle other errors here
      console.error('刪除失敗', error.response.data);
      if (error.response.data === "No data found to delete.") {
        // 如果错误消息是 "No data found to delete"，则继续执行 this.insert
        console.log('無資料刪除成功', error.response.status);
        this.insertseat2();
      
      }
    });


    },
    addSeat() {
      this.showseatForm=true;
   
  },
  inputseat(){
    console.log('刪除成功', this.newSeat.seatID);
    const newSeatS = {
      seatID: this.newSeat.seatID, // 座位号需要转换为字符串类型
      machine_L: this.newSeat.machine_L,
      work_content_L: this.newSeat.work_content_L,
      work_content_R: this.newSeat.work_content_R,
      machine_R: this.newSeat.machine_R,
  
      
    };

    this.seatData.push(newSeatS); // 将新座位添加到 seatData 数组中
    this.seatData.forEach(item => {
        item.editMode = true;
      });
      this.seatData.sort((a, b) => a.seatID - b.seatID);
      this.seatData.sort((a, b) => {
    if (a.seatID === b.seatID) {
        return b.seatID - a.seatID; // 如果 property1 相等，则按照 property2 进行排序
    } else {
        return  a.seatID -b.seatID ; // 否则，按照 property1 进行排序
    }
});
// Reassign new seatIDs
this.seatData = this.seatData.map((item, index) => {
    item.seatID = index + 1;
    return item;
});
this.showseatForm=false;
this.newSeat.machine_L='0000';
this.newSeat.machine_R='0000';
  },
  removeSeat(){
    this.showActions = true;
  },
  DELETESEATtb(index){

 
    if (index !== -1) {
        // 如果找到具有特定行号的座位对象，则删除它
        this.seatData.splice(index, 1);
    }
    
    this.showActions = false;
    this.seatData = this.seatData.map((item, index) => {
    item.seatID = index + 1;
    return item;
});
},
    // 删除行     this.seatData.splice(newValue, diff); // 修改这行


    enableseatEditMode() {
      this.seatData.forEach(item => {
        item.editMode = true;

      });
      this.seateditMode = true;
    },
    canceseatlEdit() {
      this.showActions = false;
      // 取消编辑时，将所有项目的 editMode 属性设置为 false
      this.seatData.forEach(item => {
        item.editMode = false;
  
      });
      this.seateditMode = false;
      this.postData();
    },
    formattedDate: function() {
  if (this.selectedDate) {
    const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;
    
    // 在這裡調用函數

    
    return formattedDate;
  } else {
    return '';
  }
},    calculateDepartment_WOTotal(field, department) {
  let total = 0;
  for (const item of this.WOVERSON) {
    if (item.部門 === department && !isNaN(parseFloat(item[field]))) {
      total += parseFloat(item[field]);
    }
  }
  return total;
},

    calculateDepartmentTotal(field, department) {
  let total = 0;
  for (const item of this.ATT_time_data) {
    if (item.部門 === department && !isNaN(parseFloat(item[field]))) {
      total += parseFloat(item[field]);
    }
  }
  return total;
},
  calculateExcessHoursTotal(department) {
    let totalExcessHours = 0;
    for (const item of this.ATT_time_data) {
      if (item.部門 === department && !isNaN(parseFloat(item.考勤工時)) && ((item.考勤工時*1)+(item.調整工時*1)+(item.手動調整工時*1)) >= 8) {
        totalExcessHours +=  8 ;
      }else if (item.部門 === department &&  !isNaN(parseFloat(item.考勤工時)) && ((item.考勤工時*1)+(item.調整工時*1)+(item.手動調整工時*1))< 8) {

        totalExcessHours += parseFloat(((item.考勤工時*1)+(item.調整工時*1)+(item.手動調整工時*1))) ;

      }else if (item.部門 === department &&  item.假別 === '年休' ) {

     totalExcessHours += parseFloat(((item.調整工時*1))) ;

}else{

        totalExcessHours +=0;
      }
    }
    return totalExcessHours;
  },

    validateInput( item) {
   console.log('n', item.FQC);
console.log(' o:', item.OLDFQC);

      if (item.FQC < item.OLDFQC) {
      item.inputError = true;
      item.FQC=item.OLDFQC; // 更新原始值
    } else if (item.FQC > item.qty) {
      item.inputError2 = true;
      item.FQC=item.OLDFQC; // 更新原始值
      }else{
      item.inputError = false;
      item.inputError2 = false;
    }
    // 其他驗證邏輯，比如檢查是否大於工單數量，可以在這裡進行
  },
  async downloadExcelWOPER() {
// 引入库
const dataRows = Array.from(document.querySelectorAll('#WOPET2 tbody tr'));
      this.ATTSUMdata = dataRows.map(row => {
        const cells = row.querySelectorAll('td');

        return {
          班別代號: cells[0]?.innerText,
          M1標準工時:parseFloat(parseFloat(cells[1]?.innerText || '0').toFixed(2)),
          M1實際工時:parseFloat(cells[2]?.innerText.trim()).toFixed(2) || 0,
          M1效率: parseFloat(cells[3]?.innerText.trim()).toFixed(2) || 0,
          M2標準工時:parseFloat(cells[4]?.innerText.trim()).toFixed(2) || 0,
          M2實際工時:parseFloat(cells[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells[6]?.innerText.trim()).toFixed(2) || 0,
          M3標準工時:parseFloat(cells[7]?.innerText.trim()).toFixed(2) || 0,
          M3實際工時:parseFloat(cells[8]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells[9]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells[10]?.innerText,
          效率上升率:cells[11]?.innerText,
          最終考核效率:cells[12]?.innerText,
          當月考績:	cells[13]?.innerText,			
          額外獎勵:	cells[14]?.innerText,			
          下月累計負值效率:	cells[15]?.innerText,			
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows6 = Array.from(document.querySelectorAll('#WOPET3 tbody tr'));
      this.ATTSUMdata6 = dataRows6.map(row => {
        const cells6 = row.querySelectorAll('td');

        return {
          班別代號: cells6[0]?.innerText,
          M1標準工時:parseFloat(parseFloat(cells6[1]?.innerText || '0').toFixed(2)),
          M1實際工時:parseFloat(cells6[2]?.innerText.trim()).toFixed(2) || 0,
          M1效率: parseFloat(cells6[3]?.innerText.trim()).toFixed(2) || 0,
          M2標準工時:parseFloat(cells6[4]?.innerText.trim()).toFixed(2) || 0,
          M2實際工時:parseFloat(cells6[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells6[6]?.innerText.trim()).toFixed(2) || 0,
          M3標準工時:parseFloat(cells6[7]?.innerText.trim()).toFixed(2) || 0,
          M3實際工時:parseFloat(cells6[8]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells6[9]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells6[10]?.innerText,
          效率上升率:cells6[11]?.innerText,
          最終考核效率:cells6[12]?.innerText,
          當月考績:	cells6[13]?.innerText,			
          額外獎勵:	cells6[14]?.innerText,			
          下月累計負值效率:	cells6[15]?.innerText,			
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows2 = Array.from(document.querySelectorAll('#PPWO tbody tr'));
      this.ATTSUMdata2 = dataRows2.map(row => {
        const cells2 = row.querySelectorAll('td');

        return {
          工單: cells2[0]?.innerText,
          班別代號:cells2[1]?.innerText,
          料號:cells2[2]?.innerText,
          數量:cells2[3]?.innerText,
          標準工時:parseFloat(parseFloat(cells2[4]?.innerText || '0').toFixed(2)),
          實際工時:parseFloat(parseFloat(cells2[5]?.innerText|| '0').toFixed(2)),
	
          // 其他需要保存的資料也在這裡處理

        };
      });
      const dataRows3 = Array.from(document.querySelectorAll('#stffbonus tbody tr'));
      this.ATTSUMdata3 = dataRows3.map(row => {
        const cells3 = row.querySelectorAll('td');

        return {
          班別代號: cells3[0].innerText|| '',
          工號:cells3[1].innerText|| '',
          姓名:cells3[2]?.innerText|| '',
          工作天數:cells3[3]?.innerText|| '',
          請假天數:cells3[4]?.innerText|| '',
          崗位:cells3[5]?.innerText|| '',
          績效等級I:cells3[6]?.innerText|| '',
          獎金I:cells3[7]?.innerText|| '',
          績效等級II:cells3[8]?.innerText|| '',
          獎金II:cells3[9]?.innerText|| '',
          最終獎金:cells3[10]?.innerText|| '',
        };
      });
      const dataRows4 = Array.from(document.querySelectorAll('#DEPPER tbody tr'));
      this.ATTSUMdata4 = dataRows4.map(row => {
        const cells4 = row.querySelectorAll('td');

        return {
          管理部門: cells4[0]?.innerText,
          管理班別:cells4[1]?.innerText,
          工號:cells4[2]?.innerText,
          姓名: cells4[3]?.innerText,
          上班天數:cells4[4]?.innerText,
          職稱:cells4[5]?.innerText,
          M1效率:parseFloat(cells4[6]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells4[7]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells4[8]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells4[9]?.innerText,
          效率上升率:cells4[10]?.innerText,
          最終考核效率:cells4[11]?.innerText,
          當月考績:cells4[12]?.innerText,
          額外獎勵:cells4[13]?.innerText,
          考績獎金:cells4[14]?.innerText,	
          額外考績獎金:cells4[15]?.innerText,
          A15拉管理福利金:cells4[16]?.innerText,
          最終獎金:cells4[17]?.innerText,
          下月累計負值效率:cells4[18]?.innerText,
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows5 = Array.from(document.querySelectorAll('#QCDEPPER tbody tr'));
      this.ATTSUMdata5 = dataRows5.map(row => {
        const cells5 = row.querySelectorAll('td');

        return {
          管理部門: cells5[0]?.innerText,
          管理班別:cells5[1]?.innerText,
          工號:cells5[2]?.innerText,
          姓名: cells5[3]?.innerText,
          職稱:cells5[4]?.innerText,
          M1效率:parseFloat(cells5[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells5[6]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells5[7]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells5[8]?.innerText,
          效率上升率:cells5[9]?.innerText,
          最終考核效率:cells5[10]?.innerText,
          當月考績:cells5[11]?.innerText,
          額外獎勵:cells5[12]?.innerText,
          考績獎金:cells5[13]?.innerText,	
          額外考績獎金:cells5[14]?.innerText,
          A15拉管理福利金:cells5[15]?.innerText,
          最終獎金:cells5[16]?.innerText,
          下月累計負值效率:cells5[17]?.innerText,
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows7 = Array.from(document.querySelectorAll('#ZHDEPPER tbody tr'));
      this.ATTSUMdata7 = dataRows7.map(row => {
        const cells7 = row.querySelectorAll('td');

        return {
          管理部門: cells7[0]?.innerText,
          管理班別:cells7[1]?.innerText,
          工號:cells7[2]?.innerText,
          姓名: cells7[3]?.innerText,
          職稱:cells7[4]?.innerText,
          M1效率:parseFloat(cells7[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells7[6]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells7[7]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells7[8]?.innerText,
          效率上升率:cells7[9]?.innerText,
          最終考核效率:cells7[10]?.innerText,
          當月考績:cells7[11]?.innerText,
          額外獎勵:cells7[12]?.innerText,
          考績獎金:cells7[13]?.innerText,	
          額外考績獎金:cells7[14]?.innerText,
          A15拉管理福利金:cells7[15]?.innerText,
          最終獎金:cells7[16]?.innerText,
          下月累計負值效率:cells7[17]?.innerText,
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows8 = Array.from(document.querySelectorAll('#eff120 tbody tr'));
      this.ATTSUMdata8 = dataRows8.map(row => {
        const cells8 = row.querySelectorAll('td');

        return {
          班別代號:cells8[0]?.innerText,
          料號:cells8[1]?.innerText,
          客戶料號:cells8[2]?.innerText,
          工單數量: cells8[3]?.innerText,     
          數量:cells8[4]?.innerText,
          標準工時:parseFloat(parseFloat(cells8[5]?.innerText || '0').toFixed(2)),
          實際工時:parseFloat(parseFloat(cells8[6]?.innerText|| '0').toFixed(2)),
          效率:parseFloat(parseFloat(cells8[7]?.innerText|| '0').toFixed(2)),
          // 其他需要保存的資料也在這裡處理
          建議調整標準工時:cells8[8]?.innerText,
        };
      });
    
    
    
      const PERData = {
            MFG_DAY: '2024/10',
            wopet: this.ATTSUMdata,
            PPWO: this.ATTSUMdata2,
            stffbonus:this.ATTSUMdata3,
            DEPPER:this.ATTSUMdata4,
            QCDEPPER:this.ATTSUMdata5,
            wopet3: this.ATTSUMdata6,
            ZHDEPPER:this.ATTSUMdata7,
            EFF120:this.ATTSUMdata8,
          };

          axios.post('https://localhost:5001/api/PWEWOTableToExcel/to-excel', PERData, { responseType: 'blob' })
          //axios.post('https://localhost:5001/api/PWEWOTableToExcel/to-pdf', PERData, { responseType: 'blob' })
         // axios.post('https://localhost:5001/api/TableToExcel/to-excel', combinedData, { responseType: 'blob' })
            .then(response => {
              const blob = new Blob([response.data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
              const link = document.createElement('a');
              link.href = window.URL.createObjectURL(blob);
              link.download =  '月效率考核表 Mẫu đánh giá hiệu quả hàng tháng .xlsx';
              link.click();
            })
            .catch(error => {
              console.error('Error exporting to Excel:', error);
            });
  },
  
  async downloadExcelWOOVER() {
// 引入库
const dataRows = Array.from(document.querySelectorAll('#WOOEVER2 tbody tr'));
      this.ATTSUMdata = dataRows.map(row => {
        const cells = row.querySelectorAll('td');

        return {
          班別代號: cells[0]?.innerText,
          M1標準工時:parseFloat(parseFloat(cells[1]?.innerText || '0').toFixed(2)),
          M1實際工時:parseFloat(cells[2]?.innerText.trim()).toFixed(2) || 0,
          M1效率: parseFloat(cells[3]?.innerText.trim()).toFixed(2) || 0,
          M2標準工時:parseFloat(cells[4]?.innerText.trim()).toFixed(2) || 0,
          M2實際工時:parseFloat(cells[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells[6]?.innerText.trim()).toFixed(2) || 0,
          M3標準工時:parseFloat(cells[7]?.innerText.trim()).toFixed(2) || 0,
          M3實際工時:parseFloat(cells[8]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells[9]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells[10]?.innerText,
          效率上升率:cells[11]?.innerText,
          最終考核效率:cells[12]?.innerText,
          當月考績:	cells[13]?.innerText,			
          額外獎勵:	cells[14]?.innerText,			
          下月累計負值效率:	cells[15]?.innerText,			
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows6 = Array.from(document.querySelectorAll('#WOOEVER3 tbody tr'));
      this.ATTSUMdata6 = dataRows6.map(row => {
        const cells6 = row.querySelectorAll('td');

        return {
          班別代號: cells6[0]?.innerText,
          M1標準工時:parseFloat(parseFloat(cells6[1]?.innerText || '0').toFixed(2)),
          M1實際工時:parseFloat(cells6[2]?.innerText.trim()).toFixed(2) || 0,
          M1效率: parseFloat(cells6[3]?.innerText.trim()).toFixed(2) || 0,
          M2標準工時:parseFloat(cells6[4]?.innerText.trim()).toFixed(2) || 0,
          M2實際工時:parseFloat(cells6[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells6[6]?.innerText.trim()).toFixed(2) || 0,
          M3標準工時:parseFloat(cells6[7]?.innerText.trim()).toFixed(2) || 0,
          M3實際工時:parseFloat(cells6[8]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells6[9]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells6[10]?.innerText,
          效率上升率:cells6[11]?.innerText,
          最終考核效率:cells6[12]?.innerText,
          當月考績:	cells6[13]?.innerText,			
          額外獎勵:	cells6[14]?.innerText,			
          下月累計負值效率:	cells6[15]?.innerText,			
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows2 = Array.from(document.querySelectorAll('#WOPP3 tbody tr'));
      this.ATTSUMdata2 = dataRows2.map(row => {
        const cells2 = row.querySelectorAll('td');

        return {
          工單: cells2[0].innerText,
          班別代號:cells2[1].innerText,
          料號:cells2[2].innerText,
          數量:cells2[3].innerText,
          標準工時:parseFloat(parseFloat(cells2[4]?.innerText || '0').toFixed(2)),
          實際工時:parseFloat(parseFloat(cells2[5]?.innerText|| '0').toFixed(2)),
	
          // 其他需要保存的資料也在這裡處理

        };
      });
      const dataRows3 = Array.from(document.querySelectorAll('#STAFF_OVERBOUNS tbody tr'));
      this.ATTSUMdata3 = dataRows3.map(row => {
        const cells3 = row.querySelectorAll('td');

        return {
          班別代號: cells3[0].innerText|| '',
          工號:cells3[1].innerText|| '',
          姓名:cells3[2]?.innerText|| '',
          工作天數:cells3[3]?.innerText|| '',
          請假天數:cells3[4]?.innerText|| '',
          崗位:cells3[5]?.innerText|| '',
          績效等級I:cells3[6]?.innerText|| '',
          獎金I:cells3[7]?.innerText|| '',
          績效等級II:cells3[8]?.innerText|| '',
          獎金II:cells3[9]?.innerText|| '',
          最終獎金:cells3[10]?.innerText|| '',
        };
      });
      const dataRows4 = Array.from(document.querySelectorAll('#DEPOVER tbody tr'));
      this.ATTSUMdata4 = dataRows4.map(row => {
        const cells4 = row.querySelectorAll('td');

        return {
          管理部門: cells4[0]?.innerText,
          管理班別:cells4[1]?.innerText,
          工號:cells4[2]?.innerText,
          姓名: cells4[3]?.innerText,
          上班天數:cells4[4]?.innerText,
          職稱:cells4[5]?.innerText,
          M1效率:parseFloat(cells4[6]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells4[7]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells4[8]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells4[9]?.innerText,
          效率上升率:cells4[10]?.innerText,
          最終考核效率:cells4[11]?.innerText,
          當月考績:cells4[12]?.innerText,
          額外獎勵:cells4[13]?.innerText,
          考績獎金:cells4[14]?.innerText,	
          額外考績獎金:cells4[15]?.innerText,
          A15拉管理福利金:cells4[16]?.innerText,
          最終獎金:cells4[17]?.innerText,
          下月累計負值效率:cells4[18]?.innerText,
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows5 = Array.from(document.querySelectorAll('#QCDEPOVER tbody tr'));
      this.ATTSUMdata5 = dataRows5.map(row => {
        const cells5 = row.querySelectorAll('td');

        return {
          管理部門: cells5[0]?.innerText,
          管理班別:cells5[1]?.innerText,
          工號:cells5[2]?.innerText,
          姓名: cells5[3]?.innerText,
          職稱:cells5[4]?.innerText,
          M1效率:parseFloat(cells5[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells5[6]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells5[7]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells5[8]?.innerText,
          效率上升率:cells5[9]?.innerText,
          最終考核效率:cells5[10]?.innerText,
          當月考績:cells5[11]?.innerText,
          額外獎勵:cells5[12]?.innerText,
          考績獎金:cells5[13]?.innerText,	
          額外考績獎金:cells5[14]?.innerText,
          A15拉管理福利金:cells5[15]?.innerText,
          最終獎金:cells5[16]?.innerText,
          下月累計負值效率:cells5[17]?.innerText,
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows7 = Array.from(document.querySelectorAll('#CNDEPOVER tbody tr'));
      this.ATTSUMdata7 = dataRows7.map(row => {
        const cells7 = row.querySelectorAll('td');

        return {
          管理部門: cells7[0]?.innerText,
          管理班別:cells7[1]?.innerText,
          工號:cells7[2]?.innerText,
          姓名: cells7[3]?.innerText,
          職稱:cells7[4]?.innerText,
          M1效率:parseFloat(cells7[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells7[6]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells7[7]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells7[8]?.innerText,
          效率上升率:cells7[9]?.innerText,
          最終考核效率:cells7[10]?.innerText,
          當月考績:cells7[11]?.innerText,
          額外獎勵:cells7[12]?.innerText,
          考績獎金:cells7[13]?.innerText,	
          額外考績獎金:cells7[14]?.innerText,
          A15拉管理福利金:cells7[15]?.innerText,
          最終獎金:cells7[16]?.innerText,
          下月累計負值效率:cells7[17]?.innerText,
          // 其他需要保存的資料也在這裡處理
        };
      });

    
    
    
      const PERData = {
            MFG_DAY: '2024/10',
            wopet: this.ATTSUMdata,
            PPWO: this.ATTSUMdata2,
            stffbonus:this.ATTSUMdata3,
            DEPPER:this.ATTSUMdata4,
            QCDEPPER:this.ATTSUMdata5,
            wopet3: this.ATTSUMdata6,
            ZHDEPPER:this.ATTSUMdata7,
            EFF120:this.ATTSUMdata2,
          };

          axios.post('https://localhost:5001/api/PWEOVERWOTableToExcel/to-excel', PERData, { responseType: 'blob' })
          //axios.post('https://localhost:5001/api/PWEWOTableToExcel/to-pdf', PERData, { responseType: 'blob' })
         // axios.post('https://localhost:5001/api/TableToExcel/to-excel', combinedData, { responseType: 'blob' })
            .then(response => {
              const blob = new Blob([response.data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
              const link = document.createElement('a');
              link.href = window.URL.createObjectURL(blob);
              link.download =  '月溢領考核表 Mẫu đánh giá hiệu quả hàng tháng .xlsx';
              link.click();
            })
            .catch(error => {
              console.error('Error exporting to Excel:', error);
            });
  },
  
  
  async downloadExcel() {
    const dataRows = Array.from(document.querySelectorAll('#stff2 tbody tr'));
      this.ATTSUMdata = dataRows.map(row => {
        const cells = row.querySelectorAll('td');

        return {
          部門: cells[0].innerText,
          出勤人數:parseInt(cells[1]?.innerText.trim()) || 0,
          實際掛卡工時:parseFloat(parseFloat(cells[2]?.innerText.trim() || '0').toFixed(2)),
          系統計算考勤工時:parseFloat(parseFloat(cells[3]?.innerText.trim() || '0').toFixed(2)),
          回報管理部考勤工時:parseFloat(parseFloat(cells[4]?.innerText.trim() || '0').toFixed(2)),
          差異:parseFloat(parseFloat(cells[5]?.innerText.trim() || '0').toFixed(2)),
          原因:	cells[6].innerText,			
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows2 = Array.from(document.querySelectorAll('#stff tbody tr'));
      this.ATTSUMdata2 = dataRows2.map(row => {
        const cells2 = row.querySelectorAll('td');

        return {
          部門: cells2[0].innerText,
          工作拉:cells2[1].innerText,
          工號:cells2[2].innerText,
          姓名:cells2[3].innerText,
          實際掛卡工時:parseFloat(parseFloat(cells2[4]?.innerText || '0').toFixed(2)),
          系統計算考勤工時:parseFloat(parseFloat(cells2[5]?.innerText|| '0').toFixed(2)),
          調整: parseFloat(parseFloat(cells2[6]?.innerText || '0').toFixed(2)),	
          回報管理部考勤工時:	parseFloat(parseFloat(cells2[7]?.innerText || '0').toFixed(2)),
          正班工時:	parseFloat(parseFloat(cells2[8]?.innerText || '0').toFixed(2)),	
          加班工時:	parseFloat(parseFloat(cells2[9]?.innerText || '0').toFixed(2)),
          假別:	cells2[9]?.innerText || '', // 差異原因
          事由:	cells2[10]?.innerText || '',	
          差異原因:	cells2[11]?.innerText || '',		
          差異原因2:	cells2[12]?.innerText || '',		
          // 其他需要保存的資料也在這裡處理
        };
      });
          // Combine data for all tables
          const combinedData = {
            MFG_DAY: this.selectedDate,
            employees: this.ATTSUMdata,
            employmentTime: this.ATTSUMdata2,
          };

          // Send combined data to backend API https://localhost:5001/api/TableToExcel/to-excel
           axios.post('http://192.168.207.17:5024/api/TableToExcel/to-excel', combinedData, { responseType: 'blob' })
         // axios.post('https://localhost:5001/api/TableToExcel/to-excel', combinedData, { responseType: 'blob' })
            .then(response => {
              const blob = new Blob([response.data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
              const link = document.createElement('a');
              link.href = window.URL.createObjectURL(blob);
              link.download =  this.selectedDate+'Attendance daily report.xlsx';
              link.click();
            })
            .catch(error => {
              console.error('Error exporting to Excel:', error);
            });
        
        },


        async downloadWOExcel() {
      const dataRows = Array.from(document.querySelectorAll('#WO1 tbody tr'));
      this.WOSUMdata = dataRows.map(row => {
        const cells = row.querySelectorAll('td');
        return {
    部門: cells[0]?.innerText || '',
    回報管理部考勤工: parseFloat(parseFloat(cells[1]?.innerText.trim() || '0')),
    工單工時: parseFloat(parseFloat(cells[2]?.innerText.trim() || '0').toFixed(2)),
    狀態工時: parseFloat(parseFloat(cells[3]?.innerText.trim() || '0').toFixed(2)),
    狀態工時2: parseFloat(parseFloat(cells[4]?.innerText.trim() || '0').toFixed(2)),
    貼紙班: parseFloat(parseFloat(cells[5]?.innerText.trim() || '0').toFixed(2)),
    殘疾人: parseFloat(parseFloat(cells[6]?.innerText.trim() || '0').toFixed(2)),
    無效工時: parseFloat(parseFloat(cells[7]?.innerText.trim() || '0').toFixed(2)),
    未設定工單: parseFloat(parseFloat(cells[8]?.innerText.trim() || '0').toFixed(2)),
    借入工時: parseFloat(parseFloat(cells[9]?.innerText.trim() || '0').toFixed(2)),
    借出工時: parseFloat(parseFloat(cells[10]?.innerText.trim() || '0').toFixed(2)),
    調整工時: parseFloat(parseFloat(cells[11]?.innerText.trim() || '0').toFixed(2)),
    備註: cells[12]?.innerText || '',
    系統計算差異: parseFloat(parseFloat(cells[13]?.innerText.trim() || '0').toFixed(2)),
    // 其他需要保存的資料也在這裡處理
  };
      });
      const dataRows2 = Array.from(document.querySelectorAll('#WO2 tbody tr'));
      this.WOSUMdata2 = dataRows2.map(row => {
        const cells2 = row.querySelectorAll('td');

        return {
          部門: cells2[0].innerText|| '',
          拉:cells2[1].innerText|| '',
          工單:cells2[2].innerText|| '',
          工序:cells2[3].innerText|| '',
          品名:cells2[4].innerText|| '',
          數量:parseFloat(parseFloat(cells2[5]?.innerText || '0').toFixed(2)),
          標準工時:parseFloat(parseFloat(cells2[6]?.innerText|| '0').toFixed(2)),
          執行工時: parseFloat(parseFloat(cells2[7]?.innerText || '0').toFixed(2)),	

        };
      });
          // Combine data for all tables
          const WOCombinedData = {
            MFG_DAY: this.selectedDate,
            WOEmployee: this.WOSUMdata,
            WOEmploymentTime: this.WOSUMdata2,
          };
          console.log('更新成功', WOCombinedData);
          // Send combined data to backend API https://localhost:5001/api/TableToExcel/to-excel
           axios.post('http://192.168.207.17:5024/api/WOTableToExcel/to-excel', WOCombinedData, { responseType: 'blob' })
         //axios.post('https://localhost:5001/api/WOTableToExcel/to-excel', WOCombinedData, { responseType: 'blob' })
            .then(response => {
              const blob = new Blob([response.data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
              const link = document.createElement('a');
              link.href = window.URL.createObjectURL(blob);
              link.download =  this.selectedDate+'生產日報 report.xlsx';
              link.click();
            })
            .catch(error => {
              console.error('Error exporting to Excel:', error);
            });
        
        },
        exportToExcel2() {
          const wb = XLSX.utils.book_new();

// 第一个表格的数据
const ws1 = XLSX.utils.json_to_sheet(this.woderpdata);
XLSX.utils.book_append_sheet(wb, ws1, '總表');

// 第二个表格的数据
const ws2 = XLSX.utils.json_to_sheet(this.erpdata1);
XLSX.utils.book_append_sheet(wb, ws2, 'NFC工時與ERP工時不符');
const ws3 = XLSX.utils.json_to_sheet(this.erpdata2);
XLSX.utils.book_append_sheet(wb, ws3, 'NFC已完成ERP未結案');
const ws4 = XLSX.utils.json_to_sheet(this.erpdata3);
XLSX.utils.book_append_sheet(wb, ws4, 'NFC未完成ERP已結案');
const ws5 = XLSX.utils.json_to_sheet(this.erpdata4);
XLSX.utils.book_append_sheet(wb, ws5, 'NFC沒資料ERP已結案');
const ws6 = XLSX.utils.json_to_sheet(this.erpdata5);
XLSX.utils.book_append_sheet(wb, ws6, '昨日已完成工單');
const ws7 = XLSX.utils.json_to_sheet(this.erpdata6);
XLSX.utils.book_append_sheet(wb, ws7, '廠區生產未完成工單');

// 导出 Excel 文件
const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
const fileName = '工單狀態與ERP對比報表.xlsx';
const blob = new Blob([wbout], { type: 'application/octet-stream' });

if (navigator.msSaveBlob) {
  navigator.msSaveBlob(blob, fileName);
} else {
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.setAttribute('download', fileName);
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
},
PDSNexportToExcel() {
          const wb = XLSX.utils.book_new();

// 第一个表格的数据
const ws1 = XLSX.utils.json_to_sheet(this.SFPDSNLINK);
XLSX.utils.book_append_sheet(wb, ws1, '總表');

// 第二个表格的数据

// 导出 Excel 文件
const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
const fileName = '出貨序號對照表.xlsx';
const blob = new Blob([wbout], { type: 'application/octet-stream' });

if (navigator.msSaveBlob) {
  navigator.msSaveBlob(blob, fileName);
} else {
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.setAttribute('download', fileName);
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
},
  
 
  exportTableToExcel() {
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet([]);

      // 处理表格1的数据
      const table1 = document.querySelector('#erpsum');
      const table1Headers = [
        [table1.querySelector('th[colspan]').innerText],
        Array.from(table1.querySelectorAll('thead th')).map(th => th.innerText)
      ];
      const table1Data = Array.from(table1.querySelectorAll('tbody tr')).map(tr =>
        Array.from(tr.querySelectorAll('td')).map(td => td.innerText)
      );

      // 处理表格2的数据
      const table2 = document.querySelector('#erpsum');
      const table2Headers = [Array.from(table2.querySelectorAll('thead th')).map(th => th.innerText)];
      const table2Data = Array.from(table2.querySelectorAll('tbody tr')).map(tr =>
        Array.from(tr.querySelectorAll('td')).map(td => td.innerText)
      );

      // 合并数据


      // 写入数据到工作表
      XLSX.utils.sheet_add_aoa(ws, mergedData, { origin: 'A1' });

      // 处理合并单元格
      ws['!merges'] = [
        { s: { r: 0, c: 0 }, e: { r: 0, c: 7 } }, // 合并第一张表的标题行
      ];

      XLSX.utils.book_append_sheet(wb, ws, '考勤報告');
      XLSX.writeFile(wb, '考勤報告.xlsx');
    },
    exportToExcel() {
      fetch('http://192.168.207.17:5024/api/TableToExcel/generate')
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.blob();
        })
        .then(blob => {
          const url = window.URL.createObjectURL(new Blob([blob]));
          const a = document.createElement('a');
          a.href = url;
          a.download = 'attendance_report.xlsx';
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
        })
        .catch(error => {
          console.error('There was a problem with the fetch operation:', error);
        });
    },
                  
              
        exportToExcel_wo() {
          const data = this.generateExcelData_wo();
          const ws = XLSX.utils.json_to_sheet(data);
          const wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
          XLSX.writeFile(wb, this.WOVERSON[0].部門 + "工單明細.xlsx");
        },
        generateExcelData_wo() {
          const data = [];
          this.WOVERSON.forEach(item => {
            data.push({
              部門: item.部門,
              總工時: item.執行工時,
              執行工單: item.執行工單,
              品名: item.品名,
              執行工時: item.工單工時

            });
          });
          return data;
        },
        toggleStatus(id, show) {
  const newValue = show === 'T' ? 'F' : 'T';
  const ID = parseInt(id, 10);

  // 构建 PUT 请求的主体
  const updateData = {
    id: ID,
    area: this.selectedArea,
    show: newValue
  };

  axios.put('http://192.168.207.17:5024/api/Attendance/UPDATE_SHOW', updateData, {
    headers: {
      'Content-Type': 'application/json'  // 设置 Content-Type 为 JSON
    }
  })
  .then(response => {
    // 处理成功的响应
    console.log('更新成功', response);
  })
  .catch(error => {
    // 处理错误
    console.error('更新失败', error);
  });

  console.log('选中的数据:', updateData);
},
toggleSHIFTStatus(id, show,NAME) {
  const newValue = show === 'T' ? 'F' : 'T';
  const ID = parseInt(id, 10);

  // 构建 PUT 请求的主体
  const updateData = {
    id: ID,
    area: this.selectedArea,
    show: newValue,
    field:NAME
  };
  axios.put('http://192.168.207.17:5024/api/c_shift/UPDATE_SHOW', updateData, {
    headers: {
      'Content-Type': 'application/json'  // 设置 Content-Type 为 JSON
    }
  })
  .then(response => {
    // 处理成功的响应
    console.log('更新成功', response);
  })
  .catch(error => {
    // 处理错误
    console.error('更新失败', error);
  });
this.shift_data();

},
updateAllRatings() {


    const payload = this.RATING_data.map(item => ({
      area: this.selectedArea,
      qty1: item.COMPLETED_QTY_1,
      qty2: item.COMPLETED_QTY_2,
      qty3: item.COMPLETED_QTY_3,
      qty4: item.COMPLETED_QTY_4,
      qty5: item.COMPLETED_QTY_5,
      toqty: this.calculateTotalCompletedQty(item),
      ID: String(item.id)
    }));
    console.log('id:',payload);

    axios.put("http://192.168.207.17:5024/api/READWOID/UPDATE_RATING_ALL", payload)
      .then(response => {
        alert(response.data); // 提示更新成功的信息
        this.fetchData();
        this.RATING_fetchData()

      })
      .catch(error => {
        console.error(error);
        alert("更新失敗！");
      });
  },
async updateRATINGDate(ID, fqc1,fqc2,fqc3,fqc4,fqc5,total) {

      try {

        const response = await axios.put(
          "http://192.168.207.17:5024/api/READWOID/UPDATE_RATING",
          {
             area: this.selectedArea, // 根據需求傳入正確值
             qty1: fqc1,
             qty2: fqc2,
             qty3: fqc3,
             qty4: fqc4,
             qty5: fqc5,
             toqty: total,
             id: String(ID), // 将 id 转换为字符串

          }
        );

        alert(response.data);
      } catch (error) {
        console.error("更新失敗", error);
        alert("更新失敗，請重試！");
      } finally {
        this.fetchData();
        this.RATING_fetchData()
      }
    },
    completeWorkOrder(woId, fqc) {

    const requestData = {
      wO_ID: woId,
      fqc: fqc.toString(),
      department: this.selectedDepartment, // 您的部门名称
      area: this.selectedArea // 您的区域名称
    };
    axios.post('http://192.168.207.17:5024/api/READWOID/update', requestData)
    .then(response => {
      // 成功时弹出成功消息
      console.log('选中的数据:', this.translatedText.更新完成);
      alert(this.translatedText.更新完成);
      // 如果需要在完成后进行一些额外的操作，可以在此处添加代码
    })
    .catch(error => {
      // 失败时弹出错误消息
      alert(this.translatedText[currentLanguage].更新完成);
      console.error('完成工單时出错', requestData);
      // 处理错误情况
    });
  },
    changeLanguage(event) {
            this.currentLanguage = event.target.value;

            // 根據選定的語言更新translatedText中的內容
            if (this.currentLanguage === 'zh') {
                this.translatedText = {
                  總數量:'總數量',
                一般:'一般',
                焊接:'焊接',
                成型:'成型',
                做線:'做線',
                焊接S:'焊接',
                成型S:'成型',
                做線S:'做線',
                星級完成數量:'重點工站完成數量',
                    在線生產看板: '在線生產看板',
                    每日生產看版:'每日生產看版',
                    工單管理: '工單管理',
                    工單查詢: '工單查詢',
                    工站管理: '工站管理',
                    工站設定:'工站設定',
                    人員管理: '人員管理',
                    考勤異常: '考勤異常',
                    生產看版: '生產看版',
                    工單分析圖表: '工單分析圖表',
                    未結工單: '未結工單',
                    完工數量:'完工數量',
                    生產日報:'生產日報',
                    產能日報:'產能日報',
                    卡片設定:'卡片設定',
                    考勤日報:'考勤日報',
                    登入:'登入',
                    NFC_SYSTEAM:'NFC 系統',
                    考勤系統:'考勤系統',
                    生產數據:'生產數據',
                    area:'選擇廠區',
                    部門:'部門',
                    D:'部',
                    S:'課',
                    C:'班',
                    L:'拉',
                    在線人數:'在線人數',
                    應出席人數:'應出席人數',
                    實際出席人數:'實際出席人數',
                    請假人數:'請假人數',
                    流水線在線人數:'流水線在線人數',
                    借入人數:'借入人數',
                    借出人數:'借出人數',
                    工單列表:'工單列表',
                    ID:'編號',
                    工單:'工單',
                    品名:'品名',
                    數量:'數量',
                    標準工時:'標準工時',
                    執行工時:'執行工時',
                    當前效率:'當前效率',
                    過往效率:'過往效率',
                    已完成數量:'已完成數量',
                    設備:'設備',
                    姓名:'姓名',
                    工時:'工時',
                    工站:'工站',
                    座位:'座位',
                    工站列表:'工站列表',
                    功能:'功能',
                    fqcer1:'輸入值不能小於原值',
                    fqcer2:'輸入值不能大於工單數量',
                    完成:'完成',
                    暫停:'暫停',
                    復工:'復工',
                    輸入工單:'輸入工單',
                    查詢:'查詢',
                    提交:'提交',
                    workOrder1:'100:試產工單, 200:來料全檢, 400:重工,700 物料員工時',
                    貼紙班:'貼紙班',
                    裁剝班:'裁線班',
                    料號:'料號',
                    設定工單列表:'設定工單列表',
                    移除:'移除',
                    總和:'總和',
                    修改:'修改',
                    取消:'取消',
                    增加座位:'增加座位',
                    刪除座位:'刪除座位',
                    卡機號:'卡機號',
                    工站名稱:'工站名稱',
                    insert:'插入',
                    delete:'刪除',
                    New:'新增',
                    出勤:'出勤',
                    工作拉:'工作拉',
                    工號:'工號',
                    Status:'狀態',
                    事由:'事由',
                    年休:'年休',
                    請假:'請假',
                    哺乳假:'哺乳假',
                    工傷:'工傷',
                    工傷陪護:'工傷陪護',
                    借出:'借出',
                    新進員工:'新進員工',
                    夜班:'夜班',
                    考勤日報:'考勤日報',
                    show:'顯示',
                    出勤人數:'出勤人數',
                    實際掛卡工時:'實際掛卡工時',
                    總共考勤工時:'總共考勤工時',
                    回報管理部考勤工時:'回報管理部考勤工時', 
                    差異:'差異', 
                    原因:'原因',
                    輸入卡機:'輸入卡機',
                    NFC卡號:'NFC卡號',
                    choose:'選擇 NFC_CODE',
                    刷新:'刷新',
                    在線工單:'在線工單',
                    平均效率:'平均效率',
                    低於90工單數:'低於90%工單數',
                    已完成工單:'已完成工單',
                    未結案工單:'未結案工單',
                    無效工時:'無效工時(hrs)',
                    本日:'本日',
                    本月:'本月',
                   上月:'上月',
                   pd1:'備註：(本月、上月)資料來源ERP',
                   應報考勤:'應報考勤',
                   加總:'加總',
                   導出:'導出',
                   系統計算考勤工時:'系統計算考勤工時',
                   增加有效考勤工時:'增加有效考勤工時',
                   正班工時:'正班工時',
                   加班工時:'加班工時',
                   假別:'假別',
                   更新完成:'更新完成',
                   更新失敗:'更新失敗',
                   重複輸入:'输入值重复，请重新输入！',
                   查無卡號:'查無卡號',
                   工單已存在:'该工單號已存在于表格中。',
                   未添加工單:'未添加工單',
                   查無工單:'查無工單，是否手動增加？',
                   請輸暫停理由:'請輸暫停理由：',
                   未生產:'未生產',
                   調整:'調整',
                   忘記設定:'忘記設定',
                  忘記設定狀態:'忘記設定狀態',
                  工作部門:'工作部門',
                  備註:'備註',
                  考勤調整確認:'考勤調整確認',
                  日期:'日期',
                  班別管理:'班別管理',
                  工單狀態與ERP對比報表:'工單狀態與ERP對比報表',
                  ERP入庫數量:'ERP入庫數量',
                  過站管理:'過站管理',
                  序號管理:'序號管理',
                  序號查詢:'序號查詢',
                  出貨序號表:'出貨序號表',
                  不良品紀錄查詢:'不良品紀錄查詢',
                工站編號:'工站編號',
                綁定工站:'綁定工站',
                測試工站:'測試工站',
                輸入開始序號:'輸入開始序號',
                   
                };
            } else if (this.currentLanguage === 'en') {
                this.translatedText = {

                  總數量:'Total quantity',
                  星級完成數量:'Number of stars completed',
                一般:'General',
                焊接:'welding',
                成型:'MD',
                做線:'Make a line',
                焊接S:'welding',
                成型S:'MD',
                做線S:'Make a line',
                    在線生產看板: 'In line production dashboard',
                    每日生產看版:'Daily production board',
                    工單管理: 'Work order query',
                    工單查詢: '工單查詢',
                    工站管理: 'Work station management',
                    工站設定:'Workstation settings',
                    人員管理: 'Staff management',
                    考勤異常: 'Abnormal attendance',
                    生產看版: 'Production dashboard',
                    工單分析圖表: 'Work order analysis chart',
                    未結工單: 'Unfinished work order',
                    完工數量:'Completed quantity',
                    生產日報:'Daily production report',
                    產能日報:'Capacity Daily',
                    卡片設定:'Card settings',
                    考勤日報:'Attendance daily report',
                    登入:'Log in',
                    NFC_SYSTEAM:'NFC Systeam',
                    考勤系統:'Attendance System',
                    生產數據:'Production Data',
                    area:'Area',
                    部門:'department',
                    D:'D',
                    S:'S',
                    C:'C',
                    L:'L',
                    在線人數:'Online users',
                    應出席人數:'Number of people to attend',
                    實際出席人數:'Actual attendance',
                    請假人數:'Leave',
                    流水線在線人數:'Production line users',
                    借入人數:'Borrowing',
                    借出人數:'Lending',
                    工單列表:'Work Order List',
                    ID:'ID',
                    工單:'Work_Order',
                    品名:'Product name',
                    數量:'Quantity',
                    標準工時:'Standard hours',
                    執行工時:'Execution hours',
                    當前效率:'Current efficiency',
                    過往效率:'Past efficiency',
                    已完成數量:'Completed quantity',
                    設備:'Equipment:',
                    姓名:'Name',
                    工時:'Hours',
                    工站:'Workstation',
                    座位:'Seats',
                    工站列表:'Seat list',
                    功能:'Function',
                    fqcer1:'The input value cannot be less than the original value',
                    fqcer2:'The input value cannot be greater than the work order quantity',
                    完成:'complete',
                    暫停:'pause',
                    復工:'Return to work',
                    輸入工單:'Enter work order NO.',
                    查詢:'Query',
                    提交:'submit',
                    workOrder1:'100: Trial production work order, 200: Full inspection of incoming materials, 400:,700 Giờ làm việc của nhân viên vật liệu',
                    貼紙班:'Sticker class',
                    裁剝班:'Cut and strip wire',
                    料號:'Part No',
                    設定工單列表:'Set up work order list',
                    移除:'remove',
                    總和:'sum',
                    choose:'Chooset NFC CODE',
                    修改:'Revise',
                    取消:'Cancel',
                    增加座位:'Add Seats',
                    刪除座位:'Delete seat',
                    卡機號:'machine number',
                    工站名稱:'Work_ tation',
                    insert:'Insert',
                    delete:'Delete',
                    New:'New',
                    出勤:'Attendance',
                    工作拉:'Production line',
                    工號:'Job number',
                    Status:'Status',
                    事由:'Reason',
                    年休:'Annual leave',
                    請假:' Ask for leave',
                    哺乳假:'Breastfeeding leave',
                    工傷:'work injury leave',
                    工傷陪護:'Work injury escort',
                    借出:'Borrowing',
                    新進員工:'Junior staff',
                    夜班:'Night shift',
                    考勤日報:'Daily attendance report',
                    show:'show',
                    出勤人數:'Attendance',
                    實際掛卡工時:'Actual working hours',
                    總共考勤工時:'Total attendance hours',
                    回報管理部考勤工時:'Report attendance hours to the management department', 
                    差異:'Difference', 
                    原因:'Reason',
                    輸入卡機:'Input card machine NO.',
                    NFC卡號:'NFC card number',
                    NFC_CODE:'NFC_CODE',
                    刷新:'Refresh',
                    在線工單:'Online work order',
                    平均效率:'Average efficiency',
                    低於90工單數:'Less than 90% of work orders',
                    已完成工單:'Completed Work_Order',
                    未結案工單:'Open case work order',
                    無效工時:'Invalid working hours(hrs)',
                    本日:'Today',
                    本月:'This month',
                    上月:'Last month',
                    pd1:'Remarks: (This month, Last month) Data source ERP',
                    應報考勤:'Attendance should be reported:',
                    加總:'Total',
                    導出:'Export',
                    系統計算考勤工時:'The system calculates attendance hours',
                    增加有效考勤工時:'Increase effective attendance hours',
                    正班工時:'Regular working hours',
                    加班工時:'overtime hours',
                    假別:'Leave type',
                    更新完成:'Update completed',
                    更新失敗:'Update failed',
                    重複輸入:'The input value is repeated, please re-enter!',
                    查無卡號:'Check no card number',
                    工單已存在:'The work order number already exists in the table',
                    未添加工單:'No work order added',
                    查無工單:'If there is no work order, do you want to add it manually?',
                    請輸暫停理由:'Please enter the reason for suspension:',
                    未生產:'Not produce yet',
                    調整:'Adjustment',
                    忘記設定:'Forgot settings',
                     忘記設定狀態:'Forgot to set status',
                     工作部門:'Working department',
                     備註:'Remark',
                     考勤調整確認:'Attendance adjustment',
                     日期:'MFG_DAY',
                     班別管理:'Shift management',
                     工單狀態與ERP對比報表:'Work order status and ERP comparison report',
                     ERP入庫數量:'ERP warehousing quantity',
                     過站管理:'Station management',
                     序號管理:'Serial number management',
                     序號查詢:'Serial number query',
                     出貨序號表:'Shipping serial number table',
                     不良品紀錄查詢:'Defective product record inquiry',
                     工站編號:' Station number',
                     綁定工站:' Bind work station',
                     測試工站:' Test station',
                     輸入開始序號:'Enter the starting sequence number',

                };
            } else if (this.currentLanguage === 'vi') {
                this.translatedText = {
                  總數量:'Tổng số lượng',
                  星級完成數量:'Số sao đã hoàn thành',
                  一般:'Tổng quan',
                焊接:'Hàn',
                成型:'Thành hình',
                做線:'Làm dây',
                焊接S:'Hàn',
                成型S:'Thành hình',
                做線S:'Làm dây',
                    在線生產看板: 'Bảng điều khiển sản xuất trên chuyền',
                    每日生產看版:'Bảng sản xuất hàng ngày',
                    工單管理: 'Quản lý công đơn',
                    工單查詢: 'Truy vấn lệnh sản xuất',
                    工站管理: 'Quản lý trạm',
                    工站設定:'Cài đặt máy trạm',
                    人員管理: 'Quản lý nhân sự',
                    考勤異常: 'Chấm công bất thường',
                    生產看版: 'Bảng điều khiển sản xuất',
                    工單分析圖表: 'Biểu đồ phân tích công đơn',
                    未結工單: 'Công đơn chưa hoàn thành',
                    完工數量:'Số lượng đã hoàn thành',
                    生產日報:'Báo cáo sản xuất hàng ngày',
                    產能日報:'Công suất hàng ngày',
                    卡片設定:'Cài đặt thẻ',
                    考勤日報:'Báo cáo chấm công hàng ngày',
                    登入:'Đăng nhập',
                    NFC_SYSTEAM:'NFC_SYSTEAM',
                    考勤系統:'Hệ thống chấm công',
                    生產數據:'Dữ liệu sản xuất',
                    area:'Khu vực',
                    部門:'Bộ phận',
                    D:'D',
                    S:'S',
                    C:'C',
                    L:'L',
                    在線人數:'Số người trên chuyền',
                    應出席人數:'Số người tham gia',
                    實際出席人數:'Số người tham gia thực tế',
                    請假人數:'Số người xin nghỉ phép',
                    流水線在線人數:'Số người làm việc trên chuyền',
                    借入人數:'Số lượng người mượn',
                    借出人數:'Số người cho mượn',
                    工單列表:'Danh sách công đơn',
                    ID:'ID',
                    工單:'Công đơn',
                    品名:'Tên sản phẩm',
                    數量:'Số lượng',
                    標準工時:'Giờ làm việc tiêu chuẩn',
                    執行工時:'Giờ thực hiện',
                    當前效率:'Hiệu suất hiện tại',
                    過往效率:'Hiệu suất trước kia',
                    已完成數量:'Số lượng đã hoàn thành',
                    設備:'Thiết bị',
                    姓名:'Tên',
                    工時:'Giờ làm việc',
                    工站:'Trạm',
                    座位:'Số ghế',
                    工站列表:'Danh sách trạm',
                    功能:'Chức năng',
                    fqcer1:'Giá trị đầu vào không thể nhỏ hơn giá trị ban đầu',
                    fqcer2:'Giá trị đầu vào không được lớn hơn số lượng công đơn',
                    完成:'Hoàn thành',
                    暫停:'Tạm dừng',
                    復工:'Quay trở lại làm việc',
                    輸入工單:'Nhập công đơn',
                    查詢:'Tra cứu',
                    提交:'Nộp',
                    workOrder1:'100: Lệnh sản xuất thử, 200: Kiểm tra toàn bộ nguyên liệu đầu vào, 400: Công việc nặng nhọc,700 Giờ làm việc của nhân viên vật liệu',
                    貼紙班:'Loại nhãn dá',
                    裁剝班:'Cắt và tước dây',
                    料號:'Mã liệu',
                    設定工單列表:'Thiết lập danh sách công đơn',
                    移除:'Di dời',
                    總和:'Tổng',
                    choose:'Chọn NFC CODE',
                    修改:'Sửa đổi',
                    取消:'Hủy bỏ',
                    增加座位:'Thêm chỗ ngồi',
                    刪除座位:'Xóa chỗ ngồi',
                    卡機號:'Số thiết bị',
                    工站名稱:'Tên trạm',
                    insert:'Chèn',
                    delete:'Xóa',
                    New:'Mới',
                    出勤:'Tham gia',
                    工作拉:'Chuyền',
                    工號:'Mã số nhân viên',
                    Status:'Trạng thái',
                    事由:'Lý do',
                    年休:'Nghỉ phép năm',
                    請假:'Nghỉ việc riêng',
                    哺乳假:'Nghỉ con nhỏ',
                    工傷:'Tai nạn lao động',
                    工傷陪護:'Bồi thường tai nạn lao động',
                    借出:'Cho mượn',
                    新進員工:'Nhân viên mới',
                    夜班:'Ca đêm',
                    考勤日報:'Chấm công hàng ngày',
                    show:'Trình bày',
                    出勤人數:'Số người tham gia',
                    實際掛卡工時:'Số giờ sản xuất thực tế',
                    總共考勤工時:'Tổng số giờ tham gia',
                    回報管理部考勤工時:'Báo cáo số giờ tham gia cho bộ phận Nhân sự', 
                    差異:'Sự khác biệt', 
                    原因:'Nguyên nhân',
                    輸入卡機:'Nhập số thiết bị',
                    NFC卡號:'Mã thẻ NFC',
                    NFC_CODE:'NFC_CODE',
                    刷新:'làm cho khỏe lại',
                    在線工單:'Lệnh làm việc trực tuyến',
                    平均效率:'Hiệu quả trung bình',
                    低於90工單數:'Ít hơn 90% đơn đặt hàng công việc',
                    已完成工單:'Đã hoàn thành công việc_Đơn hàng',
                    未結案工單:'Mở lệnh làm việc',
                    無效工時:'Giờ làm việc không hợp lệ(hrs)',
                    本日:'Hôm nay',
                    本月:'tháng này',
                    上月:'tháng trước',
                    pd1:'Lưu ý: (tháng này, tháng trước) nguồn dữ liệu ERP',
                    應報考勤:'Việc tham dự phải được báo cáo',
                    加總:'Tổng cộng',
                    導出:'Xuất khẩu',
                    系統計算考勤工時:'Hệ thống tính số giờ chấm công',
                    增加有效考勤工時:'Tăng số giờ đi học hiệu quả',
                    正班工時:'Giờ làm việc thường xuyên',
                    加班工時:'giờ tăng ca',
                    假別:'loại nghỉ phép',
                    更新完成:'Cập nhật đã hoàn tất',
                    更新失敗:'Cập nhật không thành công',
                    重複輸入:'Giá trị đầu vào bị lặp lại, vui lòng nhập lại!',
                    查無卡號:'Kiểm tra không có số thẻ',
                    工單已存在:'Số lệnh sản xuất đã tồn tại trong bảng',
                    未添加工單:'Không có lệnh sản xuất nào được thêm vào',
                    查無工單:'Nếu không có lệnh sản xuất, bạn có muốn thêm nó theo cách thủ công không?',
                    請輸暫停理由:'Vui lòng nhập lý do tạm dừng:',
                    未生產:'Chưa sản xuất',
                    調整:'Điều chỉnh',
                    忘記設定:'Quên cài đặt',
                     忘記設定狀態:'Quên đặt trạng thái',
                     工作部門:'Bộ phận công tác',
                     備註:'Nhận xét',
                     考勤調整確認:'Điều chỉnh chấm công',
                     日期:'ngày',
                     班別管理:'Quản lý ca',
                     工單狀態與ERP對比報表:'Trạng thái lệnh sản xuất và báo cáo so sánh ERP',
                     ERP入庫數量:'Số lượng kho ERP',
                     過站管理:'Quản lý trạm',
                     序號管理:'Quản lý số sê-ri',
                     序號查詢:'Truy vấn số sê-ri',
                     出貨序號表:'Bảng số serial vận chuyển',
                     不良品紀錄查詢:'Truy vấn hồ sơ sản phẩm bị lỗi',
                     工站編號:'Số trạm',
                     綁定工站:'Trạm làm việc ràng buộc',
                     測試工站:'Trạm kiểm tra',
                     輸入開始序號:'Nhập số thứ tự bắt đầu',
                };
            }
        },
    removeRow(item) {
        // 在这里处理移除行的逻辑
        const index = this.ERPDATA.indexOf(item);
        if (index !== -1) {
            this.ERPDATA.splice(index, 1);
        }
    },

     async updateStatus(JOBNUMBER, status) {
      let hrtime;
      let note;
      const translatedText = {
    zh: {
        事由: '請輸入理由:', // 添加出勤的翻译
        考勤: '請輸有效考勤工時（只能輸入數字）：', // 添加出勤的翻译
       },
      en: {

        事由: 'Please enter the reason',
        考勤: 'Please enter valid attendance hours (only numbers can be entered):', // 添加出勤的翻译
     },
     vi: {
      事由: 'Vui lòng nhập lý do',
      考勤: 'Vui lòng nhập số giờ tham dự hợp lệ (chỉ có thể nhập số):', // 添加出勤的翻译
     }
     
};
let currentLanguage = this.currentLanguage; // 默认语言为中文
      if(status==='請假' ){
       hrtime ='0';
        note = window.prompt(translatedText[currentLanguage].事由 );
        
      }else if (status==='夜班'){
        hrtime ='0';
        note = '';
      }else if (status==='備註'){
        hrtime ='0';
        note = window.prompt(translatedText[currentLanguage].事由 );
        }else if (status==='借出'){
          while (true) {
    hrtime = window.prompt(translatedText[currentLanguage].考勤);

    // 使用 isNaN() 函数检查输入是否为数字
    if (!isNaN(hrtime)) {
        break; // 如果输入是数字，跳出循环
    }
}
const options = [
        "廠內重工工時",
        "其它廠重工工時",
        "其他借出工時"
    ];

    let message = translatedText[currentLanguage].事由 + "\n";
    options.forEach((option, index) => {
        message += `${index + 1}. ${option}\n`;
    });

    let choice;
    while (true) {
        choice = window.prompt(message);
        if (choice >= 1 && choice <= options.length) {
            note = options[choice - 1];
            break;
        }
    }

    console.log("選擇的事由:", note);
        }else{


// 使用 while 循环确保用户输入的是一个有效的数字
while (true) {
    hrtime = window.prompt(translatedText[currentLanguage].考勤);

    // 使用 isNaN() 函数检查输入是否为数字
    if (!isNaN(hrtime)) {
        break; // 如果输入是数字，跳出循环
    }
}
        note = window.prompt(translatedText[currentLanguage].事由 );

      }

      // Make API call to add new staff
      const apiUrl = "http://192.168.207.17:5024/api/Attendance/UPDATESTATUS";
      
      // Assuming you have Axios installed, if not run: npm install axios

      axios.post(apiUrl, {
        area: this.selectedArea,
        jobnumber: JOBNUMBER,
        ststus: status,
        hr_time:hrtime,
        note:note,
      
})
        .then(response => {
          // Handle success
          console.log("New staff added successfully:", response.data);
          this. staff_data();
          // You may want to update the staffData array with the new data
          // For example, this.staffData.push(response.data);

          // Reset the form and hide it
        })
        .catch(error => {
          // Handle error
          console.log("hrtime", hrtime);
          console.error("Error adding new staff:", error);
        });
    },
    startAutoScroll() {
          this.intervalId = setInterval(() => {
            // 移除第一個元素，將新數字添加到最後
            this.PDVERSON.push(this.PDVERSON.shift());
          }, 1000); // 調整循環播放的時間間隔
        },
        stopAutoScroll() {
          clearInterval(this.intervalId);
        },
        countShiftDesc(index, data) {
      let count = 1;
      while (index + count < data.length && data[index + count].部門 === data[index].部門) {
        count++;
      }
      return count;
    },
    countShiftDescATT(index) {
      let count = 1;
      while (index + count < this.ATT_time_data.length && this.ATT_time_data[index + count].部門 === this.ATT_time_data[index].部門) {
        count++;
      }
      return count;
    },
    ATT_Abnorma_data() {
    // Make a POST request to the API
    axios.post('http://192.168.207.17:5024/api/Attendance/ATT_DATA_Exception', /* Add any data you need to send in the body */)
      .then(response => {
        // Assuming the API response contains data in a property named 'data'
        this.ATT_Abnormal_d = response.data;
      })
      .catch(error => {
        console.error('Error fetching data:', error);
      });
  },

    formatDepartment(department) {
      if (!department) {
        return '';  // 如果没有部门值，则返回空字符串
      }

      // 使用 replace 方法替换字符串中的 "D"、"S"、"C"
      const formattedDepartment = department.replace(/D/g, 'D').replace(/S/g, 'S').replace(/C/g, 'C');
      return formattedDepartment;
    },
    async woderp() {
      this.woderpdata = [];
      this.erpdata1=[];
      this.erpdata2=[];
      this.erpdata3=[];
      this.erpdata4=[];
      this.erpdata5=[];
      this.erpdata6=[];
      this.loading = true;
      this.woderpreport = true;
       if (!this.selectedArea) {
       this.loading = false;
     
      return; // 如果没有选择区域，直接返回
        }
        const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;

        const apiUrl1 = `http://192.168.207.17:5024/api/Report/WO_ERP__SUM_version?AREA=${this.selectedArea}`;
        const apiUrl2 = `http://192.168.207.17:5024/api/Report/WO_ERP_1?AREA=${this.selectedArea}`;
        const apiUrl3 = `http://192.168.207.17:5024/api/Report/WO_ERP_2?AREA=${this.selectedArea}`;
        const apiUrl4 = `http://192.168.207.17:5024/api/Report/WO_ERP_3?AREA=${this.selectedArea}`;
        const apiUrl5 = `http://192.168.207.17:5024/api/Report/WO_ERP_4?AREA=${this.selectedArea}`;
        const apiUrl6 = `http://192.168.207.17:5024/api/Report/WO_ERP_5?AREA=${this.selectedArea}&MFG_DAY=${formattedDate}`;
        const apiUrl7 = `http://192.168.207.17:5024/api/Report/WO_ERP_6?AREA=${this.selectedArea}`;

        try {
        const responses = await Promise.all([
            fetch(apiUrl1),
            fetch(apiUrl2),
            fetch(apiUrl3),
            fetch(apiUrl4),
            fetch(apiUrl5),
            fetch(apiUrl6),
            fetch(apiUrl7)

        ]);
        const data = await Promise.all(responses.map(response => response.json()));

        this.woderpdata = data[0];
        this.erpdata1 = data[1];
        this.erpdata2 = data[2];
        this.erpdata3 = data[3];
        this.erpdata4 = data[4];
        this.erpdata5 = data[5];
        this.erpdata6 = data[6];
     } catch (error) {
    console.error('Error fetching data:', error);
    }
     this.loading = false;
     this.woderpreport = true;

},
    async PDVER() {
      this.PDVERSON = [];
      this.PDTOVERSON = [];
      this.loading = true;
       this.SHOW_PD_VERSON = true;

       if (!this.selectedArea) {
       this.loading = false;
       this.SHOW_PD_VERSON = true;
      return; // 如果没有选择区域，直接返回
        }

        const apiUrl1 = `http://192.168.207.17:5024/api/Report/PD_version?AREA=${this.selectedArea}`;
        const apiUrl2 = `http://192.168.207.17:5024/api/Report/PD_TO_version?AREA=${this.selectedArea}`;

        try {
        const responses = await Promise.all([
            fetch(apiUrl1),
            fetch(apiUrl2)
        ]);
        const data = await Promise.all(responses.map(response => response.json()));

        this.PDVERSON = data[0];
        this.PDTOVERSON = data[1];
     } catch (error) {
    console.error('Error fetching data:', error);
    }
     this.loading = false;
     this.SHOW_PD_VERSON = true;

},

async  fetchCombinedVersions(selectedArea) {
     this.PDVERSON = [];
      this.PDTOVERSON = [];
      this.loading = true;
      this.SHOW_PD_VERSON = false;
       if (!this.selectedArea) {
       this.loading = false;
       this.SHOW_PD_VERSON = true;
      return; // 如果没有选择区域，直接返回
        }

    const apiUrl = `http://192.168.207.17:5024/api/Report/Combined_versions?AREA=${this.selectedArea}`;

    try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        console.log('PD Version:', data.pdVersion);
        console.log('PD TO Version:', data.pdToVersion);

        // 处理数据
        this.PDVERSON = data.pdVersion;
        this.PDTOVERSON = data.pdToVersion;
        this.loading = false;
        this.SHOW_PD_VERSON = true;
    } catch (error) {
        console.error('Error fetching data:', error);
        this.loading = false;
    }
    this.SHOW_PD_VERSON = true;
},

async RATING_SUM_VER() {
  this.RATING_SUM_VERSON = [];
  this.RATINGVERSON = [];
  this.loading = true;

  if (!this.selectedArea) {
    this.loading = false;
    return; // 如果没有选择区域，直接返回
  }

  const date = new Date(this.selectedDate);
  const year = date.getFullYear();
  const month = (date.getMonth() + 1).toString().padStart(2, '0');
  const day = date.getDate().toString().padStart(2, '0');
  const formattedDate = `${year}${month}${day}`;
  const apiUrl1 = `http://192.168.207.17:5024/api/READWOID/SELECT_SUM_RATING?area=${this.selectedArea}&MFG_DAY=${formattedDate}`;

  try {
    const response = await fetch(apiUrl1);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    this.RATING_SUM_VERSON = data.result; // 假设 JSON 数据结构为 { "result": [...] }

    // 根据获取到的数据进行二次处理
    const trueKeys = Object.keys(this.showInSecondTable)
      .filter(key => this.showInSecondTable[key])
      .sort((a, b) => a - b);

    trueKeys.forEach(trueKey => {
      // 避免清空已存在的数据，改为追加处理
      this.RATINGVER(trueKey);
    });
  } catch (error) {
    console.error('Error fetching data:', error);
  } finally {
    this.loading = false;
  }
},
// 日期格式化函数

// 异步函数 RATINGVER
async RATINGVER(DEPARTMENT) {
  console.log("New staff added successfully:", this.showInSecondTable);
  if (!this.showInSecondTable[DEPARTMENT]) {
      // 遍历ATT_time_data数组
      for (let i = this.RATINGVERSON.length - 1; i >= 0; i--) {
        if (this.RATINGVERSON[i].部門 === DEPARTMENT) {
          // 如果部门匹配，从数组中删除该项
          this.RATINGVERSON.splice(i, 1);
        }
      }
    }


  // 如果没有选择区域，直接返回
  if (!this.selectedArea) {
    console.warn('No selected area');
    return;
  }

  this.loading = true; // 开始加载
  const date = new Date(this.selectedDate);
  const year = date.getFullYear();
  const month = (date.getMonth() + 1).toString().padStart(2, '0');
  const day = date.getDate().toString().padStart(2, '0');
  const formattedDate = `${year}${month}${day}`;
  const apiUrl1 = `http://192.168.207.17:5024/api/READWOID/SELECT_SN_RATING?area=${this.selectedArea}&department=${DEPARTMENT}&MFG_DAY=${formattedDate}`;

  try {
    // 发起 API 请求
    const response = await fetch(apiUrl1);

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();

    if (data && Array.isArray(data.result)) {
      // 合并数据到 RATINGVERSON
      this.RATINGVERSON.push(...data.result);

      // 按部门排序
      this.RATINGVERSON.sort((a, b) => (a.部門 < b.部門 ? -1 : a.部門 > b.部門 ? 1 : 0));
    } else {
      console.warn('No valid data returned from API:', data);
    }
  } catch (error) {
    console.error('Error fetching data:', error);
  } finally {
    this.loading = false; // 加载结束
  }

  console.log("RATINGVERSON:", this.RATINGVERSON);
},




async WO_SUM_VER() {
      this.WO_SUM_VERSON = [];
      this.WOVERSON = [];
      this.loading = true;
       if (!this.selectedArea) {
       this.loading = false;
      return; // 如果没有选择区域，直接返回
        }
        const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;
        const apiUrl1 = `http://192.168.207.17:5024/api/Report/WO_SUM_version?AREA=${this.selectedArea}&MFG_DAY=${formattedDate}`;

        try {
        const responses = await Promise.all([
            fetch(apiUrl1),
    
        ]);
        const data = await Promise.all(responses.map(response => response.json()));

        this.WO_SUM_VERSON = data[0];

     } catch (error) {
    console.error('Error fetching data:', error);
    }
    const trueKeys = Object.keys(this.showInSecondTable)
  .filter(key => this.showInSecondTable[key])
  .sort((a, b) => a - b);

trueKeys.forEach(trueKey => {
  this.WOVERSON = [];
  this.WOVER(trueKey);
});
     this.loading = false;
},

async WOVER(DEPARTMENT) {
  console.log("New staff added successfully:", this.showInSecondTable);
  if (!this.showInSecondTable[DEPARTMENT]) {
      // 遍历ATT_time_data数组
      for (let i = this.WOVERSON.length - 1; i >= 0; i--) {
        if (this.WOVERSON[i].部門 === DEPARTMENT) {
          // 如果部门匹配，从数组中删除该项
          this.WOVERSON.splice(i, 1);
        }
      }
    }

      this.loading = true;
       if (!this.selectedArea) {
       this.loading = false;
      return; // 如果没有选择区域，直接返回
        }
        const date = new Date(this.selectedDate);
      const year = date.getFullYear();
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const day = date.getDate().toString().padStart(2, '0');
      const formattedDate = `${year}${month}${day}`;
        const apiUrl1 = `http://192.168.207.17:5024/api/Report/WO_version?AREA=${this.selectedArea}&DEPARTMENT=${DEPARTMENT}&MFG_DAY=${formattedDate}`;

        try {
        const responses = await Promise.all([
            fetch(apiUrl1),
    
        ]);
        const data = await Promise.all(responses.map(response => response.json()));

        //this.WOVERSON = data[0];
        this.WOVERSON.push(...data[0]);
        this.WOVERSON.sort((a, b) => {
        // 按部门名称顺序排序（假设部门名称是字符串）
           if (a.部門 < b.部門) {
          return -1;
          }
             if (a.部門 > b.部門) {
               return 1;
         }
                return 0;
});

     } catch (error) {
    console.error('Error fetching data:', error);
    }
     this.loading = false;
},

async att_hr_SUM_ADJ() {
  this.ATT_time_ADJ_data=[];
  const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;
  this.loading = true;
       if (!this.selectedArea  && !this.selectedDate) {
       this.loading = false;
      return; // 如果没有选择区域，直接返回
        }
  const apiUrl1 = `http://192.168.207.17:5024/api/Attendance/HR_ADJ_CONFIRM?AREA=${this.selectedArea}&mfg_day=${formattedDate}`;
  
  try {
  const responses = await Promise.all([
      fetch(apiUrl1),
  ]);
  const data = await Promise.all(responses.map(response => response.json()));

  this.ATT_time_ADJ_data = data[0];
} catch (error) {
console.error('Error fetching data:', error);
}
this.loading = false;
},
async att_hr_SUM_data() {
      this.ATT_time_data=[];
      this.ATT_time_SUM_data = [];
      this.loading = true;
       if (!this.selectedArea  && !this.selectedDate) {
       this.loading = false;
      return; // 如果没有选择区域，直接返回
        }
        const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;
        const apiUrl1 = `http://192.168.207.17:5024/api/Report/HR_SUN_version?AREA=${this.selectedArea}&MFG_DAY=${formattedDate}`;
  
        try {
        const responses = await Promise.all([
            fetch(apiUrl1),
        ]);
        const data = await Promise.all(responses.map(response => response.json()));

        this.ATT_time_SUM_data = data[0];
     } catch (error) {
    console.error('Error fetching data:', error);
    }
    
   
   /* const trueKeys = Object.keys(this.showInSecondTable).filter(key => this.showInSecondTable[key]);

// 遍历 trueKeys 数组，依次传递每个值为 true 的键给 att_hr_data 方法
trueKeys.forEach(trueKey => {
  this.att_hr_data(trueKey);
});
     this.loading = false;*/

     const trueKeys = Object.keys(this.showInSecondTable)
  .filter(key => this.showInSecondTable[key])
  .sort((a, b) => a - b);

trueKeys.forEach(trueKey => {
  this.att_hr_data(trueKey);
});

this.loading = false;
},

async att_hr_data( DEPATRMENT) {
     // this.ATT_time_data=[];
     if (!this.showInSecondTable[DEPATRMENT]) {
      // 遍历ATT_time_data数组
      for (let i = this.ATT_time_data.length - 1; i >= 0; i--) {
        if (this.ATT_time_data[i].部門 === DEPATRMENT) {
          // 如果部门匹配，从数组中删除该项
          this.ATT_time_data.splice(i, 1);
        }
      }
    }
     this.loading = true;
       if (!this.selectedArea && !this.selectedDate) {
       this.loading = false;
      return; // 如果没有选择区域，直接返回
        }
        if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
} else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
}
const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;
        axios.post('http://192.168.207.17:5024/api/Attendance/ATT_DATA_hr', {
         area: this.selectedArea,
         department:DEPATRMENT,
         mfG_DAY:formattedDate,

})
.then(response => {
// POST請求成功，將數據賦值給seatData
//this.ATT_time_data = this.ATT_time_data.concat(response.data);
this.ATT_time_data.push(...response.data);
this.ATT_time_data.sort((a, b) => {
  // 按部门名称顺序排序（假设部门名称是字符串）
  if (a.部門 < b.部門) {
    return -1;
  }
  if (a.部門 > b.部門) {
    return 1;
  }
  return 0;
});

})
.catch(error => {
// POST請求失敗，輸出錯誤信息
console.error('Error posting data:', error);
});
this.setCookie2('showInSecondTable', JSON.stringify(this.showInSecondTable));
     this.loading = false;
},
    generateChart() {
      // Trigger chart generation in the child component
      this.$children[0].fetchData();
      this.$children[1].fetchReportData();
    },
  
    new_staff() {
        this.newStaff.department  =this.selectedDepartment;
      this.showForm = true;
    },
    show_delete() {
      this.showActions = true;
   
    },
    show_CANCLE(){
      this.showActions = false;

      this.showForm = false;
      this.staffData.forEach(item => {
      item.editable = false;
    });
      this. staff_data();
    },
    show_UPDATE() {
      this.showActions = true;
      this.staffData.forEach(item => {
      item.editable = true;
    });
   
    },
    addNewSHIFT() {
      // Make API call to add new staff
      const apiUrl = "http://192.168.207.17:5024/api/c_shift/creat";
      
      // Assuming you have Axios installed, if not run: npm install axios

      axios.post(apiUrl, {
        area: this.selectedArea,
        department: this.newSHIFT.DEPARTMENT,
        hostid: this.newSHIFT.HOSTID,

})
        .then(response => {
          // Handle success
          console.log("New staff added successfully:", response.data);

          // You may want to update the staffData array with the new data
          // For example, this.staffData.push(response.data);

          // Reset the form and hide it
          this.newSHIFT = {
            department: "",
            HOSTID: "",
    
          };
          this.showForm = false;
          this. shift_data();
        })
        .catch(error => {
          // Handle error
          console.error("Error adding new staff:", error);
        });
    },
    addNewStaff() {
      // Make API call to add new staff
      const apiUrl = "http://192.168.207.17:5024/api/Attendance/creat";
      
      // Assuming you have Axios installed, if not run: npm install axios

      axios.post(apiUrl, {
        area: this.selectedArea,
        department: this.newStaff.department,
        jobnumber: this.newStaff.jobnumber,
        username: this.newStaff.username,
        work_department: this.newStaff.work_department ? this.newStaff.work_department : ''
})
        .then(response => {
          // Handle success
          console.log("New staff added successfully:", response.data);

          // You may want to update the staffData array with the new data
          // For example, this.staffData.push(response.data);

          // Reset the form and hide it
          this.newStaff = {
            department: "",
            jobnumber: "",
            username: "",
            work_department: "",
          };
          this.showForm = false;
          this. staff_data();
        })
        .catch(error => {
          // Handle error
          console.error("Error adding new staff:", error);
        });
    },
    // ... (existing methods for completeTask and pauseTask)
   staff_data() {
    this.staffData=[];
    if (!this.selectedArea || !this.selectedD || !this.selectedS || !this.selectedC) {
        // 資料為空，不執行POST請求
            console.warn('資料為空，未執行POST請求。');
           return;
         }

if (this.selectedL) {
this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
} else {
this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
}
console.log('POST 請求傳遞的資料:', {
    area: this.selectedArea,
department: this.selectedDepartment,
  });
// 使用axios來發送POST請求
axios.post('http://192.168.207.17:5024/api/Attendance', {
area: this.selectedArea,
department: this.selectedDepartment,
})
.then(response => {
// POST請求成功，將數據賦值給seatData
this.staffData = response.data;
})
.catch(error => {
// POST請求失敗，輸出錯誤信息
console.error('Error posting data:', error);
});

},  
    enableEditMode(selectedItem) {
      // 將所有項目的 editMode 設置為 false
      this.seatData.forEach(item => {
        item.editMode = false;
      });
      // 將選定的項目的 editMode 設置為 true
      selectedItem.editMode = true;
    },
  
    disableEditMode(item) {
      item.editMode = false;
    },
    postData() {

        if (!this.selectedArea || !this.selectedD || !this.selectedS || !this.selectedC) {
        // 資料為空，不執行POST請求
            console.warn('資料為空，未執行POST請求。');
           return;
         }

        if (this.selectedL) {
           this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
        } else {
           this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
        }
      // 使用axios來發送POST請求
      axios.post('http://192.168.207.17:5024/api/c_seat', {
        area: this.selectedArea,
        department: this.selectedDepartment,
      })
      .then(response => {
        // POST請求成功，將數據賦值給seatData
        this.seatData = response.data;
        this.newSeat.machine_L='0000',
        this.newSeat.machine_R='0000',
        this.newSeat.seatID=this.seatData.length + 1
        this.HOST_MACHINE();
      })
      .catch(error => {

        // POST請求失敗，輸出錯誤信息
        console.error('Error posting data:', error);
        this.HOST_MACHINE();
        this.seatData=[];
      });
    

  },
  HOST_MACHINE(){

    // 使用axios來發送GET請求
    axios.get('http://192.168.207.17:5024/api/c_seat/HOST_MACHINE', {
        params: {
            AREA: this.selectedArea,
            DEPARTMENT: this.selectedDepartment
        }
    })
    .then(response => {
        // 成功获取数据后的处理逻辑，你可以根据需要处理返回的数据
        this.hostMachine = response.data;
        console.log('Data fetched successfully:', response.data);
    })
    .catch(error => {
        // GET請求失敗，輸出錯誤信息
        console.error('Error fetching data:', error);
    });



  },

    getRowSpan(index) {
      let count = 1;
      for (let i = index + 1; i < this.realTimeData.length; i++) {
        if (this.realTimeData[i].NFC_CODE === this.realTimeData[index].NFC_CODE) {
          count++;
        } else {
          break;
        }
      }
      return count;
    },

    async fetchOnlineData() {
        if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
} else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
}


    const apiUrl = 'http://192.168.207.17:5024/api/ONLINE?area=' + this.selectedArea + '&department=' + this.selectedDepartment;

    try {
        const response = await fetch(apiUrl); // 使用 apiUrl 而不是硬编码的 URL
        const data = await response.json();
        this.onlineData = data;
      } catch (error) {
        console.error('Error fetching online data:', error);
      }
    
  },
    async executeUpdate() {

        const allWoIds = this.totwo();
       try {
    // 构造 UPDATE 请求的数据
    const updateData = {
      nickName: allWoIds, // 替换为实际的 nickName
      department: this.selectedDepartment,
      area: this.selectedArea,
      nfC_CODE:this.selectednfccode,

    };

    // 使用 fetch 或其他方法发送 UPDATE 请求
    const response = await fetch('http://192.168.207.17:5024/api/NEWWOID/update', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(updateData),
    });

    // 检查 HTTP 状态码
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }

    // 检查 Content-Type
    const contentType = response.headers.get('Content-Type');
    if (contentType && contentType.includes('application/json')) {
      // 处理 UPDATE 响应
      const result = await response.json();
      console.log('UPDATE result:', result);
    } else {
      // 处理非 JSON 格式的 UPDATE 响应
      const resultText = await response.text();
      console.log('UPDATE result:', resultText);
      alert(this.translatedText.更新完成);
     this.fetchData2();
     this.ERPDATA = [];
     this.selectedERP='';

    }

  } catch (error) {
    console.error('Error executing UPDATE:', error);
  }
},
    totwo() {
     let allWoIds = "";
      for (const item of this.ERPDATA) {
       allWoIds += item.wadoco + ",";
     }
     return allWoIds;
    },
    async uploadData() {
       try {

        if (!this.selectednfccode || this.selectednfccode.trim() === "") {
          alert("NFC Code 不能为空或 NULL"); // 弹出提示框提醒用户
          return; // 直接终止操作
    }
      // 计算整张表格的总和
      const totalQty = parseFloat(this.calculateTotal("wauorg"));
      const totalStdTime = parseFloat(this.calculateTotal("wlrunl_sum"));
      const allWoIds = this.totwo();
      this.loading = true;

    // 逐行上传数据
    for (const item of this.ERPDATA) {
      const standardTime = parseFloat(item.wlrunl_sum);
      const qty = parseFloat(item.wauorg);

      const uploadData = {
        area: this.selectedArea,
        department: this.selectedDepartment,
        woId: item.wadoco,
        transId: "LOT_START",
        qty: qty,
        nfcCode: this.selectednfccode,
        partNo: item.walitm,
        partDesc: item.wadl01,
        standardTime: standardTime,
        totalWo: allWoIds,
        totalQty: totalQty,
        totalStdTime: totalStdTime.toFixed(2),
        PasstEFF: item.avgStdEff || 0,
      };

      // 使用 fetch 或其他方法发送 POST 请求上传数据
      console.log('uploadData Message:', uploadData);
      const response = await fetch('http://192.168.207.17:5024/api/NEWWOID', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(uploadData),
      });

      // 检查 HTTP 状态码
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }

      // 检查 Content-Type
      const contentType = response.headers.get('Content-Type');
      if (contentType && contentType.includes('application/json')) {
        // 处理响应
        const result = await response.json();
        console.log('Upload result:', result);
        console.log('Success Message:', result.successMessage);
        this.loading = false;
       // await this.executeUpdate();
      } else {
        // 处理非 JSON 格式的成功消息
        const resultText = await response.text();
        console.log('Success Message:', resultText);
        this.loading = false;
      }

    }
    await this.executeUpdate();
  } catch (error) {
    console.error('Error uploading data:', uploadData);
    
  }
  this.loading = false;
},
    async fetchDPData() {
      this.selectednfccode=null;
      if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
} else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
}
      // 从服务器获取下拉选项的数据
      try {

        
        const response = await fetch('http://192.168.207.17:5024/api/DISTINCTNFCCODE?name=' + this.selectedDepartment + 'LN%25&area=' + this.selectedArea);
        const data = await response.json();
        this.dpOptions = data.map(item => {
      const match = item.nfc_code.match(/\d+$/);
      return match ? match[0] : item.nfc_code;
      console.log('Success Message:', response);
    });
      } catch (error) {
        console.error('Error fetching DP data:', error);
      }
    },
    SAFFcalculateTotal(property) {
      // 计算指定属性的总和
      return this.ERPDATA.reduce((total, item) => total + parseFloat(item[property] || 0), 0);
    },
    calculateTotal(property) {
      // 计算指定属性的总和
      return this.ERPDATA.reduce((total, item) => total + parseFloat(item[property] || 0), 0);
    },
    PDcalculateTotal(property) {
      // 计算指定属性的总和
      return this.PDTOVERSON.reduce((total, item) => total + parseFloat(item[property] || 0), 0);
    },
    PDcalculateAVG(property) {
  // 獲取指定屬性的數組
  const propertyArray = this.PDTOVERSON.map(item => parseFloat(item[property] || 0));
  
  // 計算總和
  const sum = propertyArray.reduce((total, value) => total + value, 0);
  
  // 計算平均值，注意處理分母為零的情況
  const nonZeroLength = propertyArray.filter(value => value !== 0).length;
  const average = nonZeroLength > 0 ? sum / nonZeroLength : 0;

  // 返回總和和平均值
  return average;
},

    checkAndSelectERP() {
        this.isButtonDisabled = true;
  const existingWorkOrderInERPDATA = this.ERPDATA.find(item => item.wadoco === this.selectedERP);
  const existingWorkOrderInRealTimeData = this.realTimeData.find(item => item.WO_ID === this.selectedERP);

  if (existingWorkOrderInERPDATA || existingWorkOrderInRealTimeData) {
    alert(this.translatedText.工單已存在);
    this.selectedERP='';
    this.isButtonDisabled = false;
  } else {
    if (this.Stickers=='TZ'||this.Stickers=='CD') {
      this.selectStickersr(this.Stickers);
    } else {
      this.selectERP();
    }
  } 
},
async selectStickersr(Stickers) {
  const wo_Id = this.selectedERP;

  try {
    // Make GET request to fetch SN_LIST data
    const snListResponse = await axios.get(`http://192.168.207.17:5024/api/SFWOREAD/SN_LIST?WO_ID=${this.selectedERP}&TYPE=${encodeURIComponent(Stickers)}`);
    this.snList = snListResponse.data.result || [];

    if (this.snList.length === 0 || this.snList[0].wadoco === '') {
      const userWantsToAddManually = window.confirm(this.translatedText.查無工單);
      if (userWantsToAddManually) {
        // Call method to add manually
        this.addManually(wo_Id);
      } else {
        // Logic when the user chooses not to add manually
        alert(this.translatedText.未添加工單);
        this.isButtonDisabled = false;
      }
    } else {
      this.ERPDATA.push(...this.snList);
      this.isButtonDisabled = false;

    }
  } catch (error) {
    // Handle errors from GET request
    console.error('Error fetching SN_LIST data:', error);
    alert(this.translatedText.查無工單);
    this.isButtonDisabled = false;
  }
  this.selectedERP='';
},
    selectERP(){

 const wo_Id = this.selectedERP;
//const apiUrl = `http://192.168.207.17:5024/api/ERPWOID/${wo_Id}`;

if(wo_Id==='100'){
  this.ERPDATA.push({
      wadoco: wo_Id,
      walitm: '100',
      wadl01:'試產工單',
      wauorg: '0',
      wlrunl_sum:'1',
      // 其他属性...

    });
    this.isButtonDisabled = false;  
}else if (wo_Id==='200'){
  this.ERPDATA.push({
      wadoco: wo_Id,
      walitm: '200',
      wadl01:'來料全檢',
      wauorg: '0',
      wlrunl_sum:'1',
      // 其他属性...

    });
    this.isButtonDisabled = false;  
}else if (wo_Id==='300'){
  this.ERPDATA.push({
      wadoco: wo_Id,
      walitm: '300',
      wadl01:'貼紙班',
      wauorg: '0',
      wlrunl_sum:'1',
      // 其他属性...

    });
    this.isButtonDisabled = false;  
  }else if (wo_Id==='400'){
  this.ERPDATA.push({
      wadoco: wo_Id,
      walitm: '400',
      wadl01:'重工',
      wauorg: '0',
      wlrunl_sum:'1',
      // 其他属性...

    });
    this.isButtonDisabled = false;  
  }else if (wo_Id==='700'){
  this.ERPDATA.push({
      wadoco: wo_Id,
      walitm: '700',
      wadl01:'物料員工時',
      wauorg: '0',
      wlrunl_sum:'1',
      // 其他属性...

    });
  }else if (wo_Id==='500'){
  this.ERPDATA.push({
      wadoco: wo_Id,
      walitm: '500',
      wadl01:'裁剝線',
      wauorg: '0',
      wlrunl_sum:'1',
      // 其他属性...

    });
    this.isButtonDisabled = false;  
}else{
// Assuming you are using fetch API
axios.post('http://192.168.207.17:5024/api/ERPREAD/WOID', {
  wadoco: this.selectedERP
})
.then(response => {
  const data = response.data;
  if (data.length === 0 || data[0].wadoco === '') {
    const userWantsToAddManually = window.confirm(this.translatedText.查無工單);
    if (userWantsToAddManually) {
      // 执行手动增加工单的逻辑，可以调用一个方法或者显示一个表单
      this.addManually(wo_Id);
    } else {
      // 用户选择不手动增加时的逻辑
      alert(this.translatedText.未添加工單);
      this.isButtonDisabled = false;  
    }
  } else {
    this.ERPDATA.push(...data);
    this.isButtonDisabled = false;  
  }
})
.catch(error => {
  // POST请求失败，输出错误信息
  console.error('Error posting data:', error);
  alert(this.translatedText.查無工單);
      this.isButtonDisabled = false;  
});
  
}
this.selectedERP='';
    },
    addManually(wo_Id) {
  // 使用 window.prompt 弹出提示框，接收用户输入
  const WO_IDNumber = window.prompt('請輸入料號：');
  const PARTNumber = window.prompt('請輸入料號：');
  const productName = window.prompt('請輸入品名：');
  const quantity = window.prompt('請輸入數量：');
  const STD = window.prompt('請輸入標準工時：');

  // 判断用户是否点击了取消按钮
  if (PARTNumber !== null && productName !== null && quantity !== null) {
    // 执行手动增加工单的逻辑，例如将输入的数据添加到 ERPDATA 数组
    this.ERPDATA.push({
      wadoco: wo_Id,
      walitm: PARTNumber,
      wadl01:productName,
      wauorg: quantity,
      wlrunl_sum:STD,
      // 其他属性...

    });
    this.isButtonDisabled = false;  
  } else {
    // 用户点击了取消按钮
    alert('取消手動增加工單');
    this.isButtonDisabled = false;  
  }

},
REWORK(item) {
  // 禁用按钮，防止重复点击
  this.isButtonDisabled = true;

  // 在 ERPDATA 中查找是否已经存在具有相同 WO_ID 的工作单
  const existingWorkOrderInERPDATA = this.ERPDATA.find(data => data.wadoco === item.WO_ID);

  // 如果工作单已存在，显示警告信息并重新启用按钮
  if (existingWorkOrderInERPDATA) {
    alert(this.translatedText.工單已存在);
    this.isButtonDisabled = false;
  } else {
    // 如果工作单不存在，将新的工作单数据推入 ERPDATA 数组
    this.ERPDATA.push({
      wadoco: item.WO_ID,
      walitm: item.PART_NO,
      wadl01: item.PART_DESC,
      wauorg: item.qty,
      wlrunl_sum: item.std,
      avgStdEff: item.PasstEFF 
      // 其他属性...
    });
    this.isButtonDisabled = false;
  }
},

    completeTask(woId, nfcCode) {
    const area = this.selectedArea;
    const department = this.selectedDepartment;
    // 发起完成任务的 HTTP 请求
    fetch(`http://192.168.207.17:5024/api/lotend?area=${area}&department=${department}&NFC_code=${nfcCode}&woId=${woId}`)
      .then(response => response.json())
      .then(data => {
        // 处理成功完成任务的响应
        console.log('任务完成:', data);
        alert(this.translatedText.更新完成);
        this.fetchData2();
      })
      .catch(error => console.error('发生错误:', error));
  
  },
  delete_staffData(id) {

    const numericId = parseInt(id, 10);

// 構建 DELETE 請求的主體
const deleteData = {
  id: numericId,
  area: this.selectedArea
};

axios.delete('http://192.168.207.17:5024/api/Attendance/Delete', {
    data: deleteData,  // 將主體放入 data 選項
    headers: {
      'Content-Type': 'application/json'  // 設置 Content-Type 為 JSON
    }
  })
    .then(response => {
      // 在這裡處理成功的回應，如果需要的話
      console.log('刪除成功', response);
      this. staff_data();
      this.showActions = false;
    })
    .catch(error => {
      // 在這裡處理錯誤，如果需要的話
      console.error('刪除失敗', error);

    });
    console.log('selectedD:', id)
},  
UPDATE_staffData(ITEM) {



  // 构建 PUT 请求的主体
  const updateData = {
    id: ITEM.id.toString(),
    area: this.selectedArea,
    department: ITEM.department,
    jobnumber:ITEM.jobnumber,
    username:ITEM.username,
    work_department:ITEM.work_department
  };

  axios.put('http://192.168.207.17:5024/api/Attendance/UPDATE_USER', updateData, {
    headers: {
      'Content-Type': 'application/json'  // 设置 Content-Type 为 JSON
    }
  })
  .then(response => {
    // 处理成功的响应
    console.log('更新成功', response);
    this. staff_data();
      this.showActions = false;
  })
  .catch(error => {
    // 处理错误
    console.error('更新失败', error);
  });

  console.log('选中的数据:', updateData);


},delete_hr(id) {

const numericId = parseInt(id, 10);

// 構建 DELETE 請求的主體
const deleteData = {
id: numericId,
area: this.selectedArea
};

axios.delete('http://192.168.207.17:5024/api/Attendance/Delete_hr', {
data: deleteData,  // 將主體放入 data 選項
headers: {
  'Content-Type': 'application/json'  // 設置 Content-Type 為 JSON
}
})
.then(response => {
  // 在這裡處理成功的回應，如果需要的話
  console.log('刪除成功', response);
  this. staff_data();
  this.showActions = false;
})
.catch(error => {
  // 在這裡處理錯誤，如果需要的話
  console.error('刪除失敗', error);

});
console.log('selectedD:', id)
},
openDateDialog(item) {
      this.REWOID = item;
      this.showDialog = true;
    },
    closeDialog() {
      this.showDialog = false;
      this.REWOID = null;
      this.selectedDate = null;
    },
    async updateReworkDate() {
      if (!this.selectedDate) {
        alert("請選擇日期！");
        return;
      }

      try {
        this.isButtonDisabled = true;
        console.log('id:', this.REWOID);
        console.log('reworkDate:', this.selectedDate);
        console.log('area:', this.selectedArea);
        const response = await axios.put(
          "http://192.168.207.17:5024/api/READWOID/UPDATE_rework_date",
          {
             area: this.selectedArea, // 根據需求傳入正確值
             reworkDate: this.selectedDate,
             id: String(this.REWOID), // 将 id 转换为字符串
          }
        );

        alert(response.data);
      } catch (error) {
        console.error("更新失敗", error);
        alert("更新失敗，請重試！");
      } finally {
        this.isButtonDisabled = false;
        this.closeDialog();
        this.fetchDPData();
        this.fetchData();
      }
    },
showRemarkSelect(woId, nfcCode) {
      this.showSelect = true;       // 顯示下拉選單
      this.currentWoId = woId;      // 儲存當前工單ID
      this.currentNfcCode = nfcCode;// 儲存當前NFC代碼
    },
    closeModal() {
      this.showSelect = false;      // 關閉彈窗
      this.selectedRemark = "";    // 重置選項
    },
  pauseTask(woId, nfcCode) {
    if (this.selectedRemark) {    // 確認用戶選擇了原因
        const area = this.selectedArea;
        const department = this.selectedDepartment;
        const woId = this.currentWoId;
        const nfcCode = this.currentNfcCode;
        const remarkWithDate = this.selectedRemark;  
        const now = new Date();
    const reWORKDate = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;  


    // 发起暂停任务的 HTTP 请求
    fetch(`http://192.168.207.17:5024/api/lotend/PAUSE?area=${area}&department=${department}&NFC_code=${nfcCode}&woId=${woId}&REMARK=${remarkWithDate}&REWORK=${reWORKDate}`)
      .then(response => response.json())
      .then(data => {
        // 处理成功暂停任务的响应
        console.log('任务暂停:', data);
        this.fetchData2();
      })
      .catch(error => console.error('发生错误:', error));
        // 重置並隱藏下拉選單
        this.showSelect = false;
        this.selectedRemark = "";
        this.currentWoId = null;
        this.currentNfcCode = null;
  } else {
    console.log('用户取消了操作');
    // 可以添加相应的提示或处理
  }
  },
    getBackgroundColor(nfcCode) {
  // 根据 nfcCode 的值返回相应的颜色
  if (nfcCode === '01') {
    return '#4886ea';
  } else if (nfcCode === '02') {
    return 'darkgreen';
  } else if (nfcCode === '03') {
    return 'yellow';
  } else if (nfcCode === '04') {
    return '#bd91f3';
  } else if (nfcCode === '05') {
    return 'lightgreen';
  } else if (nfcCode === '06') {
    return 'orange';
  }  else {
    return ''; // 如果没有匹配的值，可以返回空字符串或其他默认值
  }

},
repassword(){
  this.SHOW_RATING_VERSON= false;
  this.SF_SN_MG=false,
  this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
     this.SHOW_PD_VERSON= false;
     this.SHOW_WO_VERSON= false;
     this.showyear= false;
      this.showCLASS= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= false;
      this.repasswords= true;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
},
login_VERSON(){
  this.repasswords= false;
  this.SHOW_RATING_VERSON= false;
  this.SF_SN_MG=false,
  this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
     this.SHOW_PD_VERSON= false;
     this.SHOW_WO_VERSON= false;
     this.showyear= false;
      this.showCLASS= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= true
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
},
effperformance(){
  this.repasswords= false;
  this.SF_SN_MG=false,
  this.SHOW_RATING_VERSON= false;
  this.SHOPSTcontent= false;
  this.SNLISTcontent= false;
  this.PDSNLISTcontent= false;
  this.FAILSNLISTcontent= false;
  this.SHOW_eff_performance= true;
  this.SHOW_overflow_performance= false;
  this.SHOW_PD_VERSON= false;
     this.SHOW_WO_VERSON= false;
     this.showyear= false;
      this.showCLASS= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.effper();

},
overflowperformance(){
  this.repasswords= false;
  this.SF_SN_MG=false,
  this.SHOW_RATING_VERSON= false;
  this.SHOPSTcontent= false;
  this.SNLISTcontent= false;
  this.PDSNLISTcontent= false;
  this.FAILSNLISTcontent= false;
  this.SHOW_eff_performance= false;
  this.SHOW_overflow_performance= true;
  this.SHOW_PD_VERSON= false;
     this.SHOW_WO_VERSON= false;
     this.showyear= false;
      this.showCLASS= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.overflowper();

},
WO_VERSON(){
  this.repasswords= false;
  this.SF_SN_MG=false,
  this.SHOW_RATING_VERSON= false;
  this.SHOPSTcontent= false;
  this.SNLISTcontent= false;
  this.PDSNLISTcontent= false;
  this.FAILSNLISTcontent= false;
  this.SHOW_eff_performance= false;
  this.SHOW_overflow_performance= false;
     this.SHOW_PD_VERSON= false;
     this.SHOW_WO_VERSON= true;
     this.showyear= false;
      this.showCLASS= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= false;
      this.WO_SUM_VER();
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;

},
RATING_VERSON(){
  this.repasswords= false;
  this.SF_SN_MG=false,
  this.SHOPSTcontent= false;
  this.SNLISTcontent= false;
  this.PDSNLISTcontent= false;
  this.FAILSNLISTcontent= false;
  this.SHOW_eff_performance= false;
  this.SHOW_overflow_performance= false;
     this.SHOW_PD_VERSON= false;
     this.SHOW_WO_VERSON= false;
     this.SHOW_RATING_VERSON= true;
     this.showyear= false;
      this.showCLASS= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= false;
      this.RATING_SUM_VER();
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;

},
PD_VERSON(){
  this.repasswords= false;
  this.SF_SN_MG=false,
  this.SHOW_RATING_VERSON= false;
  this.SHOPSTcontent= false;
  this.SNLISTcontent= false;
  this.PDSNLISTcontent= false;
  this.FAILSNLISTcontent= false;
  this.SHOW_eff_performance= false;
  this.SHOW_overflow_performance= false;
    this.SHOW_WO_VERSON= false;
     this.SHOW_PD_VERSON= true;
     this.showyear= false;
      this.showCLASS= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= false;
      this.fetchCombinedVersions();
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;

},

woerp_report(){
  this.repasswords= false;
  this.SF_SN_MG=false,
  this.SHOW_RATING_VERSON= false;
  this.SHOPSTcontent= false;
  this.SNLISTcontent= false;
  this.PDSNLISTcontent= false;
  this.FAILSNLISTcontent= false;
  this.SHOW_eff_performance= false;
  this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=true;
      this.woderp() ;
},
eff_report() {
  this.repasswords= false;
  this.SF_SN_MG=false,
  this.SHOW_RATING_VERSON= false;
  this.SHOPSTcontent= false;
  this.SNLISTcontent= false;
  this.PDSNLISTcontent= false;
  this.FAILSNLISTcontent= false;
  this.SHOW_eff_performance= false;
  this.SHOW_overflow_performance= false;
      // 點擊時設置 showRealTimeContent 為 false，並且 showDemoContent 為 true
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= true,
      this.showCLASS= false,
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = true;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      
      this.$nextTick(() => {
        const iframe = this.$refs.demoIframe;
        if (iframe) {
          iframe.contentWindow.addEventListener('resize', () => {
            this.iframeHeight = iframe.contentDocument.body.scrollHeight;
          });
        }
      });
    },
    SHOP_ST() {
      this.repasswords= false;
      this.SF_SN_MG= false;
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= true;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= true,
        this.showDemoContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.fqc_mangeContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.fetchData();
    },
    SN_MG() {
      this.repasswords= false;
      this.SF_SN_MG=true,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= true,
        this.showDemoContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.fqc_mangeContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;

    },
    SNLIST() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= true;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
        this.showDemoContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.fqc_mangeContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;

    },
    PDSNLIST() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= true;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
        this.showDemoContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.fqc_mangeContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.SFPDSNLINK =[];

    },
    FAILSNLIST() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= true;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
        this.showDemoContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.fqc_mangeContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.SFPDSNLINK =[];

    },
    showRealTime() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= true,
      this.showDemoContent = false;
      this.showRealTimeContent = true;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.fqc_mangeContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.fetchData();
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.fetchTableData();
    },
    showPDRealTime() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= true,
      this.showDemoContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= true;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.fqc_mangeContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
 
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.fetchTableData();
    },
    fqc_mange(){
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= true,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.fqc_mangeContent = true;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;

      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.fetchData();
      this.RATING_fetchData()

    },
    wo_select(){
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= true;
      this.showRealTimeContent = false;
      this.staff_mangeContent = false;
      this.showPDRealTimeContent= false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;

    },
    wo_mange() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= true,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.wo_mangeContent = true;
      this.wo_selectment= false;
      this.showRealTimeContent = false;
      this.staff_mangeContent = false;
      this.showPDRealTimeContent= false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.fetchDPData();
      this.fetchData();
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
    },
    SET_mange() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.showSET= true;
      axios.get('http://192.168.207.17:5024/api/c_seat/SELECTSET?area=vn', {
            params: {
              area: 'SET'
            }
          })
          .then(res => {
            this.tableData = res.data.result;
          })
          .catch(err => {
            console.error('API 請求失敗:', err);
          });
    },
    seat_mange() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= true,
      this.showDemoContent = false;
      this.seat_mangeContent = true;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.postData();
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
    },
    staff_mange() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.staff_mangeContent = true;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.staff_data();
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      
    },
    ATT_Abnormal(){
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = true;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.ATT_Abnorma_data();
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
 

    },
    ATT_timebt_confirm(){
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.att_hr_SUM_ADJ();
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=true;
      this.woderpreport=false;
    },
    ATT_timebt(){
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = true;
      this.isLoggedIn= false;
      this.att_hr_SUM_data();
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
     

    },
    CARD_mange(){
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= true,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.showRealTimeContent = false;
      this.wo_mangeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_selectment= false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= true;
      this.shift_mangeContent= false;
       this.machine_card=null;
       this.selectedmachine='';
       this.ATT_ADJ_confirm=false;
       this.woderpreport=false;

    },
    shift_mange(){
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
this.SHOW_WO_VERSON= false;
this.fqc_mangeContent = false;
this.SHOW_PD_VERSON= false,
this.showyear= false,
this.showCLASS= false,
this.showDemoContent = false;
this.seat_mangeContent = false;
this.showRealTimeContent = false;
this.showPDRealTimeContent= false;
this.wo_mangeContent = false;
this.wo_selectment= false;
this.staff_mangeContent = false;
this.ATT_AbnormalContent = false;
this.ATT_timeContent = false;
this.isLoggedIn= false;
this.CARD_mangeContent= false;
this.shift_mangeContent= true;
 this.machine_card=null;
 this.selectedmachine='';
 this.ATT_ADJ_confirm=false;
 this.woderpreport=false;
 this.shift_data();
},
    handleInputChange() {
      this.setCookie('selectedArea', this.selectedArea, 30); // 在這裡，30 是 cookie 的有效期（天）
      this.setCookie('selectedD', this.selectedD, 30); // 在這裡，30 是 cookie 的有效期（天）
      this.setCookie('selectedS', this.selectedS, 30); // 在這裡，30 是 cookie 的有效期（天）
      this.setCookie('selectedC', this.selectedC, 30); // 在這裡，30 是 cookie 的有效期（天）
      this.setCookie('selectedL', this.selectedL, 30); // 在這裡，30 是 cookie 的有效期（天）
      // 在这里添加条件语句
      if (this.seat_mangeContent) {
            this.postData();
          }
          if (this.staff_mangeContent) {
            this.staff_data();
          }
          if (this.showRealTimeContent) {
            this.fetchData();
            this.fetchTableData();
          } 
          if (this.wo_mangeContent) {
            this.fetchData();
            this.fetchDPData();


          }
          if (this.fqc_mangeContent) {
            this.fetchData();
            this.RATING_fetchData()
       
          } if (this.SHOPSTcontent) {
            this.fetchData();
       
          }if (this.showPDRealTimeContent) {
            this.fetchTableData();
       
          }

    },

    async fetchData() {
      if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
} else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
}

if (this.selectedD && this.selectedS && this.selectedC) {

  
  this.loading = true;
  const apiUrl1 = `http://192.168.207.17:5024/api/READWOID?area=${this.selectedArea}&department=${this.selectedDepartment}`;
  const apiUrl2 = `http://192.168.207.17:5024/api/Query2?area=${this.selectedArea}&department=${this.selectedDepartment}`;

  // 使用 Promise.all 并行发起两个请求
  Promise.all([
    fetch(apiUrl1),
    fetch(apiUrl2)
  ])
    .then(responses => Promise.all(responses.map(response => response.json())))
    .then(data => {
      // data[0] 包含第一个请求的响应数据
      // data[1] 包含第二个请求的响应数据
      this.realTimeData = data[0];
      this.QUERRYTIME = data[1];
    })
    .catch(error => console.error('Error fetching data:', error))
        .finally(() => {
          this.loading = false;
          this.fetchOnlineData();
          this.fetchDPData();  
  
        });
      }
},

    fetchData2() {
      const apiUrl = `http://192.168.207.17:5024/api/READWOID?area=${this.selectedArea}&department=${this.selectedDepartment}`;

      // Assuming you are using fetch API
      fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
          this.realTimeData = data;
        })
        .catch(error => console.error('Error fetching data:', error));  
        this.fetchDPData();  
    },
    fetchData3() {

      if (this.selectedD && this.selectedS && this.selectedC) {
        console.log('TIME:',  this.currentTime)
        if (this.selectedL) {
         this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
         } else {
            this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
           }

  const apiUrl1 = `http://192.168.207.17:5024/api/READWOID?area=${this.selectedArea}&department=${this.selectedDepartment}`;
  const apiUrl2 = `http://192.168.207.17:5024/api/Query2?area=${this.selectedArea}&department=${this.selectedDepartment}`;

  // 使用 Promise.all 并行发起两个请求
  Promise.all([
    fetch(apiUrl1),
    fetch(apiUrl2)
  ])
    .then(responses => Promise.all(responses.map(response => response.json())))
    .then(data => {
      // data[0] 包含第一个请求的响应数据
      // data[1] 包含第二个请求的响应数据
      this.realTimeData = data[0];
      this.QUERRYTIME = data[1];
    })
    .catch(error => console.error('Error fetching data:', error))
        .finally(() => {
          this.fetchDPData();  
          this.fetchOnlineData();

        });
      }
},
getCurrentDate() {
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()-1).padStart(2, '0');
      return `${year}-${month}-${day}`;
    },
    login2() {
      // 这里进行用户名和密码的验证
      if (this.username === 'admin' && this.password === 'admin') {
        this.isLoggedIn = false;
        this.power='T'
        this.power='T'
      } else {
        alert('Invalid username or password');
      }
    },
    async login() {
          try {
            const response = await axios.post('http://192.168.207.17:5024/api/LOGIN/login', this.credentials);
            this.user = response.data;
            this.isAuthenticated = true;
            this.isLoggedIn = false;
           this.power='T'
          } catch (error) {
            console.error('Login failed:', error);
            alert('Login failed!');
          }
        },
    logout() {
      // 这里进行用户名和密码的验证

        this.power='F'
        this.power='F'
        this.user = { permissions: [] };
        this.credentials = {
          username: '',
          password: '',
        };
    },
    savePreference() {
      // 保存偏好設置到 Cookie 中

    },
    setCookie(name, value, days) {
      const date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      const expires = "expires=" + date.toUTCString();
      document.cookie = name + "=" + value + ";" + expires + ";path=/";
    },
    getCookie(name) {
      const cname = name + "=";
      const decodedCookie = decodeURIComponent(document.cookie);
      const cookieArray = decodedCookie.split(';');
      for (let i = 0; i < cookieArray.length; i++) {
        let c = cookieArray[i];
        while (c.charAt(0) === ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(cname) === 0) {
          return c.substring(cname.length, c.length);
        }
      }
      return "";
    },
    setCookie2(name, value, days = 7) {
      const date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      const expires = "expires=" + date.toUTCString();
      document.cookie = name + "=" + value + ";" + expires + ";path=/";
    },
    getCookie2(name) {
      const cookieName = name + "=";
      const decodedCookie = decodeURIComponent(document.cookie);
      const cookieArray = decodedCookie.split(';');
      for (let i = 0; i < cookieArray.length; i++) {
        let cookie = cookieArray[i];
        while (cookie.charAt(0) === ' ') {
          cookie = cookie.substring(1);
        }
        if (cookie.indexOf(cookieName) === 0) {
          return cookie.substring(cookieName.length, cookie.length);
        }
      }
      return null;
    },

  },
  created() {

    // 在组件创建时检查是否有 Cookie 记录
    const savedState = this.getCookie2('showInSecondTable');
    if (savedState) {
      this.showInSecondTable = JSON.parse(savedState);
    }
     console.log('showInSecondTable:',  this.showInSecondTable)
  },
  mounted() {

    window.addEventListener('keydown', this.handleKeydown);
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    const yyyy = yesterday.getFullYear();
    const mm = String(yesterday.getMonth() + 1).padStart(2, '0'); // 加一是因为月份从0开始计数
    const dd = String(yesterday.getDate()).padStart(2, '0');
    this.selectedDate = `${yyyy}-${mm}-${dd}`;
    const savedselectedArea= this.getCookie('selectedArea');
    const savedsselectedD= this.getCookie('selectedD');
    const savedsselectedS= this.getCookie('selectedS');
    const savedselectedC= this.getCookie('selectedC');
    const savedselectedL= this.getCookie('selectedL');
    //const savedshowInSecondTable= this.getCookie2('showInSecondTable');
   // this.showInSecondTable = savedshowInSecondTable;
   // console.log('selectedD:',  this.showInSecondTable)

    if (savedselectedArea) {
      this.selectedArea = savedselectedArea;
    }
    if (savedsselectedD) {
      this.selectedD = savedsselectedD;
    }
    if (savedsselectedS) {
      this.selectedS = savedsselectedS;
    }
    if (savedselectedC) {
      this.selectedC = savedselectedC;
    }
    if (savedselectedL) {
      this.selectedL = savedselectedL;
    }   

    this.MFG_D = this.getCurrentDate();
    setInterval(() => {
      this.currentTime = new Date().toLocaleTimeString();
    }, 1000);
    // Refresh data every minute
    setInterval(() => {
      if (this.showRealTimeContent) {
        this.fetchData3();

      }
    }, 15000);


    
  },

  
});

</script>

</body>
</html>
